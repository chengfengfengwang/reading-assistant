import{d as r}from"./const-CVqFB6Xv.js";const c=({selectionText:e,promptId:t})=>{if(window.readingAssistantExtensionPort)window.readingAssistantExtensionPort.postMessage({type:"chat",payload:{selectionText:e,promptId:t}});else{const n=o=>{o.name==="readingAssistantSidePanelInit"&&(console.log("--init--"),window.readingAssistantExtensionPort=o,o.onDisconnect.addListener(function(){console.log("--disconnect--"),window.readingAssistantExtensionPort=void 0,chrome.runtime.onConnect.removeListener(n)}),o.postMessage({type:"chat",payload:{selectionText:e,promptId:t}}),o.onMessage.addListener(function(s){console.log("--message--",s),s.type==="getPageText"&&o.postMessage({type:"pageText",payload:{content:document.body.innerText}})}))};chrome.runtime.onConnect.addListener(n)}},i=()=>{chrome.contextMenus.removeAll(async()=>{const t=(await chrome.storage.sync.get()).prompts??r.prompts;for(const n of t)chrome.contextMenus.create({id:n.id,title:n.title,contexts:["selection"],documentUrlPatterns:["http://*/*","https://*/*","file://*/*","ftp://*/*"]})})},a=e=>{chrome.sidePanel.setOptions({tabId:e,path:"src/pages/sidePanel/index.html",enabled:!0}),chrome.sidePanel.open({tabId:e})};chrome.runtime.onMessage.addListener((e,t)=>{(async()=>{var n;e.type==="open_side_panel"&&typeof((n=t.tab)==null?void 0:n.id)=="number"&&(chrome.sidePanel.setOptions({tabId:t.tab.id,path:"src/pages/sidePanel/index.html",enabled:!0}),chrome.sidePanel.open({tabId:t.tab.id}))})()});chrome.action.onClicked.addListener(function(e){var t;if((t=e.url)!=null&&t.startsWith("chrome://"))chrome.runtime.openOptionsPage();else{const n=e.id;typeof n=="number"&&(a(n),chrome.scripting.executeScript({target:{tabId:n},func:c,args:[{selectionText:void 0,promptId:void 0}]}))}});chrome.runtime.onInstalled.addListener(()=>{i(),chrome.storage.sync.onChanged.addListener(function(e){"prompts"in e&&i()}),chrome.contextMenus.onClicked.addListener((e,t)=>{const n=t==null?void 0:t.id;typeof n=="number"&&(a(n),chrome.scripting.executeScript({target:{tabId:n},func:c,args:[{selectionText:e.selectionText,promptId:e.menuItemId}]}))})});
