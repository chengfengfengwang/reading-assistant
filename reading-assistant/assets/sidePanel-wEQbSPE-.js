var Vc=Object.defineProperty;var qc=(n,e,t)=>e in n?Vc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ee=(n,e,t)=>(qc(n,typeof e!="symbol"?e+"":e,t),t);import{c as Sr,r as K,j as F,R as Wc,a as ao,g as Ki,b as Gc,u as Jc,T as Kc,t as oo}from"./toast-CFoZG5HZ.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xc=Sr("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qc=Sr("FileTerminal",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m8 16 2-2-2-2",key:"10vzyd"}],["path",{d:"M12 18h4",key:"1wd2n7"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yc=Sr("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ed=Sr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const td=Sr("TextSearch",[["path",{d:"M21 6H3",key:"1jwq7v"}],["path",{d:"M10 12H3",key:"1ulcyk"}],["path",{d:"M10 18H3",key:"13769t"}],["circle",{cx:"17",cy:"15",r:"3",key:"1upz2a"}],["path",{d:"m21 19-1.9-1.9",key:"dwi7p8"}]]),nd=K.forwardRef(function(e,t){const[r,i]=K.useState(""),{onSubmit:s,placeholder:a}=e;K.useImperativeHandle(t,()=>({getInput:()=>r,setInput:d=>i(d)}));const o=K.useRef(null),l=()=>{r.trim()!==""&&(s(r.trim()),i(""))},u=d=>{d.stopPropagation();const f=d.target.value;i(f)};K.useEffect(()=>{o.current&&(r?(o.current.style.height="auto",o.current.style.height=`${o.current.scrollHeight||21}px`,o.current.scrollHeight>150&&(o.current.style.overflowY="scroll")):o.current.style.height="21px")},[r]);const c=d=>{d.stopPropagation(),d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),l(),i(""))};return F.jsx("div",{className:"relative px-2 pb-2",children:F.jsx("div",{className:"relative transition bg-base-300  rounded-md",children:F.jsxs("div",{className:"flex p-[4px] justify-between items-end",children:[F.jsx("textarea",{ref:o,rows:1,value:r,onChange:u,onKeyDown:c,onKeyUp:d=>d.stopPropagation(),onKeyPress:d=>d.stopPropagation(),placeholder:a||"",className:"bg-inherit flex-grow placeholder:text-base-content/50 w-full shadow-none overflow-hidden  max-h-[150px] text-[14px] p-0 m-0 outline-none border-0 focus:ring-0 appearance-none resize-none -translate-y-[3px]",autoFocus:!0}),F.jsx("button",{onClick:l,disabled:!r,className:`w-[28px] h-[28px] cursor-pointer transition ${r&&"bg-neutral hover:bg-neutral-600"} rounded-md p-1 text-white disabled:text-gray-400`,children:F.jsx(Yc,{className:"w-full h-full"})})]})})})});function rd(){return F.jsx("span",{className:"animate-pulse inline-block align-middle w-[6px] h-4 bg-base-200 ml-1 mb-[2px]"})}const zl=K.createContext(null),us={didCatch:!1,error:null};class id extends K.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=us}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var t,r,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];(t=(r=this.props).onReset)===null||t===void 0||t.call(r,{args:s,reason:"imperative-api"}),this.setState(us)}}componentDidCatch(e,t){var r,i;(r=(i=this.props).onError)===null||r===void 0||r.call(i,e,t)}componentDidUpdate(e,t){const{didCatch:r}=this.state,{resetKeys:i}=this.props;if(r&&t.error!==null&&sd(e.resetKeys,i)){var s,a;(s=(a=this.props).onReset)===null||s===void 0||s.call(a,{next:i,prev:e.resetKeys,reason:"keys"}),this.setState(us)}}render(){const{children:e,fallbackRender:t,FallbackComponent:r,fallback:i}=this.props,{didCatch:s,error:a}=this.state;let o=e;if(s){const l={error:a,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")o=t(l);else if(r)o=K.createElement(r,l);else if(i===null||K.isValidElement(i))o=i;else throw a}return K.createElement(zl.Provider,{value:{didCatch:s,error:a,resetErrorBoundary:this.resetErrorBoundary}},o)}}function sd(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return n.length!==e.length||n.some((t,r)=>!Object.is(t,e[r]))}function ad(n){if(n==null||typeof n.didCatch!="boolean"||typeof n.resetErrorBoundary!="function")throw new Error("ErrorBoundaryContext not found")}function Ul(){const n=K.useContext(zl);ad(n);const[e,t]=K.useState({error:null,hasError:!1}),r=K.useMemo(()=>({resetBoundary:()=>{n.resetErrorBoundary(),t({error:null,hasError:!1})},showBoundary:i=>t({error:i,hasError:!0})}),[n.resetErrorBoundary]);if(e.hasError)throw e.error;return r}const Hl=async()=>await chrome.storage.sync.get();function od(n){let e,t,r,i,s,a,o;return l(),{feed:u,reset:l};function l(){e=!0,t="",r=0,i=-1,s=void 0,a=void 0,o=""}function u(d){t=t?t+d:d,e&&ld(t)&&(t=t.slice(Zl.length)),e=!1;const f=t.length;let h=0,p=!1;for(;h<f;){p&&(t[h]===`
`&&++h,p=!1);let w=-1,y=i,b;for(let _=r;w<0&&_<f;++_)b=t[_],b===":"&&y<0?y=_-h:b==="\r"?(p=!0,w=_-h):b===`
`&&(w=_-h);if(w<0){r=f-h,i=y;break}else r=0,i=-1;c(t,h,y,w),h+=w+1}h===f?t="":h>0&&(t=t.slice(h))}function c(d,f,h,p){if(p===0){o.length>0&&(n({type:"event",id:s,event:a||void 0,data:o.slice(0,-1)}),o="",s=void 0),a=void 0;return}const w=h<0,y=d.slice(f,f+(w?p:h));let b=0;w?b=p:d[f+h+1]===" "?b=h+2:b=h+1;const _=f+b,v=p-b,P=d.slice(_,_+v).toString();if(y==="data")o+=P?"".concat(P,`
`):`
`;else if(y==="event")a=P;else if(y==="id"&&!P.includes("\0"))s=P;else if(y==="retry"){const C=parseInt(P,10);Number.isNaN(C)||n({type:"reconnect-interval",value:C})}}}const Zl=[239,187,191];function ld(n){return Zl.every((e,t)=>n.charCodeAt(t)===e)}async function ud(n,e){const t=od(r=>{r.type==="event"&&e(r.data)});for(;;){const{done:r,value:i}=await n.read();if(r)break;const s=new TextDecoder().decode(i);t.feed(s)}}class cd{constructor({onError:e,onGenerating:t,onBeforeRequest:r,onComplete:i,onClear:s,preMessageList:a}){Ee(this,"controller");Ee(this,"messageList");Ee(this,"onError");Ee(this,"onBeforeRequest");Ee(this,"onGenerating");Ee(this,"onComplete");Ee(this,"onClear");this.controller=new AbortController,this.messageList=a||[],this.onBeforeRequest=r,this.onError=e,this.onGenerating=t,this.onComplete=i,this.onClear=s}async sendMessage(e){try{this.onBeforeRequest&&await this.onBeforeRequest(),this.controller.signal.aborted&&(this.controller=new AbortController);const t=await Hl(),r=t.openAIAddress??"https://api.openai.com/v1/chat/completions",i=t.openAIModel??"gpt-4o",s=t.openAIKey;if(!s){this.onError&&this.onError("apiKey is empty");return}let a="";e&&this.messageList.push({role:"user",content:e}),this.messageList.push({role:"assistant",content:""}),this.onGenerating&&this.onGenerating(a);const o=await fetch(r,{method:"POST",signal:this.controller.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({model:i,messages:this.messageList.slice(0,-1),stream:!0})});if(!o.ok||!o.body){const u=await o.json();this.onError&&this.onError(u.error);return}const l=o.body.getReader();ud(l,u=>{if(u!=="[DONE]"){const c=JSON.parse(u);if(c.error){this.onError&&this.onError(c.error);return}const d=c.choices[0].delta.content||"";a+=d,this.messageList=this.messageList.map((f,h)=>h===this.messageList.length-1?{...f,content:f.content+d}:f),this.onGenerating&&this.onGenerating(a)}else this.onComplete(this.messageList[this.messageList.length-1].content)})}catch(t){console.log(t),this.onError&&this.onError("request failed")}}clearMessage(){this.controller.abort(),this.messageList=[],this.onClear&&this.onClear()}refresh(){this.messageList=this.messageList.slice(0,-1),this.sendMessage()}abort(){this.controller.abort()}}const dd=n=>{switch(n){case"openai":return cd}};function hd({preMessageList:n,engine:e}){const[t,r]=K.useState(!1),[i,s]=K.useState(!1),[a,o]=K.useState(n??[]),l=K.useRef(null),{showBoundary:u}=Ul(),c=()=>{var d;(d=l.current)==null||d.clearMessage(),o([])};return K.useEffect(()=>{n&&o(n);const d={preMessageList:n??[],onBeforeRequest(){r(!0)},onComplete:()=>{s(!1),r(!1)},onGenerating(){s(!0),r(!1),l.current&&o(l.current.messageList)},onError(h){s(!1),r(!1),u(h)}},f=dd(e);f&&(l.current=new f(d))},[n,e]),{loading:t,generating:i,chatInstance:l,messageList:a,clearMessage:c}}const fd=K.forwardRef(function(e,t){const{resetBoundary:r}=Ul(),i=()=>r();return K.useImperativeHandle(t,()=>({hideError:i})),F.jsxs("div",{className:`w-full absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 flex items-center justify-center text-red-500 text-center py-2 ${e.className}`,children:[F.jsxs("div",{children:["Error：",e.fallbackProps.error]}),F.jsx("button",{className:"btn ml-1 btn-square btn-xs btn-ghost",onClick:i,children:F.jsx(Wc,{className:"w-[16px] h-[16px]"})})]})});function pd(n,e){const t={};return(n[n.length-1]===""?[...n,""]:n).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}const md=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,gd=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,yd={};function lo(n,e){return(yd.jsx?gd:md).test(n)}const bd=/[ \t\n\f\r]/g;function wd(n){return typeof n=="object"?n.type==="text"?uo(n.value):!1:uo(n)}function uo(n){return n.replace(bd,"")===""}class Er{constructor(e,t,r){this.property=e,this.normal=t,r&&(this.space=r)}}Er.prototype.property={};Er.prototype.normal={};Er.prototype.space=null;function Vl(n,e){const t={},r={};let i=-1;for(;++i<n.length;)Object.assign(t,n[i].property),Object.assign(r,n[i].normal);return new Er(t,r,e)}function Ms(n){return n.toLowerCase()}class We{constructor(e,t){this.property=e,this.attribute=t}}We.prototype.space=null;We.prototype.boolean=!1;We.prototype.booleanish=!1;We.prototype.overloadedBoolean=!1;We.prototype.number=!1;We.prototype.commaSeparated=!1;We.prototype.spaceSeparated=!1;We.prototype.commaOrSpaceSeparated=!1;We.prototype.mustUseProperty=!1;We.prototype.defined=!1;let _d=0;const U=an(),he=an(),ql=an(),E=an(),ie=an(),_n=an(),De=an();function an(){return 2**++_d}const Ds=Object.freeze(Object.defineProperty({__proto__:null,boolean:U,booleanish:he,commaOrSpaceSeparated:De,commaSeparated:_n,number:E,overloadedBoolean:ql,spaceSeparated:ie},Symbol.toStringTag,{value:"Module"})),cs=Object.keys(Ds);class fa extends We{constructor(e,t,r,i){let s=-1;if(super(e,t),co(this,"space",i),typeof r=="number")for(;++s<cs.length;){const a=cs[s];co(this,cs[s],(r&Ds[a])===Ds[a])}}}fa.prototype.defined=!0;function co(n,e,t){t&&(n[e]=t)}const vd={}.hasOwnProperty;function Rn(n){const e={},t={};let r;for(r in n.properties)if(vd.call(n.properties,r)){const i=n.properties[r],s=new fa(r,n.transform(n.attributes||{},r),i,n.space);n.mustUseProperty&&n.mustUseProperty.includes(r)&&(s.mustUseProperty=!0),e[r]=s,t[Ms(r)]=r,t[Ms(s.attribute)]=r}return new Er(e,t,n.space)}const Wl=Rn({space:"xlink",transform(n,e){return"xlink:"+e.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),Gl=Rn({space:"xml",transform(n,e){return"xml:"+e.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function Jl(n,e){return e in n?n[e]:e}function Kl(n,e){return Jl(n,e.toLowerCase())}const Xl=Rn({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:Kl,properties:{xmlns:null,xmlnsXLink:null}}),Ql=Rn({transform(n,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:he,ariaAutoComplete:null,ariaBusy:he,ariaChecked:he,ariaColCount:E,ariaColIndex:E,ariaColSpan:E,ariaControls:ie,ariaCurrent:null,ariaDescribedBy:ie,ariaDetails:null,ariaDisabled:he,ariaDropEffect:ie,ariaErrorMessage:null,ariaExpanded:he,ariaFlowTo:ie,ariaGrabbed:he,ariaHasPopup:null,ariaHidden:he,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:ie,ariaLevel:E,ariaLive:null,ariaModal:he,ariaMultiLine:he,ariaMultiSelectable:he,ariaOrientation:null,ariaOwns:ie,ariaPlaceholder:null,ariaPosInSet:E,ariaPressed:he,ariaReadOnly:he,ariaRelevant:null,ariaRequired:he,ariaRoleDescription:ie,ariaRowCount:E,ariaRowIndex:E,ariaRowSpan:E,ariaSelected:he,ariaSetSize:E,ariaSort:null,ariaValueMax:E,ariaValueMin:E,ariaValueNow:E,ariaValueText:null,role:null}}),xd=Rn({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:Kl,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:_n,acceptCharset:ie,accessKey:ie,action:null,allow:null,allowFullScreen:U,allowPaymentRequest:U,allowUserMedia:U,alt:null,as:null,async:U,autoCapitalize:null,autoComplete:ie,autoFocus:U,autoPlay:U,blocking:ie,capture:null,charSet:null,checked:U,cite:null,className:ie,cols:E,colSpan:null,content:null,contentEditable:he,controls:U,controlsList:ie,coords:E|_n,crossOrigin:null,data:null,dateTime:null,decoding:null,default:U,defer:U,dir:null,dirName:null,disabled:U,download:ql,draggable:he,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:U,formTarget:null,headers:ie,height:E,hidden:U,high:E,href:null,hrefLang:null,htmlFor:ie,httpEquiv:ie,id:null,imageSizes:null,imageSrcSet:null,inert:U,inputMode:null,integrity:null,is:null,isMap:U,itemId:null,itemProp:ie,itemRef:ie,itemScope:U,itemType:ie,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:U,low:E,manifest:null,max:null,maxLength:E,media:null,method:null,min:null,minLength:E,multiple:U,muted:U,name:null,nonce:null,noModule:U,noValidate:U,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:U,optimum:E,pattern:null,ping:ie,placeholder:null,playsInline:U,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:U,referrerPolicy:null,rel:ie,required:U,reversed:U,rows:E,rowSpan:E,sandbox:ie,scope:null,scoped:U,seamless:U,selected:U,shadowRootClonable:U,shadowRootDelegatesFocus:U,shadowRootMode:null,shape:null,size:E,sizes:null,slot:null,span:E,spellCheck:he,src:null,srcDoc:null,srcLang:null,srcSet:null,start:E,step:null,style:null,tabIndex:E,target:null,title:null,translate:null,type:null,typeMustMatch:U,useMap:null,value:he,width:E,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:ie,axis:null,background:null,bgColor:null,border:E,borderColor:null,bottomMargin:E,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:U,declare:U,event:null,face:null,frame:null,frameBorder:null,hSpace:E,leftMargin:E,link:null,longDesc:null,lowSrc:null,marginHeight:E,marginWidth:E,noResize:U,noHref:U,noShade:U,noWrap:U,object:null,profile:null,prompt:null,rev:null,rightMargin:E,rules:null,scheme:null,scrolling:he,standby:null,summary:null,text:null,topMargin:E,valueType:null,version:null,vAlign:null,vLink:null,vSpace:E,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:U,disableRemotePlayback:U,prefix:null,property:null,results:E,security:null,unselectable:null}}),kd=Rn({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:Jl,properties:{about:De,accentHeight:E,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:E,amplitude:E,arabicForm:null,ascent:E,attributeName:null,attributeType:null,azimuth:E,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:E,by:null,calcMode:null,capHeight:E,className:ie,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:E,diffuseConstant:E,direction:null,display:null,dur:null,divisor:E,dominantBaseline:null,download:U,dx:null,dy:null,edgeMode:null,editable:null,elevation:E,enableBackground:null,end:null,event:null,exponent:E,externalResourcesRequired:null,fill:null,fillOpacity:E,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:_n,g2:_n,glyphName:_n,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:E,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:E,horizOriginX:E,horizOriginY:E,id:null,ideographic:E,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:E,k:E,k1:E,k2:E,k3:E,k4:E,kernelMatrix:De,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:E,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:E,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:E,overlineThickness:E,paintOrder:null,panose1:null,path:null,pathLength:E,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:ie,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:E,pointsAtY:E,pointsAtZ:E,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:De,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:De,rev:De,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:De,requiredFeatures:De,requiredFonts:De,requiredFormats:De,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:E,specularExponent:E,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:E,strikethroughThickness:E,string:null,stroke:null,strokeDashArray:De,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:E,strokeOpacity:E,strokeWidth:null,style:null,surfaceScale:E,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:De,tabIndex:E,tableValues:null,target:null,targetX:E,targetY:E,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:De,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:E,underlineThickness:E,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:E,values:null,vAlphabetic:E,vMathematical:E,vectorEffect:null,vHanging:E,vIdeographic:E,version:null,vertAdvY:E,vertOriginX:E,vertOriginY:E,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:E,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),Sd=/^data[-\w.:]+$/i,ho=/-[a-z]/g,Ed=/[A-Z]/g;function Ad(n,e){const t=Ms(e);let r=e,i=We;if(t in n.normal)return n.property[n.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&Sd.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(ho,Id);r="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!ho.test(s)){let a=s.replace(Ed,Cd);a.charAt(0)!=="-"&&(a="-"+a),e="data"+a}}i=fa}return new i(r,e)}function Cd(n){return"-"+n.toLowerCase()}function Id(n){return n.charAt(1).toUpperCase()}const Pd={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},Td=Vl([Gl,Wl,Xl,Ql,xd],"html"),pa=Vl([Gl,Wl,Xl,Ql,kd],"svg");function Od(n){return n.join(" ").trim()}var Yl={},fo=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,Rd=/\n/g,Nd=/^\s*/,jd=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,Ld=/^:\s*/,$d=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,Md=/^[;\s]*/,Dd=/^\s+|\s+$/g,Bd=`
`,po="/",mo="*",Gt="",Fd="comment",zd="declaration",Ud=function(n,e){if(typeof n!="string")throw new TypeError("First argument must be a string");if(!n)return[];e=e||{};var t=1,r=1;function i(p){var w=p.match(Rd);w&&(t+=w.length);var y=p.lastIndexOf(Bd);r=~y?p.length-y:r+p.length}function s(){var p={line:t,column:r};return function(w){return w.position=new a(p),u(),w}}function a(p){this.start=p,this.end={line:t,column:r},this.source=e.source}a.prototype.content=n;function o(p){var w=new Error(e.source+":"+t+":"+r+": "+p);if(w.reason=p,w.filename=e.source,w.line=t,w.column=r,w.source=n,!e.silent)throw w}function l(p){var w=p.exec(n);if(w){var y=w[0];return i(y),n=n.slice(y.length),w}}function u(){l(Nd)}function c(p){var w;for(p=p||[];w=d();)w!==!1&&p.push(w);return p}function d(){var p=s();if(!(po!=n.charAt(0)||mo!=n.charAt(1))){for(var w=2;Gt!=n.charAt(w)&&(mo!=n.charAt(w)||po!=n.charAt(w+1));)++w;if(w+=2,Gt===n.charAt(w-1))return o("End of comment missing");var y=n.slice(2,w-2);return r+=2,i(y),n=n.slice(w),r+=2,p({type:Fd,comment:y})}}function f(){var p=s(),w=l(jd);if(w){if(d(),!l(Ld))return o("property missing ':'");var y=l($d),b=p({type:zd,property:go(w[0].replace(fo,Gt)),value:y?go(y[0].replace(fo,Gt)):Gt});return l(Md),b}}function h(){var p=[];c(p);for(var w;w=f();)w!==!1&&(p.push(w),c(p));return p}return u(),h()};function go(n){return n?n.replace(Dd,Gt):Gt}var Hd=ao&&ao.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Yl,"__esModule",{value:!0});var Zd=Hd(Ud);function Vd(n,e){var t=null;if(!n||typeof n!="string")return t;var r=(0,Zd.default)(n),i=typeof e=="function";return r.forEach(function(s){if(s.type==="declaration"){var a=s.property,o=s.value;i?e(a,o,s):o&&(t=t||{},t[a]=o)}}),t}var yo=Yl.default=Vd;const qd=yo.default||yo,eu=tu("end"),ma=tu("start");function tu(n){return e;function e(t){const r=t&&t.position&&t.position[n]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function Wd(n){const e=ma(n),t=eu(n);if(e&&t)return{start:e,end:t}}function Qn(n){return!n||typeof n!="object"?"":"position"in n||"type"in n?bo(n.position):"start"in n||"end"in n?bo(n):"line"in n||"column"in n?Bs(n):""}function Bs(n){return wo(n&&n.line)+":"+wo(n&&n.column)}function bo(n){return Bs(n&&n.start)+"-"+Bs(n&&n.end)}function wo(n){return n&&typeof n=="number"?n:1}class Se extends Error{constructor(e,t,r){super(),typeof t=="string"&&(r=t,t=void 0);let i="",s={},a=!1;if(t&&("line"in t&&"column"in t?s={place:t}:"start"in t&&"end"in t?s={place:t}:"type"in t?s={ancestors:[t],place:t.position}:s={...t}),typeof e=="string"?i=e:!s.cause&&e&&(a=!0,i=e.message,s.cause=e),!s.ruleId&&!s.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?s.ruleId=r:(s.source=r.slice(0,l),s.ruleId=r.slice(l+1))}if(!s.place&&s.ancestors&&s.ancestors){const l=s.ancestors[s.ancestors.length-1];l&&(s.place=l.position)}const o=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file,this.message=i,this.line=o?o.line:void 0,this.name=Qn(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=a&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual,this.expected,this.note,this.url}}Se.prototype.file="";Se.prototype.name="";Se.prototype.reason="";Se.prototype.message="";Se.prototype.stack="";Se.prototype.column=void 0;Se.prototype.line=void 0;Se.prototype.ancestors=void 0;Se.prototype.cause=void 0;Se.prototype.fatal=void 0;Se.prototype.place=void 0;Se.prototype.ruleId=void 0;Se.prototype.source=void 0;const ga={}.hasOwnProperty,Gd=new Map,Jd=/[A-Z]/g,Kd=/-([a-z])/g,Xd=new Set(["table","tbody","thead","tfoot","tr"]),Qd=new Set(["td","th"]),nu="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function Yd(n,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const t=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=oh(t,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=ah(t,e.jsx,e.jsxs)}const i={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:t,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?pa:Td,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},s=ru(i,n,void 0);return s&&typeof s!="string"?s:i.create(n,i.Fragment,{children:s||void 0},void 0)}function ru(n,e,t){if(e.type==="element")return eh(n,e,t);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return th(n,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return rh(n,e,t);if(e.type==="mdxjsEsm")return nh(n,e);if(e.type==="root")return ih(n,e,t);if(e.type==="text")return sh(n,e)}function eh(n,e,t){const r=n.schema;let i=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(i=pa,n.schema=i),n.ancestors.push(e);const s=su(n,e.tagName,!1),a=lh(n,e);let o=ba(n,e);return Xd.has(e.tagName)&&(o=o.filter(function(l){return typeof l=="string"?!wd(l):!0})),iu(n,a,s,e),ya(a,o),n.ancestors.pop(),n.schema=r,n.create(e,s,a,t)}function th(n,e){if(e.data&&e.data.estree&&n.evaluater){const r=e.data.estree.body[0];return r.type,n.evaluater.evaluateExpression(r.expression)}ir(n,e.position)}function nh(n,e){if(e.data&&e.data.estree&&n.evaluater)return n.evaluater.evaluateProgram(e.data.estree);ir(n,e.position)}function rh(n,e,t){const r=n.schema;let i=r;e.name==="svg"&&r.space==="html"&&(i=pa,n.schema=i),n.ancestors.push(e);const s=e.name===null?n.Fragment:su(n,e.name,!0),a=uh(n,e),o=ba(n,e);return iu(n,a,s,e),ya(a,o),n.ancestors.pop(),n.schema=r,n.create(e,s,a,t)}function ih(n,e,t){const r={};return ya(r,ba(n,e)),n.create(e,n.Fragment,r,t)}function sh(n,e){return e.value}function iu(n,e,t,r){typeof t!="string"&&t!==n.Fragment&&n.passNode&&(e.node=r)}function ya(n,e){if(e.length>0){const t=e.length>1?e:e[0];t&&(n.children=t)}}function ah(n,e,t){return r;function r(i,s,a,o){const u=Array.isArray(a.children)?t:e;return o?u(s,a,o):u(s,a)}}function oh(n,e){return t;function t(r,i,s,a){const o=Array.isArray(s.children),l=ma(r);return e(i,s,a,o,{columnNumber:l?l.column-1:void 0,fileName:n,lineNumber:l?l.line:void 0},void 0)}}function lh(n,e){const t={};let r,i;for(i in e.properties)if(i!=="children"&&ga.call(e.properties,i)){const s=ch(n,i,e.properties[i]);if(s){const[a,o]=s;n.tableCellAlignToStyle&&a==="align"&&typeof o=="string"&&Qd.has(e.tagName)?r=o:t[a]=o}}if(r){const s=t.style||(t.style={});s[n.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return t}function uh(n,e){const t={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&n.evaluater){const s=r.data.estree.body[0];s.type;const a=s.expression;a.type;const o=a.properties[0];o.type,Object.assign(t,n.evaluater.evaluateExpression(o.argument))}else ir(n,e.position);else{const i=r.name;let s;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&n.evaluater){const o=r.value.data.estree.body[0];o.type,s=n.evaluater.evaluateExpression(o.expression)}else ir(n,e.position);else s=r.value===null?!0:r.value;t[i]=s}return t}function ba(n,e){const t=[];let r=-1;const i=n.passKeys?new Map:Gd;for(;++r<e.children.length;){const s=e.children[r];let a;if(n.passKeys){const l=s.type==="element"?s.tagName:s.type==="mdxJsxFlowElement"||s.type==="mdxJsxTextElement"?s.name:void 0;if(l){const u=i.get(l)||0;a=l+"-"+u,i.set(l,u+1)}}const o=ru(n,s,a);o!==void 0&&t.push(o)}return t}function ch(n,e,t){const r=Ad(n.schema,e);if(!(t==null||typeof t=="number"&&Number.isNaN(t))){if(Array.isArray(t)&&(t=r.commaSeparated?pd(t):Od(t)),r.property==="style"){let i=typeof t=="object"?t:dh(n,String(t));return n.stylePropertyNameCase==="css"&&(i=hh(i)),["style",i]}return[n.elementAttributeNameCase==="react"&&r.space?Pd[r.property]||r.property:r.attribute,t]}}function dh(n,e){const t={};try{qd(e,r)}catch(i){if(!n.ignoreInvalidStyle){const s=i,a=new Se("Cannot parse `style` attribute",{ancestors:n.ancestors,cause:s,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw a.file=n.filePath||void 0,a.url=nu+"#cannot-parse-style-attribute",a}}return t;function r(i,s){let a=i;a.slice(0,2)!=="--"&&(a.slice(0,4)==="-ms-"&&(a="ms-"+a.slice(4)),a=a.replace(Kd,ph)),t[a]=s}}function su(n,e,t){let r;if(!t)r={type:"Literal",value:e};else if(e.includes(".")){const i=e.split(".");let s=-1,a;for(;++s<i.length;){const o=lo(i[s])?{type:"Identifier",name:i[s]}:{type:"Literal",value:i[s]};a=a?{type:"MemberExpression",object:a,property:o,computed:!!(s&&o.type==="Literal"),optional:!1}:o}r=a}else r=lo(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const i=r.value;return ga.call(n.components,i)?n.components[i]:i}if(n.evaluater)return n.evaluater.evaluateExpression(r);ir(n)}function ir(n,e){const t=new Se("Cannot handle MDX estrees without `createEvaluater`",{ancestors:n.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw t.file=n.filePath||void 0,t.url=nu+"#cannot-handle-mdx-estrees-without-createevaluater",t}function hh(n){const e={};let t;for(t in n)ga.call(n,t)&&(e[fh(t)]=n[t]);return e}function fh(n){let e=n.replace(Jd,mh);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function ph(n,e){return e.toUpperCase()}function mh(n){return"-"+n.toLowerCase()}const ds={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},gh={};function yh(n,e){const t=gh,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,i=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return au(n,r,i)}function au(n,e,t){if(bh(n)){if("value"in n)return n.type==="html"&&!t?"":n.value;if(e&&"alt"in n&&n.alt)return n.alt;if("children"in n)return _o(n.children,e,t)}return Array.isArray(n)?_o(n,e,t):""}function _o(n,e,t){const r=[];let i=-1;for(;++i<n.length;)r[i]=au(n[i],e,t);return r.join("")}function bh(n){return!!(n&&typeof n=="object")}const vo=document.createElement("i");function wa(n){const e="&"+n+";";vo.innerHTML=e;const t=vo.textContent;return t.charCodeAt(t.length-1)===59&&n!=="semi"||t===e?!1:t}function Tt(n,e,t,r){const i=n.length;let s=0,a;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,t=t>0?t:0,r.length<1e4)a=Array.from(r),a.unshift(e,t),n.splice(...a);else for(t&&n.splice(e,t);s<r.length;)a=r.slice(s,s+1e4),a.unshift(e,0),n.splice(...a),s+=1e4,e+=1e4}function Ze(n,e){return n.length>0?(Tt(n,n.length,0,e),n):e}const xo={}.hasOwnProperty;function wh(n){const e={};let t=-1;for(;++t<n.length;)_h(e,n[t]);return e}function _h(n,e){let t;for(t in e){const i=(xo.call(n,t)?n[t]:void 0)||(n[t]={}),s=e[t];let a;if(s)for(a in s){xo.call(i,a)||(i[a]=[]);const o=s[a];vh(i[a],Array.isArray(o)?o:o?[o]:[])}}}function vh(n,e){let t=-1;const r=[];for(;++t<e.length;)(e[t].add==="after"?n:r).push(e[t]);Tt(n,0,0,r)}function ou(n,e){const t=Number.parseInt(n,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"�":String.fromCodePoint(t)}function vn(n){return n.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const pt=Zt(/[A-Za-z]/),Fe=Zt(/[\dA-Za-z]/),xh=Zt(/[#-'*+\--9=?A-Z^-~]/);function Fs(n){return n!==null&&(n<32||n===127)}const zs=Zt(/\d/),kh=Zt(/[\dA-Fa-f]/),Sh=Zt(/[!-/:-@[-`{-~]/);function B(n){return n!==null&&n<-2}function Le(n){return n!==null&&(n<0||n===32)}function Y(n){return n===-2||n===-1||n===32}const Eh=Zt(new RegExp("\\p{P}|\\p{S}","u")),Ah=Zt(/\s/);function Zt(n){return e;function e(t){return t!==null&&t>-1&&n.test(String.fromCharCode(t))}}function Nn(n){const e=[];let t=-1,r=0,i=0;for(;++t<n.length;){const s=n.charCodeAt(t);let a="";if(s===37&&Fe(n.charCodeAt(t+1))&&Fe(n.charCodeAt(t+2)))i=2;else if(s<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(s))||(a=String.fromCharCode(s));else if(s>55295&&s<57344){const o=n.charCodeAt(t+1);s<56320&&o>56319&&o<57344?(a=String.fromCharCode(s,o),i=1):a="�"}else a=String.fromCharCode(s);a&&(e.push(n.slice(r,t),encodeURIComponent(a)),r=t+i+1,a=""),i&&(t+=i,i=0)}return e.join("")+n.slice(r)}function se(n,e,t,r){const i=r?r-1:Number.POSITIVE_INFINITY;let s=0;return a;function a(l){return Y(l)?(n.enter(t),o(l)):e(l)}function o(l){return Y(l)&&s++<i?(n.consume(l),o):(n.exit(t),e(l))}}const Ch={tokenize:Ih};function Ih(n){const e=n.attempt(this.parser.constructs.contentInitial,r,i);let t;return e;function r(o){if(o===null){n.consume(o);return}return n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),se(n,e,"linePrefix")}function i(o){return n.enter("paragraph"),s(o)}function s(o){const l=n.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=l),t=l,a(o)}function a(o){if(o===null){n.exit("chunkText"),n.exit("paragraph"),n.consume(o);return}return B(o)?(n.consume(o),n.exit("chunkText"),s):(n.consume(o),a)}}const Ph={tokenize:Th},ko={tokenize:Oh};function Th(n){const e=this,t=[];let r=0,i,s,a;return o;function o(v){if(r<t.length){const P=t[r];return e.containerState=P[1],n.attempt(P[0].continuation,l,u)(v)}return u(v)}function l(v){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,i&&_();const P=e.events.length;let C=P,x;for(;C--;)if(e.events[C][0]==="exit"&&e.events[C][1].type==="chunkFlow"){x=e.events[C][1].end;break}b(r);let N=P;for(;N<e.events.length;)e.events[N][1].end=Object.assign({},x),N++;return Tt(e.events,C+1,0,e.events.slice(P)),e.events.length=N,u(v)}return o(v)}function u(v){if(r===t.length){if(!i)return f(v);if(i.currentConstruct&&i.currentConstruct.concrete)return p(v);e.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return e.containerState={},n.check(ko,c,d)(v)}function c(v){return i&&_(),b(r),f(v)}function d(v){return e.parser.lazy[e.now().line]=r!==t.length,a=e.now().offset,p(v)}function f(v){return e.containerState={},n.attempt(ko,h,p)(v)}function h(v){return r++,t.push([e.currentConstruct,e.containerState]),f(v)}function p(v){if(v===null){i&&_(),b(0),n.consume(v);return}return i=i||e.parser.flow(e.now()),n.enter("chunkFlow",{contentType:"flow",previous:s,_tokenizer:i}),w(v)}function w(v){if(v===null){y(n.exit("chunkFlow"),!0),b(0),n.consume(v);return}return B(v)?(n.consume(v),y(n.exit("chunkFlow")),r=0,e.interrupt=void 0,o):(n.consume(v),w)}function y(v,P){const C=e.sliceStream(v);if(P&&C.push(null),v.previous=s,s&&(s.next=v),s=v,i.defineSkip(v.start),i.write(C),e.parser.lazy[v.start.line]){let x=i.events.length;for(;x--;)if(i.events[x][1].start.offset<a&&(!i.events[x][1].end||i.events[x][1].end.offset>a))return;const N=e.events.length;let ee=N,D,Q;for(;ee--;)if(e.events[ee][0]==="exit"&&e.events[ee][1].type==="chunkFlow"){if(D){Q=e.events[ee][1].end;break}D=!0}for(b(r),x=N;x<e.events.length;)e.events[x][1].end=Object.assign({},Q),x++;Tt(e.events,ee+1,0,e.events.slice(N)),e.events.length=x}}function b(v){let P=t.length;for(;P-- >v;){const C=t[P];e.containerState=C[1],C[0].exit.call(e,n)}t.length=v}function _(){i.write([null]),s=void 0,i=void 0,e.containerState._closeFlow=void 0}}function Oh(n,e,t){return se(n,n.attempt(this.parser.constructs.document,e,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function So(n){if(n===null||Le(n)||Ah(n))return 1;if(Eh(n))return 2}function _a(n,e,t){const r=[];let i=-1;for(;++i<n.length;){const s=n[i].resolveAll;s&&!r.includes(s)&&(e=s(e,t),r.push(s))}return e}const Us={name:"attention",tokenize:Nh,resolveAll:Rh};function Rh(n,e){let t=-1,r,i,s,a,o,l,u,c;for(;++t<n.length;)if(n[t][0]==="enter"&&n[t][1].type==="attentionSequence"&&n[t][1]._close){for(r=t;r--;)if(n[r][0]==="exit"&&n[r][1].type==="attentionSequence"&&n[r][1]._open&&e.sliceSerialize(n[r][1]).charCodeAt(0)===e.sliceSerialize(n[t][1]).charCodeAt(0)){if((n[r][1]._close||n[t][1]._open)&&(n[t][1].end.offset-n[t][1].start.offset)%3&&!((n[r][1].end.offset-n[r][1].start.offset+n[t][1].end.offset-n[t][1].start.offset)%3))continue;l=n[r][1].end.offset-n[r][1].start.offset>1&&n[t][1].end.offset-n[t][1].start.offset>1?2:1;const d=Object.assign({},n[r][1].end),f=Object.assign({},n[t][1].start);Eo(d,-l),Eo(f,l),a={type:l>1?"strongSequence":"emphasisSequence",start:d,end:Object.assign({},n[r][1].end)},o={type:l>1?"strongSequence":"emphasisSequence",start:Object.assign({},n[t][1].start),end:f},s={type:l>1?"strongText":"emphasisText",start:Object.assign({},n[r][1].end),end:Object.assign({},n[t][1].start)},i={type:l>1?"strong":"emphasis",start:Object.assign({},a.start),end:Object.assign({},o.end)},n[r][1].end=Object.assign({},a.start),n[t][1].start=Object.assign({},o.end),u=[],n[r][1].end.offset-n[r][1].start.offset&&(u=Ze(u,[["enter",n[r][1],e],["exit",n[r][1],e]])),u=Ze(u,[["enter",i,e],["enter",a,e],["exit",a,e],["enter",s,e]]),u=Ze(u,_a(e.parser.constructs.insideSpan.null,n.slice(r+1,t),e)),u=Ze(u,[["exit",s,e],["enter",o,e],["exit",o,e],["exit",i,e]]),n[t][1].end.offset-n[t][1].start.offset?(c=2,u=Ze(u,[["enter",n[t][1],e],["exit",n[t][1],e]])):c=0,Tt(n,r-1,t-r+3,u),t=r+u.length-c-2;break}}for(t=-1;++t<n.length;)n[t][1].type==="attentionSequence"&&(n[t][1].type="data");return n}function Nh(n,e){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,i=So(r);let s;return a;function a(l){return s=l,n.enter("attentionSequence"),o(l)}function o(l){if(l===s)return n.consume(l),o;const u=n.exit("attentionSequence"),c=So(l),d=!c||c===2&&i||t.includes(l),f=!i||i===2&&c||t.includes(r);return u._open=!!(s===42?d:d&&(i||!f)),u._close=!!(s===42?f:f&&(c||!d)),e(l)}}function Eo(n,e){n.column+=e,n.offset+=e,n._bufferIndex+=e}const jh={name:"autolink",tokenize:Lh};function Lh(n,e,t){let r=0;return i;function i(h){return n.enter("autolink"),n.enter("autolinkMarker"),n.consume(h),n.exit("autolinkMarker"),n.enter("autolinkProtocol"),s}function s(h){return pt(h)?(n.consume(h),a):h===64?t(h):u(h)}function a(h){return h===43||h===45||h===46||Fe(h)?(r=1,o(h)):u(h)}function o(h){return h===58?(n.consume(h),r=0,l):(h===43||h===45||h===46||Fe(h))&&r++<32?(n.consume(h),o):(r=0,u(h))}function l(h){return h===62?(n.exit("autolinkProtocol"),n.enter("autolinkMarker"),n.consume(h),n.exit("autolinkMarker"),n.exit("autolink"),e):h===null||h===32||h===60||Fs(h)?t(h):(n.consume(h),l)}function u(h){return h===64?(n.consume(h),c):xh(h)?(n.consume(h),u):t(h)}function c(h){return Fe(h)?d(h):t(h)}function d(h){return h===46?(n.consume(h),r=0,c):h===62?(n.exit("autolinkProtocol").type="autolinkEmail",n.enter("autolinkMarker"),n.consume(h),n.exit("autolinkMarker"),n.exit("autolink"),e):f(h)}function f(h){if((h===45||Fe(h))&&r++<63){const p=h===45?f:d;return n.consume(h),p}return t(h)}}const Xi={tokenize:$h,partial:!0};function $h(n,e,t){return r;function r(s){return Y(s)?se(n,i,"linePrefix")(s):i(s)}function i(s){return s===null||B(s)?e(s):t(s)}}const lu={name:"blockQuote",tokenize:Mh,continuation:{tokenize:Dh},exit:Bh};function Mh(n,e,t){const r=this;return i;function i(a){if(a===62){const o=r.containerState;return o.open||(n.enter("blockQuote",{_container:!0}),o.open=!0),n.enter("blockQuotePrefix"),n.enter("blockQuoteMarker"),n.consume(a),n.exit("blockQuoteMarker"),s}return t(a)}function s(a){return Y(a)?(n.enter("blockQuotePrefixWhitespace"),n.consume(a),n.exit("blockQuotePrefixWhitespace"),n.exit("blockQuotePrefix"),e):(n.exit("blockQuotePrefix"),e(a))}}function Dh(n,e,t){const r=this;return i;function i(a){return Y(a)?se(n,s,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a):s(a)}function s(a){return n.attempt(lu,e,t)(a)}}function Bh(n){n.exit("blockQuote")}const uu={name:"characterEscape",tokenize:Fh};function Fh(n,e,t){return r;function r(s){return n.enter("characterEscape"),n.enter("escapeMarker"),n.consume(s),n.exit("escapeMarker"),i}function i(s){return Sh(s)?(n.enter("characterEscapeValue"),n.consume(s),n.exit("characterEscapeValue"),n.exit("characterEscape"),e):t(s)}}const cu={name:"characterReference",tokenize:zh};function zh(n,e,t){const r=this;let i=0,s,a;return o;function o(d){return n.enter("characterReference"),n.enter("characterReferenceMarker"),n.consume(d),n.exit("characterReferenceMarker"),l}function l(d){return d===35?(n.enter("characterReferenceMarkerNumeric"),n.consume(d),n.exit("characterReferenceMarkerNumeric"),u):(n.enter("characterReferenceValue"),s=31,a=Fe,c(d))}function u(d){return d===88||d===120?(n.enter("characterReferenceMarkerHexadecimal"),n.consume(d),n.exit("characterReferenceMarkerHexadecimal"),n.enter("characterReferenceValue"),s=6,a=kh,c):(n.enter("characterReferenceValue"),s=7,a=zs,c(d))}function c(d){if(d===59&&i){const f=n.exit("characterReferenceValue");return a===Fe&&!wa(r.sliceSerialize(f))?t(d):(n.enter("characterReferenceMarker"),n.consume(d),n.exit("characterReferenceMarker"),n.exit("characterReference"),e)}return a(d)&&i++<s?(n.consume(d),c):t(d)}}const Ao={tokenize:Hh,partial:!0},Co={name:"codeFenced",tokenize:Uh,concrete:!0};function Uh(n,e,t){const r=this,i={tokenize:C,partial:!0};let s=0,a=0,o;return l;function l(x){return u(x)}function u(x){const N=r.events[r.events.length-1];return s=N&&N[1].type==="linePrefix"?N[2].sliceSerialize(N[1],!0).length:0,o=x,n.enter("codeFenced"),n.enter("codeFencedFence"),n.enter("codeFencedFenceSequence"),c(x)}function c(x){return x===o?(a++,n.consume(x),c):a<3?t(x):(n.exit("codeFencedFenceSequence"),Y(x)?se(n,d,"whitespace")(x):d(x))}function d(x){return x===null||B(x)?(n.exit("codeFencedFence"),r.interrupt?e(x):n.check(Ao,w,P)(x)):(n.enter("codeFencedFenceInfo"),n.enter("chunkString",{contentType:"string"}),f(x))}function f(x){return x===null||B(x)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),d(x)):Y(x)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),se(n,h,"whitespace")(x)):x===96&&x===o?t(x):(n.consume(x),f)}function h(x){return x===null||B(x)?d(x):(n.enter("codeFencedFenceMeta"),n.enter("chunkString",{contentType:"string"}),p(x))}function p(x){return x===null||B(x)?(n.exit("chunkString"),n.exit("codeFencedFenceMeta"),d(x)):x===96&&x===o?t(x):(n.consume(x),p)}function w(x){return n.attempt(i,P,y)(x)}function y(x){return n.enter("lineEnding"),n.consume(x),n.exit("lineEnding"),b}function b(x){return s>0&&Y(x)?se(n,_,"linePrefix",s+1)(x):_(x)}function _(x){return x===null||B(x)?n.check(Ao,w,P)(x):(n.enter("codeFlowValue"),v(x))}function v(x){return x===null||B(x)?(n.exit("codeFlowValue"),_(x)):(n.consume(x),v)}function P(x){return n.exit("codeFenced"),e(x)}function C(x,N,ee){let D=0;return Q;function Q(J){return x.enter("lineEnding"),x.consume(J),x.exit("lineEnding"),$}function $(J){return x.enter("codeFencedFence"),Y(J)?se(x,L,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(J):L(J)}function L(J){return J===o?(x.enter("codeFencedFenceSequence"),ae(J)):ee(J)}function ae(J){return J===o?(D++,x.consume(J),ae):D>=a?(x.exit("codeFencedFenceSequence"),Y(J)?se(x,de,"whitespace")(J):de(J)):ee(J)}function de(J){return J===null||B(J)?(x.exit("codeFencedFence"),N(J)):ee(J)}}}function Hh(n,e,t){const r=this;return i;function i(a){return a===null?t(a):(n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),s)}function s(a){return r.parser.lazy[r.now().line]?t(a):e(a)}}const hs={name:"codeIndented",tokenize:Vh},Zh={tokenize:qh,partial:!0};function Vh(n,e,t){const r=this;return i;function i(u){return n.enter("codeIndented"),se(n,s,"linePrefix",5)(u)}function s(u){const c=r.events[r.events.length-1];return c&&c[1].type==="linePrefix"&&c[2].sliceSerialize(c[1],!0).length>=4?a(u):t(u)}function a(u){return u===null?l(u):B(u)?n.attempt(Zh,a,l)(u):(n.enter("codeFlowValue"),o(u))}function o(u){return u===null||B(u)?(n.exit("codeFlowValue"),a(u)):(n.consume(u),o)}function l(u){return n.exit("codeIndented"),e(u)}}function qh(n,e,t){const r=this;return i;function i(a){return r.parser.lazy[r.now().line]?t(a):B(a)?(n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),i):se(n,s,"linePrefix",5)(a)}function s(a){const o=r.events[r.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(a):B(a)?i(a):t(a)}}const Wh={name:"codeText",tokenize:Kh,resolve:Gh,previous:Jh};function Gh(n){let e=n.length-4,t=3,r,i;if((n[t][1].type==="lineEnding"||n[t][1].type==="space")&&(n[e][1].type==="lineEnding"||n[e][1].type==="space")){for(r=t;++r<e;)if(n[r][1].type==="codeTextData"){n[t][1].type="codeTextPadding",n[e][1].type="codeTextPadding",t+=2,e-=2;break}}for(r=t-1,e++;++r<=e;)i===void 0?r!==e&&n[r][1].type!=="lineEnding"&&(i=r):(r===e||n[r][1].type==="lineEnding")&&(n[i][1].type="codeTextData",r!==i+2&&(n[i][1].end=n[r-1][1].end,n.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return n}function Jh(n){return n!==96||this.events[this.events.length-1][1].type==="characterEscape"}function Kh(n,e,t){let r=0,i,s;return a;function a(d){return n.enter("codeText"),n.enter("codeTextSequence"),o(d)}function o(d){return d===96?(n.consume(d),r++,o):(n.exit("codeTextSequence"),l(d))}function l(d){return d===null?t(d):d===32?(n.enter("space"),n.consume(d),n.exit("space"),l):d===96?(s=n.enter("codeTextSequence"),i=0,c(d)):B(d)?(n.enter("lineEnding"),n.consume(d),n.exit("lineEnding"),l):(n.enter("codeTextData"),u(d))}function u(d){return d===null||d===32||d===96||B(d)?(n.exit("codeTextData"),l(d)):(n.consume(d),u)}function c(d){return d===96?(n.consume(d),i++,c):i===r?(n.exit("codeTextSequence"),n.exit("codeText"),e(d)):(s.type="codeTextData",u(d))}}class Xh{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const r=t??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,t,r){const i=t||0;this.setCursor(Math.trunc(e));const s=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return r&&Dn(this.left,r),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),Dn(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),Dn(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);Dn(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);Dn(this.left,t.reverse())}}}function Dn(n,e){let t=0;if(e.length<1e4)n.push(...e);else for(;t<e.length;)n.push(...e.slice(t,t+1e4)),t+=1e4}function du(n){const e={};let t=-1,r,i,s,a,o,l,u;const c=new Xh(n);for(;++t<c.length;){for(;t in e;)t=e[t];if(r=c.get(t),t&&r[1].type==="chunkFlow"&&c.get(t-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,s=0,s<l.length&&l[s][1].type==="lineEndingBlank"&&(s+=2),s<l.length&&l[s][1].type==="content"))for(;++s<l.length&&l[s][1].type!=="content";)l[s][1].type==="chunkText"&&(l[s][1]._isInFirstContentOfListItem=!0,s++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,Qh(c,t)),t=e[t],u=!0);else if(r[1]._container){for(s=t,i=void 0;s--&&(a=c.get(s),a[1].type==="lineEnding"||a[1].type==="lineEndingBlank");)a[0]==="enter"&&(i&&(c.get(i)[1].type="lineEndingBlank"),a[1].type="lineEnding",i=s);i&&(r[1].end=Object.assign({},c.get(i)[1].start),o=c.slice(i,t),o.unshift(r),c.splice(i,t-i+1,o))}}return Tt(n,0,Number.POSITIVE_INFINITY,c.slice(0)),!u}function Qh(n,e){const t=n.get(e)[1],r=n.get(e)[2];let i=e-1;const s=[],a=t._tokenizer||r.parser[t.contentType](t.start),o=a.events,l=[],u={};let c,d,f=-1,h=t,p=0,w=0;const y=[w];for(;h;){for(;n.get(++i)[1]!==h;);s.push(i),h._tokenizer||(c=r.sliceStream(h),h.next||c.push(null),d&&a.defineSkip(h.start),h._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(c),h._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),d=h,h=h.next}for(h=t;++f<o.length;)o[f][0]==="exit"&&o[f-1][0]==="enter"&&o[f][1].type===o[f-1][1].type&&o[f][1].start.line!==o[f][1].end.line&&(w=f+1,y.push(w),h._tokenizer=void 0,h.previous=void 0,h=h.next);for(a.events=[],h?(h._tokenizer=void 0,h.previous=void 0):y.pop(),f=y.length;f--;){const b=o.slice(y[f],y[f+1]),_=s.pop();l.push([_,_+b.length-1]),n.splice(_,2,b)}for(l.reverse(),f=-1;++f<l.length;)u[p+l[f][0]]=p+l[f][1],p+=l[f][1]-l[f][0]-1;return u}const Yh={tokenize:nf,resolve:tf},ef={tokenize:rf,partial:!0};function tf(n){return du(n),n}function nf(n,e){let t;return r;function r(o){return n.enter("content"),t=n.enter("chunkContent",{contentType:"content"}),i(o)}function i(o){return o===null?s(o):B(o)?n.check(ef,a,s)(o):(n.consume(o),i)}function s(o){return n.exit("chunkContent"),n.exit("content"),e(o)}function a(o){return n.consume(o),n.exit("chunkContent"),t.next=n.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,i}}function rf(n,e,t){const r=this;return i;function i(a){return n.exit("chunkContent"),n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),se(n,s,"linePrefix")}function s(a){if(a===null||B(a))return t(a);const o=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(a):n.interrupt(r.parser.constructs.flow,t,e)(a)}}function hu(n,e,t,r,i,s,a,o,l){const u=l||Number.POSITIVE_INFINITY;let c=0;return d;function d(b){return b===60?(n.enter(r),n.enter(i),n.enter(s),n.consume(b),n.exit(s),f):b===null||b===32||b===41||Fs(b)?t(b):(n.enter(r),n.enter(a),n.enter(o),n.enter("chunkString",{contentType:"string"}),w(b))}function f(b){return b===62?(n.enter(s),n.consume(b),n.exit(s),n.exit(i),n.exit(r),e):(n.enter(o),n.enter("chunkString",{contentType:"string"}),h(b))}function h(b){return b===62?(n.exit("chunkString"),n.exit(o),f(b)):b===null||b===60||B(b)?t(b):(n.consume(b),b===92?p:h)}function p(b){return b===60||b===62||b===92?(n.consume(b),h):h(b)}function w(b){return!c&&(b===null||b===41||Le(b))?(n.exit("chunkString"),n.exit(o),n.exit(a),n.exit(r),e(b)):c<u&&b===40?(n.consume(b),c++,w):b===41?(n.consume(b),c--,w):b===null||b===32||b===40||Fs(b)?t(b):(n.consume(b),b===92?y:w)}function y(b){return b===40||b===41||b===92?(n.consume(b),w):w(b)}}function fu(n,e,t,r,i,s){const a=this;let o=0,l;return u;function u(h){return n.enter(r),n.enter(i),n.consume(h),n.exit(i),n.enter(s),c}function c(h){return o>999||h===null||h===91||h===93&&!l||h===94&&!o&&"_hiddenFootnoteSupport"in a.parser.constructs?t(h):h===93?(n.exit(s),n.enter(i),n.consume(h),n.exit(i),n.exit(r),e):B(h)?(n.enter("lineEnding"),n.consume(h),n.exit("lineEnding"),c):(n.enter("chunkString",{contentType:"string"}),d(h))}function d(h){return h===null||h===91||h===93||B(h)||o++>999?(n.exit("chunkString"),c(h)):(n.consume(h),l||(l=!Y(h)),h===92?f:d)}function f(h){return h===91||h===92||h===93?(n.consume(h),o++,d):d(h)}}function pu(n,e,t,r,i,s){let a;return o;function o(f){return f===34||f===39||f===40?(n.enter(r),n.enter(i),n.consume(f),n.exit(i),a=f===40?41:f,l):t(f)}function l(f){return f===a?(n.enter(i),n.consume(f),n.exit(i),n.exit(r),e):(n.enter(s),u(f))}function u(f){return f===a?(n.exit(s),l(a)):f===null?t(f):B(f)?(n.enter("lineEnding"),n.consume(f),n.exit("lineEnding"),se(n,u,"linePrefix")):(n.enter("chunkString",{contentType:"string"}),c(f))}function c(f){return f===a||f===null||B(f)?(n.exit("chunkString"),u(f)):(n.consume(f),f===92?d:c)}function d(f){return f===a||f===92?(n.consume(f),c):c(f)}}function Yn(n,e){let t;return r;function r(i){return B(i)?(n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),t=!0,r):Y(i)?se(n,r,t?"linePrefix":"lineSuffix")(i):e(i)}}const sf={name:"definition",tokenize:of},af={tokenize:lf,partial:!0};function of(n,e,t){const r=this;let i;return s;function s(h){return n.enter("definition"),a(h)}function a(h){return fu.call(r,n,o,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(h)}function o(h){return i=vn(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),h===58?(n.enter("definitionMarker"),n.consume(h),n.exit("definitionMarker"),l):t(h)}function l(h){return Le(h)?Yn(n,u)(h):u(h)}function u(h){return hu(n,c,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(h)}function c(h){return n.attempt(af,d,d)(h)}function d(h){return Y(h)?se(n,f,"whitespace")(h):f(h)}function f(h){return h===null||B(h)?(n.exit("definition"),r.parser.defined.push(i),e(h)):t(h)}}function lf(n,e,t){return r;function r(o){return Le(o)?Yn(n,i)(o):t(o)}function i(o){return pu(n,s,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function s(o){return Y(o)?se(n,a,"whitespace")(o):a(o)}function a(o){return o===null||B(o)?e(o):t(o)}}const uf={name:"hardBreakEscape",tokenize:cf};function cf(n,e,t){return r;function r(s){return n.enter("hardBreakEscape"),n.consume(s),i}function i(s){return B(s)?(n.exit("hardBreakEscape"),e(s)):t(s)}}const df={name:"headingAtx",tokenize:ff,resolve:hf};function hf(n,e){let t=n.length-2,r=3,i,s;return n[r][1].type==="whitespace"&&(r+=2),t-2>r&&n[t][1].type==="whitespace"&&(t-=2),n[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&n[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(i={type:"atxHeadingText",start:n[r][1].start,end:n[t][1].end},s={type:"chunkText",start:n[r][1].start,end:n[t][1].end,contentType:"text"},Tt(n,r,t-r+1,[["enter",i,e],["enter",s,e],["exit",s,e],["exit",i,e]])),n}function ff(n,e,t){let r=0;return i;function i(c){return n.enter("atxHeading"),s(c)}function s(c){return n.enter("atxHeadingSequence"),a(c)}function a(c){return c===35&&r++<6?(n.consume(c),a):c===null||Le(c)?(n.exit("atxHeadingSequence"),o(c)):t(c)}function o(c){return c===35?(n.enter("atxHeadingSequence"),l(c)):c===null||B(c)?(n.exit("atxHeading"),e(c)):Y(c)?se(n,o,"whitespace")(c):(n.enter("atxHeadingText"),u(c))}function l(c){return c===35?(n.consume(c),l):(n.exit("atxHeadingSequence"),o(c))}function u(c){return c===null||c===35||Le(c)?(n.exit("atxHeadingText"),o(c)):(n.consume(c),u)}}const pf=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Io=["pre","script","style","textarea"],mf={name:"htmlFlow",tokenize:wf,resolveTo:bf,concrete:!0},gf={tokenize:vf,partial:!0},yf={tokenize:_f,partial:!0};function bf(n){let e=n.length;for(;e--&&!(n[e][0]==="enter"&&n[e][1].type==="htmlFlow"););return e>1&&n[e-2][1].type==="linePrefix"&&(n[e][1].start=n[e-2][1].start,n[e+1][1].start=n[e-2][1].start,n.splice(e-2,2)),n}function wf(n,e,t){const r=this;let i,s,a,o,l;return u;function u(g){return c(g)}function c(g){return n.enter("htmlFlow"),n.enter("htmlFlowData"),n.consume(g),d}function d(g){return g===33?(n.consume(g),f):g===47?(n.consume(g),s=!0,w):g===63?(n.consume(g),i=3,r.interrupt?e:m):pt(g)?(n.consume(g),a=String.fromCharCode(g),y):t(g)}function f(g){return g===45?(n.consume(g),i=2,h):g===91?(n.consume(g),i=5,o=0,p):pt(g)?(n.consume(g),i=4,r.interrupt?e:m):t(g)}function h(g){return g===45?(n.consume(g),r.interrupt?e:m):t(g)}function p(g){const Ke="CDATA[";return g===Ke.charCodeAt(o++)?(n.consume(g),o===Ke.length?r.interrupt?e:L:p):t(g)}function w(g){return pt(g)?(n.consume(g),a=String.fromCharCode(g),y):t(g)}function y(g){if(g===null||g===47||g===62||Le(g)){const Ke=g===47,Vt=a.toLowerCase();return!Ke&&!s&&Io.includes(Vt)?(i=1,r.interrupt?e(g):L(g)):pf.includes(a.toLowerCase())?(i=6,Ke?(n.consume(g),b):r.interrupt?e(g):L(g)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(g):s?_(g):v(g))}return g===45||Fe(g)?(n.consume(g),a+=String.fromCharCode(g),y):t(g)}function b(g){return g===62?(n.consume(g),r.interrupt?e:L):t(g)}function _(g){return Y(g)?(n.consume(g),_):Q(g)}function v(g){return g===47?(n.consume(g),Q):g===58||g===95||pt(g)?(n.consume(g),P):Y(g)?(n.consume(g),v):Q(g)}function P(g){return g===45||g===46||g===58||g===95||Fe(g)?(n.consume(g),P):C(g)}function C(g){return g===61?(n.consume(g),x):Y(g)?(n.consume(g),C):v(g)}function x(g){return g===null||g===60||g===61||g===62||g===96?t(g):g===34||g===39?(n.consume(g),l=g,N):Y(g)?(n.consume(g),x):ee(g)}function N(g){return g===l?(n.consume(g),l=null,D):g===null||B(g)?t(g):(n.consume(g),N)}function ee(g){return g===null||g===34||g===39||g===47||g===60||g===61||g===62||g===96||Le(g)?C(g):(n.consume(g),ee)}function D(g){return g===47||g===62||Y(g)?v(g):t(g)}function Q(g){return g===62?(n.consume(g),$):t(g)}function $(g){return g===null||B(g)?L(g):Y(g)?(n.consume(g),$):t(g)}function L(g){return g===45&&i===2?(n.consume(g),_e):g===60&&i===1?(n.consume(g),me):g===62&&i===4?(n.consume(g),Je):g===63&&i===3?(n.consume(g),m):g===93&&i===5?(n.consume(g),vt):B(g)&&(i===6||i===7)?(n.exit("htmlFlowData"),n.check(gf,xt,ae)(g)):g===null||B(g)?(n.exit("htmlFlowData"),ae(g)):(n.consume(g),L)}function ae(g){return n.check(yf,de,xt)(g)}function de(g){return n.enter("lineEnding"),n.consume(g),n.exit("lineEnding"),J}function J(g){return g===null||B(g)?ae(g):(n.enter("htmlFlowData"),L(g))}function _e(g){return g===45?(n.consume(g),m):L(g)}function me(g){return g===47?(n.consume(g),a="",Ge):L(g)}function Ge(g){if(g===62){const Ke=a.toLowerCase();return Io.includes(Ke)?(n.consume(g),Je):L(g)}return pt(g)&&a.length<8?(n.consume(g),a+=String.fromCharCode(g),Ge):L(g)}function vt(g){return g===93?(n.consume(g),m):L(g)}function m(g){return g===62?(n.consume(g),Je):g===45&&i===2?(n.consume(g),m):L(g)}function Je(g){return g===null||B(g)?(n.exit("htmlFlowData"),xt(g)):(n.consume(g),Je)}function xt(g){return n.exit("htmlFlow"),e(g)}}function _f(n,e,t){const r=this;return i;function i(a){return B(a)?(n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),s):t(a)}function s(a){return r.parser.lazy[r.now().line]?t(a):e(a)}}function vf(n,e,t){return r;function r(i){return n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),n.attempt(Xi,e,t)}}const xf={name:"htmlText",tokenize:kf};function kf(n,e,t){const r=this;let i,s,a;return o;function o(m){return n.enter("htmlText"),n.enter("htmlTextData"),n.consume(m),l}function l(m){return m===33?(n.consume(m),u):m===47?(n.consume(m),C):m===63?(n.consume(m),v):pt(m)?(n.consume(m),ee):t(m)}function u(m){return m===45?(n.consume(m),c):m===91?(n.consume(m),s=0,p):pt(m)?(n.consume(m),_):t(m)}function c(m){return m===45?(n.consume(m),h):t(m)}function d(m){return m===null?t(m):m===45?(n.consume(m),f):B(m)?(a=d,me(m)):(n.consume(m),d)}function f(m){return m===45?(n.consume(m),h):d(m)}function h(m){return m===62?_e(m):m===45?f(m):d(m)}function p(m){const Je="CDATA[";return m===Je.charCodeAt(s++)?(n.consume(m),s===Je.length?w:p):t(m)}function w(m){return m===null?t(m):m===93?(n.consume(m),y):B(m)?(a=w,me(m)):(n.consume(m),w)}function y(m){return m===93?(n.consume(m),b):w(m)}function b(m){return m===62?_e(m):m===93?(n.consume(m),b):w(m)}function _(m){return m===null||m===62?_e(m):B(m)?(a=_,me(m)):(n.consume(m),_)}function v(m){return m===null?t(m):m===63?(n.consume(m),P):B(m)?(a=v,me(m)):(n.consume(m),v)}function P(m){return m===62?_e(m):v(m)}function C(m){return pt(m)?(n.consume(m),x):t(m)}function x(m){return m===45||Fe(m)?(n.consume(m),x):N(m)}function N(m){return B(m)?(a=N,me(m)):Y(m)?(n.consume(m),N):_e(m)}function ee(m){return m===45||Fe(m)?(n.consume(m),ee):m===47||m===62||Le(m)?D(m):t(m)}function D(m){return m===47?(n.consume(m),_e):m===58||m===95||pt(m)?(n.consume(m),Q):B(m)?(a=D,me(m)):Y(m)?(n.consume(m),D):_e(m)}function Q(m){return m===45||m===46||m===58||m===95||Fe(m)?(n.consume(m),Q):$(m)}function $(m){return m===61?(n.consume(m),L):B(m)?(a=$,me(m)):Y(m)?(n.consume(m),$):D(m)}function L(m){return m===null||m===60||m===61||m===62||m===96?t(m):m===34||m===39?(n.consume(m),i=m,ae):B(m)?(a=L,me(m)):Y(m)?(n.consume(m),L):(n.consume(m),de)}function ae(m){return m===i?(n.consume(m),i=void 0,J):m===null?t(m):B(m)?(a=ae,me(m)):(n.consume(m),ae)}function de(m){return m===null||m===34||m===39||m===60||m===61||m===96?t(m):m===47||m===62||Le(m)?D(m):(n.consume(m),de)}function J(m){return m===47||m===62||Le(m)?D(m):t(m)}function _e(m){return m===62?(n.consume(m),n.exit("htmlTextData"),n.exit("htmlText"),e):t(m)}function me(m){return n.exit("htmlTextData"),n.enter("lineEnding"),n.consume(m),n.exit("lineEnding"),Ge}function Ge(m){return Y(m)?se(n,vt,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(m):vt(m)}function vt(m){return n.enter("htmlTextData"),a(m)}}const va={name:"labelEnd",tokenize:Pf,resolveTo:If,resolveAll:Cf},Sf={tokenize:Tf},Ef={tokenize:Of},Af={tokenize:Rf};function Cf(n){let e=-1;for(;++e<n.length;){const t=n[e][1];(t.type==="labelImage"||t.type==="labelLink"||t.type==="labelEnd")&&(n.splice(e+1,t.type==="labelImage"?4:2),t.type="data",e++)}return n}function If(n,e){let t=n.length,r=0,i,s,a,o;for(;t--;)if(i=n[t][1],s){if(i.type==="link"||i.type==="labelLink"&&i._inactive)break;n[t][0]==="enter"&&i.type==="labelLink"&&(i._inactive=!0)}else if(a){if(n[t][0]==="enter"&&(i.type==="labelImage"||i.type==="labelLink")&&!i._balanced&&(s=t,i.type!=="labelLink")){r=2;break}}else i.type==="labelEnd"&&(a=t);const l={type:n[s][1].type==="labelLink"?"link":"image",start:Object.assign({},n[s][1].start),end:Object.assign({},n[n.length-1][1].end)},u={type:"label",start:Object.assign({},n[s][1].start),end:Object.assign({},n[a][1].end)},c={type:"labelText",start:Object.assign({},n[s+r+2][1].end),end:Object.assign({},n[a-2][1].start)};return o=[["enter",l,e],["enter",u,e]],o=Ze(o,n.slice(s+1,s+r+3)),o=Ze(o,[["enter",c,e]]),o=Ze(o,_a(e.parser.constructs.insideSpan.null,n.slice(s+r+4,a-3),e)),o=Ze(o,[["exit",c,e],n[a-2],n[a-1],["exit",u,e]]),o=Ze(o,n.slice(a+1)),o=Ze(o,[["exit",l,e]]),Tt(n,s,n.length,o),n}function Pf(n,e,t){const r=this;let i=r.events.length,s,a;for(;i--;)if((r.events[i][1].type==="labelImage"||r.events[i][1].type==="labelLink")&&!r.events[i][1]._balanced){s=r.events[i][1];break}return o;function o(f){return s?s._inactive?d(f):(a=r.parser.defined.includes(vn(r.sliceSerialize({start:s.end,end:r.now()}))),n.enter("labelEnd"),n.enter("labelMarker"),n.consume(f),n.exit("labelMarker"),n.exit("labelEnd"),l):t(f)}function l(f){return f===40?n.attempt(Sf,c,a?c:d)(f):f===91?n.attempt(Ef,c,a?u:d)(f):a?c(f):d(f)}function u(f){return n.attempt(Af,c,d)(f)}function c(f){return e(f)}function d(f){return s._balanced=!0,t(f)}}function Tf(n,e,t){return r;function r(d){return n.enter("resource"),n.enter("resourceMarker"),n.consume(d),n.exit("resourceMarker"),i}function i(d){return Le(d)?Yn(n,s)(d):s(d)}function s(d){return d===41?c(d):hu(n,a,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function a(d){return Le(d)?Yn(n,l)(d):c(d)}function o(d){return t(d)}function l(d){return d===34||d===39||d===40?pu(n,u,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):c(d)}function u(d){return Le(d)?Yn(n,c)(d):c(d)}function c(d){return d===41?(n.enter("resourceMarker"),n.consume(d),n.exit("resourceMarker"),n.exit("resource"),e):t(d)}}function Of(n,e,t){const r=this;return i;function i(o){return fu.call(r,n,s,a,"reference","referenceMarker","referenceString")(o)}function s(o){return r.parser.defined.includes(vn(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(o):t(o)}function a(o){return t(o)}}function Rf(n,e,t){return r;function r(s){return n.enter("reference"),n.enter("referenceMarker"),n.consume(s),n.exit("referenceMarker"),i}function i(s){return s===93?(n.enter("referenceMarker"),n.consume(s),n.exit("referenceMarker"),n.exit("reference"),e):t(s)}}const Nf={name:"labelStartImage",tokenize:jf,resolveAll:va.resolveAll};function jf(n,e,t){const r=this;return i;function i(o){return n.enter("labelImage"),n.enter("labelImageMarker"),n.consume(o),n.exit("labelImageMarker"),s}function s(o){return o===91?(n.enter("labelMarker"),n.consume(o),n.exit("labelMarker"),n.exit("labelImage"),a):t(o)}function a(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(o):e(o)}}const Lf={name:"labelStartLink",tokenize:$f,resolveAll:va.resolveAll};function $f(n,e,t){const r=this;return i;function i(a){return n.enter("labelLink"),n.enter("labelMarker"),n.consume(a),n.exit("labelMarker"),n.exit("labelLink"),s}function s(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(a):e(a)}}const fs={name:"lineEnding",tokenize:Mf};function Mf(n,e){return t;function t(r){return n.enter("lineEnding"),n.consume(r),n.exit("lineEnding"),se(n,e,"linePrefix")}}const Ur={name:"thematicBreak",tokenize:Df};function Df(n,e,t){let r=0,i;return s;function s(u){return n.enter("thematicBreak"),a(u)}function a(u){return i=u,o(u)}function o(u){return u===i?(n.enter("thematicBreakSequence"),l(u)):r>=3&&(u===null||B(u))?(n.exit("thematicBreak"),e(u)):t(u)}function l(u){return u===i?(n.consume(u),r++,l):(n.exit("thematicBreakSequence"),Y(u)?se(n,o,"whitespace")(u):o(u))}}const Oe={name:"list",tokenize:zf,continuation:{tokenize:Uf},exit:Zf},Bf={tokenize:Vf,partial:!0},Ff={tokenize:Hf,partial:!0};function zf(n,e,t){const r=this,i=r.events[r.events.length-1];let s=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0,a=0;return o;function o(h){const p=r.containerState.type||(h===42||h===43||h===45?"listUnordered":"listOrdered");if(p==="listUnordered"?!r.containerState.marker||h===r.containerState.marker:zs(h)){if(r.containerState.type||(r.containerState.type=p,n.enter(p,{_container:!0})),p==="listUnordered")return n.enter("listItemPrefix"),h===42||h===45?n.check(Ur,t,u)(h):u(h);if(!r.interrupt||h===49)return n.enter("listItemPrefix"),n.enter("listItemValue"),l(h)}return t(h)}function l(h){return zs(h)&&++a<10?(n.consume(h),l):(!r.interrupt||a<2)&&(r.containerState.marker?h===r.containerState.marker:h===41||h===46)?(n.exit("listItemValue"),u(h)):t(h)}function u(h){return n.enter("listItemMarker"),n.consume(h),n.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||h,n.check(Xi,r.interrupt?t:c,n.attempt(Bf,f,d))}function c(h){return r.containerState.initialBlankLine=!0,s++,f(h)}function d(h){return Y(h)?(n.enter("listItemPrefixWhitespace"),n.consume(h),n.exit("listItemPrefixWhitespace"),f):t(h)}function f(h){return r.containerState.size=s+r.sliceSerialize(n.exit("listItemPrefix"),!0).length,e(h)}}function Uf(n,e,t){const r=this;return r.containerState._closeFlow=void 0,n.check(Xi,i,s);function i(o){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,se(n,e,"listItemIndent",r.containerState.size+1)(o)}function s(o){return r.containerState.furtherBlankLines||!Y(o)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,a(o)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,n.attempt(Ff,e,a)(o))}function a(o){return r.containerState._closeFlow=!0,r.interrupt=void 0,se(n,n.attempt(Oe,e,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function Hf(n,e,t){const r=this;return se(n,i,"listItemIndent",r.containerState.size+1);function i(s){const a=r.events[r.events.length-1];return a&&a[1].type==="listItemIndent"&&a[2].sliceSerialize(a[1],!0).length===r.containerState.size?e(s):t(s)}}function Zf(n){n.exit(this.containerState.type)}function Vf(n,e,t){const r=this;return se(n,i,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function i(s){const a=r.events[r.events.length-1];return!Y(s)&&a&&a[1].type==="listItemPrefixWhitespace"?e(s):t(s)}}const Po={name:"setextUnderline",tokenize:Wf,resolveTo:qf};function qf(n,e){let t=n.length,r,i,s;for(;t--;)if(n[t][0]==="enter"){if(n[t][1].type==="content"){r=t;break}n[t][1].type==="paragraph"&&(i=t)}else n[t][1].type==="content"&&n.splice(t,1),!s&&n[t][1].type==="definition"&&(s=t);const a={type:"setextHeading",start:Object.assign({},n[i][1].start),end:Object.assign({},n[n.length-1][1].end)};return n[i][1].type="setextHeadingText",s?(n.splice(i,0,["enter",a,e]),n.splice(s+1,0,["exit",n[r][1],e]),n[r][1].end=Object.assign({},n[s][1].end)):n[r][1]=a,n.push(["exit",a,e]),n}function Wf(n,e,t){const r=this;let i;return s;function s(u){let c=r.events.length,d;for(;c--;)if(r.events[c][1].type!=="lineEnding"&&r.events[c][1].type!=="linePrefix"&&r.events[c][1].type!=="content"){d=r.events[c][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||d)?(n.enter("setextHeadingLine"),i=u,a(u)):t(u)}function a(u){return n.enter("setextHeadingLineSequence"),o(u)}function o(u){return u===i?(n.consume(u),o):(n.exit("setextHeadingLineSequence"),Y(u)?se(n,l,"lineSuffix")(u):l(u))}function l(u){return u===null||B(u)?(n.exit("setextHeadingLine"),e(u)):t(u)}}const Gf={tokenize:Jf};function Jf(n){const e=this,t=n.attempt(Xi,r,n.attempt(this.parser.constructs.flowInitial,i,se(n,n.attempt(this.parser.constructs.flow,i,n.attempt(Yh,i)),"linePrefix")));return t;function r(s){if(s===null){n.consume(s);return}return n.enter("lineEndingBlank"),n.consume(s),n.exit("lineEndingBlank"),e.currentConstruct=void 0,t}function i(s){if(s===null){n.consume(s);return}return n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),e.currentConstruct=void 0,t}}const Kf={resolveAll:gu()},Xf=mu("string"),Qf=mu("text");function mu(n){return{tokenize:e,resolveAll:gu(n==="text"?Yf:void 0)};function e(t){const r=this,i=this.parser.constructs[n],s=t.attempt(i,a,o);return a;function a(c){return u(c)?s(c):o(c)}function o(c){if(c===null){t.consume(c);return}return t.enter("data"),t.consume(c),l}function l(c){return u(c)?(t.exit("data"),s(c)):(t.consume(c),l)}function u(c){if(c===null)return!0;const d=i[c];let f=-1;if(d)for(;++f<d.length;){const h=d[f];if(!h.previous||h.previous.call(r,r.previous))return!0}return!1}}}function gu(n){return e;function e(t,r){let i=-1,s;for(;++i<=t.length;)s===void 0?t[i]&&t[i][1].type==="data"&&(s=i,i++):(!t[i]||t[i][1].type!=="data")&&(i!==s+2&&(t[s][1].end=t[i-1][1].end,t.splice(s+2,i-s-2),i=s+2),s=void 0);return n?n(t,r):t}}function Yf(n,e){let t=0;for(;++t<=n.length;)if((t===n.length||n[t][1].type==="lineEnding")&&n[t-1][1].type==="data"){const r=n[t-1][1],i=e.sliceStream(r);let s=i.length,a=-1,o=0,l;for(;s--;){const u=i[s];if(typeof u=="string"){for(a=u.length;u.charCodeAt(a-1)===32;)o++,a--;if(a)break;a=-1}else if(u===-2)l=!0,o++;else if(u!==-1){s++;break}}if(o){const u={type:t===n.length||l||o<2?"lineSuffix":"hardBreakTrailing",start:{line:r.end.line,column:r.end.column-o,offset:r.end.offset-o,_index:r.start._index+s,_bufferIndex:s?a:r.start._bufferIndex+a},end:Object.assign({},r.end)};r.end=Object.assign({},u.start),r.start.offset===r.end.offset?Object.assign(r,u):(n.splice(t,0,["enter",u,e],["exit",u,e]),t+=2)}t++}return n}function ep(n,e,t){let r=Object.assign(t?Object.assign({},t):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1});const i={},s=[];let a=[],o=[];const l={consume:_,enter:v,exit:P,attempt:N(C),check:N(x),interrupt:N(x,{interrupt:!0})},u={previous:null,code:null,containerState:{},events:[],parser:n,sliceStream:h,sliceSerialize:f,now:p,defineSkip:w,write:d};let c=e.tokenize.call(u,l);return e.resolveAll&&s.push(e),u;function d($){return a=Ze(a,$),y(),a[a.length-1]!==null?[]:(ee(e,0),u.events=_a(s,u.events,u),u.events)}function f($,L){return np(h($),L)}function h($){return tp(a,$)}function p(){const{line:$,column:L,offset:ae,_index:de,_bufferIndex:J}=r;return{line:$,column:L,offset:ae,_index:de,_bufferIndex:J}}function w($){i[$.line]=$.column,Q()}function y(){let $;for(;r._index<a.length;){const L=a[r._index];if(typeof L=="string")for($=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===$&&r._bufferIndex<L.length;)b(L.charCodeAt(r._bufferIndex));else b(L)}}function b($){c=c($)}function _($){B($)?(r.line++,r.column=1,r.offset+=$===-3?2:1,Q()):$!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===a[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=$}function v($,L){const ae=L||{};return ae.type=$,ae.start=p(),u.events.push(["enter",ae,u]),o.push(ae),ae}function P($){const L=o.pop();return L.end=p(),u.events.push(["exit",L,u]),L}function C($,L){ee($,L.from)}function x($,L){L.restore()}function N($,L){return ae;function ae(de,J,_e){let me,Ge,vt,m;return Array.isArray(de)?xt(de):"tokenize"in de?xt([de]):Je(de);function Je(ge){return Ln;function Ln(Rt){const on=Rt!==null&&ge[Rt],ln=Rt!==null&&ge.null,Rr=[...Array.isArray(on)?on:on?[on]:[],...Array.isArray(ln)?ln:ln?[ln]:[]];return xt(Rr)(Rt)}}function xt(ge){return me=ge,Ge=0,ge.length===0?_e:g(ge[Ge])}function g(ge){return Ln;function Ln(Rt){return m=D(),vt=ge,ge.partial||(u.currentConstruct=ge),ge.name&&u.parser.constructs.disable.null.includes(ge.name)?Vt():ge.tokenize.call(L?Object.assign(Object.create(u),L):u,l,Ke,Vt)(Rt)}}function Ke(ge){return $(vt,m),J}function Vt(ge){return m.restore(),++Ge<me.length?g(me[Ge]):_e}}}function ee($,L){$.resolveAll&&!s.includes($)&&s.push($),$.resolve&&Tt(u.events,L,u.events.length-L,$.resolve(u.events.slice(L),u)),$.resolveTo&&(u.events=$.resolveTo(u.events,u))}function D(){const $=p(),L=u.previous,ae=u.currentConstruct,de=u.events.length,J=Array.from(o);return{restore:_e,from:de};function _e(){r=$,u.previous=L,u.currentConstruct=ae,u.events.length=de,o=J,Q()}}function Q(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function tp(n,e){const t=e.start._index,r=e.start._bufferIndex,i=e.end._index,s=e.end._bufferIndex;let a;if(t===i)a=[n[t].slice(r,s)];else{if(a=n.slice(t,i),r>-1){const o=a[0];typeof o=="string"?a[0]=o.slice(r):a.shift()}s>0&&a.push(n[i].slice(0,s))}return a}function np(n,e){let t=-1;const r=[];let i;for(;++t<n.length;){const s=n[t];let a;if(typeof s=="string")a=s;else switch(s){case-5:{a="\r";break}case-4:{a=`
`;break}case-3:{a=`\r
`;break}case-2:{a=e?" ":"	";break}case-1:{if(!e&&i)continue;a=" ";break}default:a=String.fromCharCode(s)}i=s===-2,r.push(a)}return r.join("")}const rp={42:Oe,43:Oe,45:Oe,48:Oe,49:Oe,50:Oe,51:Oe,52:Oe,53:Oe,54:Oe,55:Oe,56:Oe,57:Oe,62:lu},ip={91:sf},sp={[-2]:hs,[-1]:hs,32:hs},ap={35:df,42:Ur,45:[Po,Ur],60:mf,61:Po,95:Ur,96:Co,126:Co},op={38:cu,92:uu},lp={[-5]:fs,[-4]:fs,[-3]:fs,33:Nf,38:cu,42:Us,60:[jh,xf],91:Lf,92:[uf,uu],93:va,95:Us,96:Wh},up={null:[Us,Kf]},cp={null:[42,95]},dp={null:[]},hp=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:cp,contentInitial:ip,disable:dp,document:rp,flow:ap,flowInitial:sp,insideSpan:up,string:op,text:lp},Symbol.toStringTag,{value:"Module"}));function fp(n){const t=wh([hp,...(n||{}).extensions||[]]),r={defined:[],lazy:{},constructs:t,content:i(Ch),document:i(Ph),flow:i(Gf),string:i(Xf),text:i(Qf)};return r;function i(s){return a;function a(o){return ep(r,s,o)}}}function pp(n){for(;!du(n););return n}const To=/[\0\t\n\r]/g;function mp(){let n=1,e="",t=!0,r;return i;function i(s,a,o){const l=[];let u,c,d,f,h;for(s=e+(typeof s=="string"?s.toString():new TextDecoder(a||void 0).decode(s)),d=0,e="",t&&(s.charCodeAt(0)===65279&&d++,t=void 0);d<s.length;){if(To.lastIndex=d,u=To.exec(s),f=u&&u.index!==void 0?u.index:s.length,h=s.charCodeAt(f),!u){e=s.slice(d);break}if(h===10&&d===f&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),d<f&&(l.push(s.slice(d,f)),n+=f-d),h){case 0:{l.push(65533),n++;break}case 9:{for(c=Math.ceil(n/4)*4,l.push(-2);n++<c;)l.push(-1);break}case 10:{l.push(-4),n=1;break}default:r=!0,n=1}d=f+1}return o&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const gp=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function yp(n){return n.replace(gp,bp)}function bp(n,e,t){if(e)return e;if(t.charCodeAt(0)===35){const i=t.charCodeAt(1),s=i===120||i===88;return ou(t.slice(s?2:1),s?16:10)}return wa(t)||n}const yu={}.hasOwnProperty;function wp(n,e,t){return typeof e!="string"&&(t=e,e=void 0),_p(t)(pp(fp(t).document().write(mp()(n,e,!0))))}function _p(n){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(io),autolinkProtocol:D,autolinkEmail:D,atxHeading:s(to),blockQuote:s(ln),characterEscape:D,characterReference:D,codeFenced:s(Rr),codeFencedFenceInfo:a,codeFencedFenceMeta:a,codeIndented:s(Rr,a),codeText:s($c,a),codeTextData:D,data:D,codeFlowValue:D,definition:s(Mc),definitionDestinationString:a,definitionLabelString:a,definitionTitleString:a,emphasis:s(Dc),hardBreakEscape:s(no),hardBreakTrailing:s(no),htmlFlow:s(ro,a),htmlFlowData:D,htmlText:s(ro,a),htmlTextData:D,image:s(Bc),label:a,link:s(io),listItem:s(Fc),listItemValue:f,listOrdered:s(so,d),listUnordered:s(so),paragraph:s(zc),reference:g,referenceString:a,resourceDestinationString:a,resourceTitleString:a,setextHeading:s(to),strong:s(Uc),thematicBreak:s(Zc)},exit:{atxHeading:l(),atxHeadingSequence:C,autolink:l(),autolinkEmail:on,autolinkProtocol:Rt,blockQuote:l(),characterEscapeValue:Q,characterReferenceMarkerHexadecimal:Vt,characterReferenceMarkerNumeric:Vt,characterReferenceValue:ge,characterReference:Ln,codeFenced:l(y),codeFencedFence:w,codeFencedFenceInfo:h,codeFencedFenceMeta:p,codeFlowValue:Q,codeIndented:l(b),codeText:l(J),codeTextData:Q,data:Q,definition:l(),definitionDestinationString:P,definitionLabelString:_,definitionTitleString:v,emphasis:l(),hardBreakEscape:l(L),hardBreakTrailing:l(L),htmlFlow:l(ae),htmlFlowData:Q,htmlText:l(de),htmlTextData:Q,image:l(me),label:vt,labelText:Ge,lineEnding:$,link:l(_e),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:Ke,resourceDestinationString:m,resourceTitleString:Je,resource:xt,setextHeading:l(ee),setextHeadingLineSequence:N,setextHeadingText:x,strong:l(),thematicBreak:l()}};bu(e,(n||{}).mdastExtensions||[]);const t={};return r;function r(k){let I={type:"root",children:[]};const z={stack:[I],tokenStack:[],config:e,enter:o,exit:u,buffer:a,resume:c,data:t},q=[];let ne=-1;for(;++ne<k.length;)if(k[ne][1].type==="listOrdered"||k[ne][1].type==="listUnordered")if(k[ne][0]==="enter")q.push(ne);else{const Xe=q.pop();ne=i(k,Xe,ne)}for(ne=-1;++ne<k.length;){const Xe=e[k[ne][0]];yu.call(Xe,k[ne][1].type)&&Xe[k[ne][1].type].call(Object.assign({sliceSerialize:k[ne][2].sliceSerialize},z),k[ne][1])}if(z.tokenStack.length>0){const Xe=z.tokenStack[z.tokenStack.length-1];(Xe[1]||Oo).call(z,void 0,Xe[0])}for(I.position={start:Nt(k.length>0?k[0][1].start:{line:1,column:1,offset:0}),end:Nt(k.length>0?k[k.length-2][1].end:{line:1,column:1,offset:0})},ne=-1;++ne<e.transforms.length;)I=e.transforms[ne](I)||I;return I}function i(k,I,z){let q=I-1,ne=-1,Xe=!1,qt,kt,$n,Mn;for(;++q<=z;){const $e=k[q];switch($e[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{$e[0]==="enter"?ne++:ne--,Mn=void 0;break}case"lineEndingBlank":{$e[0]==="enter"&&(qt&&!Mn&&!ne&&!$n&&($n=q),Mn=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Mn=void 0}if(!ne&&$e[0]==="enter"&&$e[1].type==="listItemPrefix"||ne===-1&&$e[0]==="exit"&&($e[1].type==="listUnordered"||$e[1].type==="listOrdered")){if(qt){let un=q;for(kt=void 0;un--;){const St=k[un];if(St[1].type==="lineEnding"||St[1].type==="lineEndingBlank"){if(St[0]==="exit")continue;kt&&(k[kt][1].type="lineEndingBlank",Xe=!0),St[1].type="lineEnding",kt=un}else if(!(St[1].type==="linePrefix"||St[1].type==="blockQuotePrefix"||St[1].type==="blockQuotePrefixWhitespace"||St[1].type==="blockQuoteMarker"||St[1].type==="listItemIndent"))break}$n&&(!kt||$n<kt)&&(qt._spread=!0),qt.end=Object.assign({},kt?k[kt][1].start:$e[1].end),k.splice(kt||q,0,["exit",qt,$e[2]]),q++,z++}if($e[1].type==="listItemPrefix"){const un={type:"listItem",_spread:!1,start:Object.assign({},$e[1].start),end:void 0};qt=un,k.splice(q,0,["enter",un,$e[2]]),q++,z++,$n=void 0,Mn=!0}}}return k[I][1]._spread=Xe,z}function s(k,I){return z;function z(q){o.call(this,k(q),q),I&&I.call(this,q)}}function a(){this.stack.push({type:"fragment",children:[]})}function o(k,I,z){this.stack[this.stack.length-1].children.push(k),this.stack.push(k),this.tokenStack.push([I,z]),k.position={start:Nt(I.start),end:void 0}}function l(k){return I;function I(z){k&&k.call(this,z),u.call(this,z)}}function u(k,I){const z=this.stack.pop(),q=this.tokenStack.pop();if(q)q[0].type!==k.type&&(I?I.call(this,k,q[0]):(q[1]||Oo).call(this,k,q[0]));else throw new Error("Cannot close `"+k.type+"` ("+Qn({start:k.start,end:k.end})+"): it’s not open");z.position.end=Nt(k.end)}function c(){return yh(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function f(k){if(this.data.expectingFirstListItemValue){const I=this.stack[this.stack.length-2];I.start=Number.parseInt(this.sliceSerialize(k),10),this.data.expectingFirstListItemValue=void 0}}function h(){const k=this.resume(),I=this.stack[this.stack.length-1];I.lang=k}function p(){const k=this.resume(),I=this.stack[this.stack.length-1];I.meta=k}function w(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function y(){const k=this.resume(),I=this.stack[this.stack.length-1];I.value=k.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function b(){const k=this.resume(),I=this.stack[this.stack.length-1];I.value=k.replace(/(\r?\n|\r)$/g,"")}function _(k){const I=this.resume(),z=this.stack[this.stack.length-1];z.label=I,z.identifier=vn(this.sliceSerialize(k)).toLowerCase()}function v(){const k=this.resume(),I=this.stack[this.stack.length-1];I.title=k}function P(){const k=this.resume(),I=this.stack[this.stack.length-1];I.url=k}function C(k){const I=this.stack[this.stack.length-1];if(!I.depth){const z=this.sliceSerialize(k).length;I.depth=z}}function x(){this.data.setextHeadingSlurpLineEnding=!0}function N(k){const I=this.stack[this.stack.length-1];I.depth=this.sliceSerialize(k).codePointAt(0)===61?1:2}function ee(){this.data.setextHeadingSlurpLineEnding=void 0}function D(k){const z=this.stack[this.stack.length-1].children;let q=z[z.length-1];(!q||q.type!=="text")&&(q=Hc(),q.position={start:Nt(k.start),end:void 0},z.push(q)),this.stack.push(q)}function Q(k){const I=this.stack.pop();I.value+=this.sliceSerialize(k),I.position.end=Nt(k.end)}function $(k){const I=this.stack[this.stack.length-1];if(this.data.atHardBreak){const z=I.children[I.children.length-1];z.position.end=Nt(k.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(I.type)&&(D.call(this,k),Q.call(this,k))}function L(){this.data.atHardBreak=!0}function ae(){const k=this.resume(),I=this.stack[this.stack.length-1];I.value=k}function de(){const k=this.resume(),I=this.stack[this.stack.length-1];I.value=k}function J(){const k=this.resume(),I=this.stack[this.stack.length-1];I.value=k}function _e(){const k=this.stack[this.stack.length-1];if(this.data.inReference){const I=this.data.referenceType||"shortcut";k.type+="Reference",k.referenceType=I,delete k.url,delete k.title}else delete k.identifier,delete k.label;this.data.referenceType=void 0}function me(){const k=this.stack[this.stack.length-1];if(this.data.inReference){const I=this.data.referenceType||"shortcut";k.type+="Reference",k.referenceType=I,delete k.url,delete k.title}else delete k.identifier,delete k.label;this.data.referenceType=void 0}function Ge(k){const I=this.sliceSerialize(k),z=this.stack[this.stack.length-2];z.label=yp(I),z.identifier=vn(I).toLowerCase()}function vt(){const k=this.stack[this.stack.length-1],I=this.resume(),z=this.stack[this.stack.length-1];if(this.data.inReference=!0,z.type==="link"){const q=k.children;z.children=q}else z.alt=I}function m(){const k=this.resume(),I=this.stack[this.stack.length-1];I.url=k}function Je(){const k=this.resume(),I=this.stack[this.stack.length-1];I.title=k}function xt(){this.data.inReference=void 0}function g(){this.data.referenceType="collapsed"}function Ke(k){const I=this.resume(),z=this.stack[this.stack.length-1];z.label=I,z.identifier=vn(this.sliceSerialize(k)).toLowerCase(),this.data.referenceType="full"}function Vt(k){this.data.characterReferenceType=k.type}function ge(k){const I=this.sliceSerialize(k),z=this.data.characterReferenceType;let q;z?(q=ou(I,z==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):q=wa(I);const ne=this.stack[this.stack.length-1];ne.value+=q}function Ln(k){const I=this.stack.pop();I.position.end=Nt(k.end)}function Rt(k){Q.call(this,k);const I=this.stack[this.stack.length-1];I.url=this.sliceSerialize(k)}function on(k){Q.call(this,k);const I=this.stack[this.stack.length-1];I.url="mailto:"+this.sliceSerialize(k)}function ln(){return{type:"blockquote",children:[]}}function Rr(){return{type:"code",lang:null,meta:null,value:""}}function $c(){return{type:"inlineCode",value:""}}function Mc(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Dc(){return{type:"emphasis",children:[]}}function to(){return{type:"heading",depth:0,children:[]}}function no(){return{type:"break"}}function ro(){return{type:"html",value:""}}function Bc(){return{type:"image",title:null,url:"",alt:null}}function io(){return{type:"link",title:null,url:"",children:[]}}function so(k){return{type:"list",ordered:k.type==="listOrdered",start:null,spread:k._spread,children:[]}}function Fc(k){return{type:"listItem",spread:k._spread,checked:null,children:[]}}function zc(){return{type:"paragraph",children:[]}}function Uc(){return{type:"strong",children:[]}}function Hc(){return{type:"text",value:""}}function Zc(){return{type:"thematicBreak"}}}function Nt(n){return{line:n.line,column:n.column,offset:n.offset}}function bu(n,e){let t=-1;for(;++t<e.length;){const r=e[t];Array.isArray(r)?bu(n,r):vp(n,r)}}function vp(n,e){let t;for(t in e)if(yu.call(e,t))switch(t){case"canContainEols":{const r=e[t];r&&n[t].push(...r);break}case"transforms":{const r=e[t];r&&n[t].push(...r);break}case"enter":case"exit":{const r=e[t];r&&Object.assign(n[t],r);break}}}function Oo(n,e){throw n?new Error("Cannot close `"+n.type+"` ("+Qn({start:n.start,end:n.end})+"): a different token (`"+e.type+"`, "+Qn({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Qn({start:e.start,end:e.end})+") is still open")}function xp(n){const e=this;e.parser=t;function t(r){return wp(r,{...e.data("settings"),...n,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function kp(n,e){const t={type:"element",tagName:"blockquote",properties:{},children:n.wrap(n.all(e),!0)};return n.patch(e,t),n.applyData(e,t)}function Sp(n,e){const t={type:"element",tagName:"br",properties:{},children:[]};return n.patch(e,t),[n.applyData(e,t),{type:"text",value:`
`}]}function Ep(n,e){const t=e.value?e.value+`
`:"",r={};e.lang&&(r.className=["language-"+e.lang]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:t}]};return e.meta&&(i.data={meta:e.meta}),n.patch(e,i),i=n.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},n.patch(e,i),i}function Ap(n,e){const t={type:"element",tagName:"del",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function Cp(n,e){const t={type:"element",tagName:"em",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function Ip(n,e){const t=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),i=Nn(r.toLowerCase()),s=n.footnoteOrder.indexOf(r);let a,o=n.footnoteCounts.get(r);o===void 0?(o=0,n.footnoteOrder.push(r),a=n.footnoteOrder.length):a=s+1,o+=1,n.footnoteCounts.set(r,o);const l={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+i,id:t+"fnref-"+i+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(a)}]};n.patch(e,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return n.patch(e,u),n.applyData(e,u)}function Pp(n,e){const t={type:"element",tagName:"h"+e.depth,properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function Tp(n,e){if(n.options.allowDangerousHtml){const t={type:"raw",value:e.value};return n.patch(e,t),n.applyData(e,t)}}function wu(n,e){const t=e.referenceType;let r="]";if(t==="collapsed"?r+="[]":t==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const i=n.all(e),s=i[0];s&&s.type==="text"?s.value="["+s.value:i.unshift({type:"text",value:"["});const a=i[i.length-1];return a&&a.type==="text"?a.value+=r:i.push({type:"text",value:r}),i}function Op(n,e){const t=String(e.identifier).toUpperCase(),r=n.definitionById.get(t);if(!r)return wu(n,e);const i={src:Nn(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(i.title=r.title);const s={type:"element",tagName:"img",properties:i,children:[]};return n.patch(e,s),n.applyData(e,s)}function Rp(n,e){const t={src:Nn(e.url)};e.alt!==null&&e.alt!==void 0&&(t.alt=e.alt),e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"img",properties:t,children:[]};return n.patch(e,r),n.applyData(e,r)}function Np(n,e){const t={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};n.patch(e,t);const r={type:"element",tagName:"code",properties:{},children:[t]};return n.patch(e,r),n.applyData(e,r)}function jp(n,e){const t=String(e.identifier).toUpperCase(),r=n.definitionById.get(t);if(!r)return wu(n,e);const i={href:Nn(r.url||"")};r.title!==null&&r.title!==void 0&&(i.title=r.title);const s={type:"element",tagName:"a",properties:i,children:n.all(e)};return n.patch(e,s),n.applyData(e,s)}function Lp(n,e){const t={href:Nn(e.url)};e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"a",properties:t,children:n.all(e)};return n.patch(e,r),n.applyData(e,r)}function $p(n,e,t){const r=n.all(e),i=t?Mp(t):_u(e),s={},a=[];if(typeof e.checked=="boolean"){const c=r[0];let d;c&&c.type==="element"&&c.tagName==="p"?d=c:(d={type:"element",tagName:"p",properties:{},children:[]},r.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),s.className=["task-list-item"]}let o=-1;for(;++o<r.length;){const c=r[o];(i||o!==0||c.type!=="element"||c.tagName!=="p")&&a.push({type:"text",value:`
`}),c.type==="element"&&c.tagName==="p"&&!i?a.push(...c.children):a.push(c)}const l=r[r.length-1];l&&(i||l.type!=="element"||l.tagName!=="p")&&a.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:s,children:a};return n.patch(e,u),n.applyData(e,u)}function Mp(n){let e=!1;if(n.type==="list"){e=n.spread||!1;const t=n.children;let r=-1;for(;!e&&++r<t.length;)e=_u(t[r])}return e}function _u(n){const e=n.spread;return e??n.children.length>1}function Dp(n,e){const t={},r=n.all(e);let i=-1;for(typeof e.start=="number"&&e.start!==1&&(t.start=e.start);++i<r.length;){const a=r[i];if(a.type==="element"&&a.tagName==="li"&&a.properties&&Array.isArray(a.properties.className)&&a.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const s={type:"element",tagName:e.ordered?"ol":"ul",properties:t,children:n.wrap(r,!0)};return n.patch(e,s),n.applyData(e,s)}function Bp(n,e){const t={type:"element",tagName:"p",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function Fp(n,e){const t={type:"root",children:n.wrap(n.all(e))};return n.patch(e,t),n.applyData(e,t)}function zp(n,e){const t={type:"element",tagName:"strong",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function Up(n,e){const t=n.all(e),r=t.shift(),i=[];if(r){const a={type:"element",tagName:"thead",properties:{},children:n.wrap([r],!0)};n.patch(e.children[0],a),i.push(a)}if(t.length>0){const a={type:"element",tagName:"tbody",properties:{},children:n.wrap(t,!0)},o=ma(e.children[1]),l=eu(e.children[e.children.length-1]);o&&l&&(a.position={start:o,end:l}),i.push(a)}const s={type:"element",tagName:"table",properties:{},children:n.wrap(i,!0)};return n.patch(e,s),n.applyData(e,s)}function Hp(n,e,t){const r=t?t.children:void 0,s=(r?r.indexOf(e):1)===0?"th":"td",a=t&&t.type==="table"?t.align:void 0,o=a?a.length:e.children.length;let l=-1;const u=[];for(;++l<o;){const d=e.children[l],f={},h=a?a[l]:void 0;h&&(f.align=h);let p={type:"element",tagName:s,properties:f,children:[]};d&&(p.children=n.all(d),n.patch(d,p),p=n.applyData(d,p)),u.push(p)}const c={type:"element",tagName:"tr",properties:{},children:n.wrap(u,!0)};return n.patch(e,c),n.applyData(e,c)}function Zp(n,e){const t={type:"element",tagName:"td",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}const Ro=9,No=32;function Vp(n){const e=String(n),t=/\r?\n|\r/g;let r=t.exec(e),i=0;const s=[];for(;r;)s.push(jo(e.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=t.exec(e);return s.push(jo(e.slice(i),i>0,!1)),s.join("")}function jo(n,e,t){let r=0,i=n.length;if(e){let s=n.codePointAt(r);for(;s===Ro||s===No;)r++,s=n.codePointAt(r)}if(t){let s=n.codePointAt(i-1);for(;s===Ro||s===No;)i--,s=n.codePointAt(i-1)}return i>r?n.slice(r,i):""}function qp(n,e){const t={type:"text",value:Vp(String(e.value))};return n.patch(e,t),n.applyData(e,t)}function Wp(n,e){const t={type:"element",tagName:"hr",properties:{},children:[]};return n.patch(e,t),n.applyData(e,t)}const Gp={blockquote:kp,break:Sp,code:Ep,delete:Ap,emphasis:Cp,footnoteReference:Ip,heading:Pp,html:Tp,imageReference:Op,image:Rp,inlineCode:Np,linkReference:jp,link:Lp,listItem:$p,list:Dp,paragraph:Bp,root:Fp,strong:zp,table:Up,tableCell:Zp,tableRow:Hp,text:qp,thematicBreak:Wp,toml:Nr,yaml:Nr,definition:Nr,footnoteDefinition:Nr};function Nr(){}const vu=-1,Qi=0,ii=1,si=2,xa=3,ka=4,Sa=5,Ea=6,xu=7,ku=8,Lo=typeof self=="object"?self:globalThis,Jp=(n,e)=>{const t=(i,s)=>(n.set(s,i),i),r=i=>{if(n.has(i))return n.get(i);const[s,a]=e[i];switch(s){case Qi:case vu:return t(a,i);case ii:{const o=t([],i);for(const l of a)o.push(r(l));return o}case si:{const o=t({},i);for(const[l,u]of a)o[r(l)]=r(u);return o}case xa:return t(new Date(a),i);case ka:{const{source:o,flags:l}=a;return t(new RegExp(o,l),i)}case Sa:{const o=t(new Map,i);for(const[l,u]of a)o.set(r(l),r(u));return o}case Ea:{const o=t(new Set,i);for(const l of a)o.add(r(l));return o}case xu:{const{name:o,message:l}=a;return t(new Lo[o](l),i)}case ku:return t(BigInt(a),i);case"BigInt":return t(Object(BigInt(a)),i)}return t(new Lo[s](a),i)};return r},$o=n=>Jp(new Map,n)(0),cn="",{toString:Kp}={},{keys:Xp}=Object,Bn=n=>{const e=typeof n;if(e!=="object"||!n)return[Qi,e];const t=Kp.call(n).slice(8,-1);switch(t){case"Array":return[ii,cn];case"Object":return[si,cn];case"Date":return[xa,cn];case"RegExp":return[ka,cn];case"Map":return[Sa,cn];case"Set":return[Ea,cn]}return t.includes("Array")?[ii,t]:t.includes("Error")?[xu,t]:[si,t]},jr=([n,e])=>n===Qi&&(e==="function"||e==="symbol"),Qp=(n,e,t,r)=>{const i=(a,o)=>{const l=r.push(a)-1;return t.set(o,l),l},s=a=>{if(t.has(a))return t.get(a);let[o,l]=Bn(a);switch(o){case Qi:{let c=a;switch(l){case"bigint":o=ku,c=a.toString();break;case"function":case"symbol":if(n)throw new TypeError("unable to serialize "+l);c=null;break;case"undefined":return i([vu],a)}return i([o,c],a)}case ii:{if(l)return i([l,[...a]],a);const c=[],d=i([o,c],a);for(const f of a)c.push(s(f));return d}case si:{if(l)switch(l){case"BigInt":return i([l,a.toString()],a);case"Boolean":case"Number":case"String":return i([l,a.valueOf()],a)}if(e&&"toJSON"in a)return s(a.toJSON());const c=[],d=i([o,c],a);for(const f of Xp(a))(n||!jr(Bn(a[f])))&&c.push([s(f),s(a[f])]);return d}case xa:return i([o,a.toISOString()],a);case ka:{const{source:c,flags:d}=a;return i([o,{source:c,flags:d}],a)}case Sa:{const c=[],d=i([o,c],a);for(const[f,h]of a)(n||!(jr(Bn(f))||jr(Bn(h))))&&c.push([s(f),s(h)]);return d}case Ea:{const c=[],d=i([o,c],a);for(const f of a)(n||!jr(Bn(f)))&&c.push(s(f));return d}}const{message:u}=a;return i([o,{name:l,message:u}],a)};return s},Mo=(n,{json:e,lossy:t}={})=>{const r=[];return Qp(!(e||t),!!e,new Map,r)(n),r},ai=typeof structuredClone=="function"?(n,e)=>e&&("json"in e||"lossy"in e)?$o(Mo(n,e)):structuredClone(n):(n,e)=>$o(Mo(n,e));function Yp(n,e){const t=[{type:"text",value:"↩"}];return e>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),t}function em(n,e){return"Back to reference "+(n+1)+(e>1?"-"+e:"")}function tm(n){const e=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",t=n.options.footnoteBackContent||Yp,r=n.options.footnoteBackLabel||em,i=n.options.footnoteLabel||"Footnotes",s=n.options.footnoteLabelTagName||"h2",a=n.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let l=-1;for(;++l<n.footnoteOrder.length;){const u=n.footnoteById.get(n.footnoteOrder[l]);if(!u)continue;const c=n.all(u),d=String(u.identifier).toUpperCase(),f=Nn(d.toLowerCase());let h=0;const p=[],w=n.footnoteCounts.get(d);for(;w!==void 0&&++h<=w;){p.length>0&&p.push({type:"text",value:" "});let _=typeof t=="string"?t:t(l,h);typeof _=="string"&&(_={type:"text",value:_}),p.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+f+(h>1?"-"+h:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,h),className:["data-footnote-backref"]},children:Array.isArray(_)?_:[_]})}const y=c[c.length-1];if(y&&y.type==="element"&&y.tagName==="p"){const _=y.children[y.children.length-1];_&&_.type==="text"?_.value+=" ":y.children.push({type:"text",value:" "}),y.children.push(...p)}else c.push(...p);const b={type:"element",tagName:"li",properties:{id:e+"fn-"+f},children:n.wrap(c,!0)};n.patch(u,b),o.push(b)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:s,properties:{...ai(a),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:n.wrap(o,!0)},{type:"text",value:`
`}]}}const Su=function(n){if(n==null)return sm;if(typeof n=="function")return Yi(n);if(typeof n=="object")return Array.isArray(n)?nm(n):rm(n);if(typeof n=="string")return im(n);throw new Error("Expected function, string, or object as test")};function nm(n){const e=[];let t=-1;for(;++t<n.length;)e[t]=Su(n[t]);return Yi(r);function r(...i){let s=-1;for(;++s<e.length;)if(e[s].apply(this,i))return!0;return!1}}function rm(n){const e=n;return Yi(t);function t(r){const i=r;let s;for(s in n)if(i[s]!==e[s])return!1;return!0}}function im(n){return Yi(e);function e(t){return t&&t.type===n}}function Yi(n){return e;function e(t,r,i){return!!(am(t)&&n.call(this,t,typeof r=="number"?r:void 0,i||void 0))}}function sm(){return!0}function am(n){return n!==null&&typeof n=="object"&&"type"in n}const Eu=[],om=!0,Do=!1,lm="skip";function um(n,e,t,r){let i;typeof e=="function"&&typeof t!="function"?(r=t,t=e):i=e;const s=Su(i),a=r?-1:1;o(n,void 0,[])();function o(l,u,c){const d=l&&typeof l=="object"?l:{};if(typeof d.type=="string"){const h=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(l.type+(h?"<"+h+">":""))+")"})}return f;function f(){let h=Eu,p,w,y;if((!e||s(l,u,c[c.length-1]||void 0))&&(h=cm(t(l,c)),h[0]===Do))return h;if("children"in l&&l.children){const b=l;if(b.children&&h[0]!==lm)for(w=(r?b.children.length:-1)+a,y=c.concat(b);w>-1&&w<b.children.length;){const _=b.children[w];if(p=o(_,w,y)(),p[0]===Do)return p;w=typeof p[1]=="number"?p[1]:w+a}}return h}}}function cm(n){return Array.isArray(n)?n:typeof n=="number"?[om,n]:n==null?Eu:[n]}function Au(n,e,t,r){let i,s,a;typeof e=="function"&&typeof t!="function"?(s=void 0,a=e,i=t):(s=e,a=t,i=r),um(n,s,o,i);function o(l,u){const c=u[u.length-1],d=c?c.children.indexOf(l):void 0;return a(l,d,c)}}const Hs={}.hasOwnProperty,dm={};function hm(n,e){const t=e||dm,r=new Map,i=new Map,s=new Map,a={...Gp,...t.handlers},o={all:u,applyData:pm,definitionById:r,footnoteById:i,footnoteCounts:s,footnoteOrder:[],handlers:a,one:l,options:t,patch:fm,wrap:gm};return Au(n,function(c){if(c.type==="definition"||c.type==="footnoteDefinition"){const d=c.type==="definition"?r:i,f=String(c.identifier).toUpperCase();d.has(f)||d.set(f,c)}}),o;function l(c,d){const f=c.type,h=o.handlers[f];if(Hs.call(o.handlers,f)&&h)return h(o,c,d);if(o.options.passThrough&&o.options.passThrough.includes(f)){if("children"in c){const{children:w,...y}=c,b=ai(y);return b.children=o.all(c),b}return ai(c)}return(o.options.unknownHandler||mm)(o,c,d)}function u(c){const d=[];if("children"in c){const f=c.children;let h=-1;for(;++h<f.length;){const p=o.one(f[h],c);if(p){if(h&&f[h-1].type==="break"&&(!Array.isArray(p)&&p.type==="text"&&(p.value=Bo(p.value)),!Array.isArray(p)&&p.type==="element")){const w=p.children[0];w&&w.type==="text"&&(w.value=Bo(w.value))}Array.isArray(p)?d.push(...p):d.push(p)}}}return d}}function fm(n,e){n.position&&(e.position=Wd(n))}function pm(n,e){let t=e;if(n&&n.data){const r=n.data.hName,i=n.data.hChildren,s=n.data.hProperties;if(typeof r=="string")if(t.type==="element")t.tagName=r;else{const a="children"in t?t.children:[t];t={type:"element",tagName:r,properties:{},children:a}}t.type==="element"&&s&&Object.assign(t.properties,ai(s)),"children"in t&&t.children&&i!==null&&i!==void 0&&(t.children=i)}return t}function mm(n,e){const t=e.data||{},r="value"in e&&!(Hs.call(t,"hProperties")||Hs.call(t,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:n.all(e)};return n.patch(e,r),n.applyData(e,r)}function gm(n,e){const t=[];let r=-1;for(e&&t.push({type:"text",value:`
`});++r<n.length;)r&&t.push({type:"text",value:`
`}),t.push(n[r]);return e&&n.length>0&&t.push({type:"text",value:`
`}),t}function Bo(n){let e=0,t=n.charCodeAt(e);for(;t===9||t===32;)e++,t=n.charCodeAt(e);return n.slice(e)}function Fo(n,e){const t=hm(n,e),r=t.one(n,void 0),i=tm(t),s=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return i&&s.children.push({type:"text",value:`
`},i),s}function ym(n,e){return n&&"run"in n?async function(t,r){const i=Fo(t,{file:r,...e});await n.run(i,r)}:function(t,r){return Fo(t,{file:r,...e||n})}}function zo(n){if(n)throw n}var Hr=Object.prototype.hasOwnProperty,Cu=Object.prototype.toString,Uo=Object.defineProperty,Ho=Object.getOwnPropertyDescriptor,Zo=function(e){return typeof Array.isArray=="function"?Array.isArray(e):Cu.call(e)==="[object Array]"},Vo=function(e){if(!e||Cu.call(e)!=="[object Object]")return!1;var t=Hr.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Hr.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var i;for(i in e);return typeof i>"u"||Hr.call(e,i)},qo=function(e,t){Uo&&t.name==="__proto__"?Uo(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},Wo=function(e,t){if(t==="__proto__")if(Hr.call(e,t)){if(Ho)return Ho(e,t).value}else return;return e[t]},bm=function n(){var e,t,r,i,s,a,o=arguments[0],l=1,u=arguments.length,c=!1;for(typeof o=="boolean"&&(c=o,o=arguments[1]||{},l=2),(o==null||typeof o!="object"&&typeof o!="function")&&(o={});l<u;++l)if(e=arguments[l],e!=null)for(t in e)r=Wo(o,t),i=Wo(e,t),o!==i&&(c&&i&&(Vo(i)||(s=Zo(i)))?(s?(s=!1,a=r&&Zo(r)?r:[]):a=r&&Vo(r)?r:{},qo(o,{name:t,newValue:n(c,a,i)})):typeof i<"u"&&qo(o,{name:t,newValue:i}));return o};const ps=Ki(bm);function Zs(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}function wm(){const n=[],e={run:t,use:r};return e;function t(...i){let s=-1;const a=i.pop();if(typeof a!="function")throw new TypeError("Expected function as last argument, not "+a);o(null,...i);function o(l,...u){const c=n[++s];let d=-1;if(l){a(l);return}for(;++d<i.length;)(u[d]===null||u[d]===void 0)&&(u[d]=i[d]);i=u,c?_m(c,o)(...u):a(null,...u)}}function r(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return n.push(i),e}}function _m(n,e){let t;return r;function r(...a){const o=n.length>a.length;let l;o&&a.push(i);try{l=n.apply(this,a)}catch(u){const c=u;if(o&&t)throw c;return i(c)}o||(l&&l.then&&typeof l.then=="function"?l.then(s,i):l instanceof Error?i(l):s(l))}function i(a,...o){t||(t=!0,e(a,...o))}function s(a){i(null,a)}}const dt={basename:vm,dirname:xm,extname:km,join:Sm,sep:"/"};function vm(n,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Ar(n);let t=0,r=-1,i=n.length,s;if(e===void 0||e.length===0||e.length>n.length){for(;i--;)if(n.codePointAt(i)===47){if(s){t=i+1;break}}else r<0&&(s=!0,r=i+1);return r<0?"":n.slice(t,r)}if(e===n)return"";let a=-1,o=e.length-1;for(;i--;)if(n.codePointAt(i)===47){if(s){t=i+1;break}}else a<0&&(s=!0,a=i+1),o>-1&&(n.codePointAt(i)===e.codePointAt(o--)?o<0&&(r=i):(o=-1,r=a));return t===r?r=a:r<0&&(r=n.length),n.slice(t,r)}function xm(n){if(Ar(n),n.length===0)return".";let e=-1,t=n.length,r;for(;--t;)if(n.codePointAt(t)===47){if(r){e=t;break}}else r||(r=!0);return e<0?n.codePointAt(0)===47?"/":".":e===1&&n.codePointAt(0)===47?"//":n.slice(0,e)}function km(n){Ar(n);let e=n.length,t=-1,r=0,i=-1,s=0,a;for(;e--;){const o=n.codePointAt(e);if(o===47){if(a){r=e+1;break}continue}t<0&&(a=!0,t=e+1),o===46?i<0?i=e:s!==1&&(s=1):i>-1&&(s=-1)}return i<0||t<0||s===0||s===1&&i===t-1&&i===r+1?"":n.slice(i,t)}function Sm(...n){let e=-1,t;for(;++e<n.length;)Ar(n[e]),n[e]&&(t=t===void 0?n[e]:t+"/"+n[e]);return t===void 0?".":Em(t)}function Em(n){Ar(n);const e=n.codePointAt(0)===47;let t=Am(n,!e);return t.length===0&&!e&&(t="."),t.length>0&&n.codePointAt(n.length-1)===47&&(t+="/"),e?"/"+t:t}function Am(n,e){let t="",r=0,i=-1,s=0,a=-1,o,l;for(;++a<=n.length;){if(a<n.length)o=n.codePointAt(a);else{if(o===47)break;o=47}if(o===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(t.length<2||r!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(l=t.lastIndexOf("/"),l!==t.length-1){l<0?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),i=a,s=0;continue}}else if(t.length>0){t="",r=0,i=a,s=0;continue}}e&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+n.slice(i+1,a):t=n.slice(i+1,a),r=a-i-1;i=a,s=0}else o===46&&s>-1?s++:s=-1}return t}function Ar(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}const Cm={cwd:Im};function Im(){return"/"}function Vs(n){return!!(n!==null&&typeof n=="object"&&"href"in n&&n.href&&"protocol"in n&&n.protocol&&n.auth===void 0)}function Pm(n){if(typeof n=="string")n=new URL(n);else if(!Vs(n)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+n+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(n.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return Tm(n)}function Tm(n){if(n.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=n.pathname;let t=-1;for(;++t<e.length;)if(e.codePointAt(t)===37&&e.codePointAt(t+1)===50){const r=e.codePointAt(t+2);if(r===70||r===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(e)}const ms=["history","path","basename","stem","extname","dirname"];class Iu{constructor(e){let t;e?Vs(e)?t={path:e}:typeof e=="string"||Om(e)?t={value:e}:t=e:t={},this.cwd=Cm.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<ms.length;){const s=ms[r];s in t&&t[s]!==void 0&&t[s]!==null&&(this[s]=s==="history"?[...t[s]]:t[s])}let i;for(i in t)ms.includes(i)||(this[i]=t[i])}get basename(){return typeof this.path=="string"?dt.basename(this.path):void 0}set basename(e){ys(e,"basename"),gs(e,"basename"),this.path=dt.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?dt.dirname(this.path):void 0}set dirname(e){Go(this.basename,"dirname"),this.path=dt.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?dt.extname(this.path):void 0}set extname(e){if(gs(e,"extname"),Go(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=dt.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){Vs(e)&&(e=Pm(e)),ys(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?dt.basename(this.path,this.extname):void 0}set stem(e){ys(e,"stem"),gs(e,"stem"),this.path=dt.join(this.dirname||"",e+(this.extname||""))}fail(e,t,r){const i=this.message(e,t,r);throw i.fatal=!0,i}info(e,t,r){const i=this.message(e,t,r);return i.fatal=void 0,i}message(e,t,r){const i=new Se(e,t,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function gs(n,e){if(n&&n.includes(dt.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+dt.sep+"`")}function ys(n,e){if(!n)throw new Error("`"+e+"` cannot be empty")}function Go(n,e){if(!n)throw new Error("Setting `"+e+"` requires `path` to be set too")}function Om(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const Rm=function(n){const r=this.constructor.prototype,i=r[n],s=function(){return i.apply(s,arguments)};Object.setPrototypeOf(s,r);const a=Object.getOwnPropertyNames(i);for(const o of a){const l=Object.getOwnPropertyDescriptor(i,o);l&&Object.defineProperty(s,o,l)}return s},Nm={}.hasOwnProperty;class Aa extends Rm{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=wm()}copy(){const e=new Aa;let t=-1;for(;++t<this.attachers.length;){const r=this.attachers[t];e.use(...r)}return e.data(ps(!0,{},this.namespace)),e}data(e,t){return typeof e=="string"?arguments.length===2?(_s("data",this.frozen),this.namespace[e]=t,this):Nm.call(this.namespace,e)&&this.namespace[e]||void 0:e?(_s("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const i=t.call(e,...r);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=Lr(e),r=this.parser||this.Parser;return bs("parse",r),r(String(t),t)}process(e,t){const r=this;return this.freeze(),bs("process",this.parser||this.Parser),ws("process",this.compiler||this.Compiler),t?i(void 0,t):new Promise(i);function i(s,a){const o=Lr(e),l=r.parse(o);r.run(l,o,function(c,d,f){if(c||!d||!f)return u(c);const h=d,p=r.stringify(h,f);$m(p)?f.value=p:f.result=p,u(c,f)});function u(c,d){c||!d?a(c):s?s(d):t(void 0,d)}}}processSync(e){let t=!1,r;return this.freeze(),bs("processSync",this.parser||this.Parser),ws("processSync",this.compiler||this.Compiler),this.process(e,i),Ko("processSync","process",t),r;function i(s,a){t=!0,zo(s),r=a}}run(e,t,r){Jo(e),this.freeze();const i=this.transformers;return!r&&typeof t=="function"&&(r=t,t=void 0),r?s(void 0,r):new Promise(s);function s(a,o){const l=Lr(t);i.run(e,l,u);function u(c,d,f){const h=d||e;c?o(c):a?a(h):r(void 0,h,f)}}}runSync(e,t){let r=!1,i;return this.run(e,t,s),Ko("runSync","run",r),i;function s(a,o){zo(a),i=o,r=!0}}stringify(e,t){this.freeze();const r=Lr(t),i=this.compiler||this.Compiler;return ws("stringify",i),Jo(e),i(e,r)}use(e,...t){const r=this.attachers,i=this.namespace;if(_s("use",this.frozen),e!=null)if(typeof e=="function")l(e,t);else if(typeof e=="object")Array.isArray(e)?o(e):a(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function s(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[c,...d]=u;l(c,d)}else a(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function a(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(u.plugins),u.settings&&(i.settings=ps(!0,i.settings,u.settings))}function o(u){let c=-1;if(u!=null)if(Array.isArray(u))for(;++c<u.length;){const d=u[c];s(d)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,c){let d=-1,f=-1;for(;++d<r.length;)if(r[d][0]===u){f=d;break}if(f===-1)r.push([u,...c]);else if(c.length>0){let[h,...p]=c;const w=r[f][1];Zs(w)&&Zs(h)&&(h=ps(!0,w,h)),r[f]=[u,h,...p]}}}}const jm=new Aa().freeze();function bs(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `parser`")}function ws(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `compiler`")}function _s(n,e){if(e)throw new Error("Cannot call `"+n+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Jo(n){if(!Zs(n)||typeof n.type!="string")throw new TypeError("Expected node, got `"+n+"`")}function Ko(n,e,t){if(!t)throw new Error("`"+n+"` finished async. Use `"+e+"` instead")}function Lr(n){return Lm(n)?n:new Iu(n)}function Lm(n){return!!(n&&typeof n=="object"&&"message"in n&&"messages"in n)}function $m(n){return typeof n=="string"||Mm(n)}function Mm(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const Dm="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Xo=[],Qo={allowDangerousHtml:!0},Bm=/^(https?|ircs?|mailto|xmpp)$/i,Fm=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function zm(n){const e=n.allowedElements,t=n.allowElement,r=n.children||"",i=n.className,s=n.components,a=n.disallowedElements,o=n.rehypePlugins||Xo,l=n.remarkPlugins||Xo,u=n.remarkRehypeOptions?{...n.remarkRehypeOptions,...Qo}:Qo,c=n.skipHtml,d=n.unwrapDisallowed,f=n.urlTransform||Um,h=jm().use(xp).use(l).use(ym,u).use(o),p=new Iu;typeof r=="string"&&(p.value=r);for(const _ of Fm)Object.hasOwn(n,_.from)&&(""+_.from+(_.to?"use `"+_.to+"` instead":"remove it")+Dm+_.id,void 0);const w=h.parse(p);let y=h.runSync(w,p);return i&&(y={type:"element",tagName:"div",properties:{className:i},children:y.type==="root"?y.children:[y]}),Au(y,b),Yd(y,{Fragment:F.Fragment,components:s,ignoreInvalidStyle:!0,jsx:F.jsx,jsxs:F.jsxs,passKeys:!0,passNode:!0});function b(_,v,P){if(_.type==="raw"&&P&&typeof v=="number")return c?P.children.splice(v,1):P.children[v]={type:"text",value:_.value},v;if(_.type==="element"){let C;for(C in ds)if(Object.hasOwn(ds,C)&&Object.hasOwn(_.properties,C)){const x=_.properties[C],N=ds[C];(N===null||N.includes(_.tagName))&&(_.properties[C]=f(String(x||""),C,_))}}if(_.type==="element"){let C=e?!e.includes(_.tagName):a?a.includes(_.tagName):!1;if(!C&&t&&typeof v=="number"&&(C=!t(_,v,P)),C&&P&&typeof v=="number")return d&&_.children?P.children.splice(v,1,..._.children):P.children.splice(v,1),v}}}function Um(n){const e=n.indexOf(":"),t=n.indexOf("?"),r=n.indexOf("#"),i=n.indexOf("/");return e<0||i>-1&&e>i||t>-1&&e>t||r>-1&&e>r||Bm.test(n.slice(0,e))?n:""}const Hm=K.forwardRef(function(n,e){const{preMessageList:t,className:r,engine:i}=n,{messageList:s,loading:a,generating:o,chatInstance:l}=hd({preMessageList:t,engine:i}),u=K.useRef(null),c=d=>{var f,h;(f=l.current)==null||f.sendMessage(d),(h=u.current)==null||h.setInput("")};return K.useImperativeHandle(e,()=>({sendMessage:d=>{c(d)},clearMessage:()=>{var d;(d=l.current)==null||d.clearMessage()},getInput(){return u.current.getInput()}})),F.jsxs("div",{className:`h-full overflow-auto pt-3  flex flex-col justify-between ${r}`,children:[F.jsx("div",{className:"grow overflow-hidden",children:F.jsx("div",{className:"cat_message_wrapper space-y-3 px-2 py-2 h-full overflow-y-scroll",children:s.map((d,f)=>F.jsx("div",{className:`flex ${d.role==="user"?"justify-end":"justify-start"}`,children:F.jsxs("div",{className:`${d.role==="user"?"bg-neutral text-neutral-content rounded-br-md":"bg-neutral text-neutral-content rounded-tl-md"} ${d.isError?"text-error-content":""} group rounded-3xl  px-4 py-3 relative shadow break-words min-w-0`,children:[F.jsx(zm,{children:d.content}),(a||o)&&f===s.length-1&&F.jsx(rd,{})]})},f))})}),F.jsxs("div",{className:"shrink-0",children:[n.toolSlot?n.toolSlot:null,F.jsx(nd,{ref:u,onSubmit:c,placeholder:""})]})]})}),Zm=K.forwardRef(function(e,t){return F.jsx("div",{className:"h-full",children:F.jsx(id,{FallbackComponent:r=>F.jsx(fd,{fallbackProps:r}),children:F.jsx(Hm,{ref:t,...e})})})});class Zr{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}var G;(function(n){n.assertEqual=i=>i;function e(i){}n.assertIs=e;function t(i){throw new Error}n.assertNever=t,n.arrayToEnum=i=>{const s={};for(const a of i)s[a]=a;return s},n.getValidEnumValues=i=>{const s=n.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(const o of s)a[o]=i[o];return n.objectValues(a)},n.objectValues=i=>n.objectKeys(i).map(function(s){return i[s]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},n.find=(i,s)=>{for(const a of i)if(s(a))return a},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}n.joinValues=r,n.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(G||(G={}));var qs;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(qs||(qs={}));const O=G.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Dt=n=>{switch(typeof n){case"undefined":return O.undefined;case"string":return O.string;case"number":return isNaN(n)?O.nan:O.number;case"boolean":return O.boolean;case"function":return O.function;case"bigint":return O.bigint;case"symbol":return O.symbol;case"object":return Array.isArray(n)?O.array:n===null?O.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?O.promise:typeof Map<"u"&&n instanceof Map?O.map:typeof Set<"u"&&n instanceof Set?O.set:typeof Date<"u"&&n instanceof Date?O.date:O.object;default:return O.unknown}},S=G.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Vm=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class ze extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(s){return s.message},r={_errors:[]},i=s=>{for(const a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,l=0;for(;l<a.path.length;){const u=a.path[l];l===a.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(a))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return i(this),r}static assert(e){if(!(e instanceof ze))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,G.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}ze.create=n=>new ze(n);const In=(n,e)=>{let t;switch(n.code){case S.invalid_type:n.received===O.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case S.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,G.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:t=`Unrecognized key(s) in object: ${G.joinValues(n.keys,", ")}`;break;case S.invalid_union:t="Invalid input";break;case S.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${G.joinValues(n.options)}`;break;case S.invalid_enum_value:t=`Invalid enum value. Expected ${G.joinValues(n.options)}, received '${n.received}'`;break;case S.invalid_arguments:t="Invalid function arguments";break;case S.invalid_return_type:t="Invalid function return type";break;case S.invalid_date:t="Invalid date";break;case S.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:G.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case S.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case S.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case S.custom:t="Invalid input";break;case S.invalid_intersection_types:t="Intersection results could not be merged";break;case S.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case S.not_finite:t="Number must be finite";break;default:t=e.defaultError,G.assertNever(n)}return{message:t}};let Pu=In;function qm(n){Pu=n}function oi(){return Pu}const li=n=>{const{data:e,path:t,errorMaps:r,issueData:i}=n,s=[...t,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="";const l=r.filter(u=>!!u).slice().reverse();for(const u of l)o=u(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},Wm=[];function T(n,e){const t=oi(),r=li({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===In?void 0:In].filter(i=>!!i)});n.common.issues.push(r)}class ke{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const i of t){if(i.status==="aborted")return M;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const i of t){const s=await i.key,a=await i.value;r.push({key:s,value:a})}return ke.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const i of t){const{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return M;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(r[s.value]=a.value)}return{status:e.value,value:r}}}const M=Object.freeze({status:"aborted"}),gn=n=>({status:"dirty",value:n}),Ie=n=>({status:"valid",value:n}),Ws=n=>n.status==="aborted",Gs=n=>n.status==="dirty",sr=n=>n.status==="valid",ar=n=>typeof Promise<"u"&&n instanceof Promise;function ui(n,e,t,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function Tu(n,e,t,r,i){if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var R;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(R||(R={}));var Fn,zn;class bt{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Yo=(n,e)=>{if(sr(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ze(n.common.issues);return this._error=t,this._error}}};function H(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:i}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var l,u;const{message:c}=n;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(u=c??t)!==null&&u!==void 0?u:o.defaultError}},description:i}}class Z{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Dt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Dt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ke,ctx:{common:e.parent.common,data:e.data,parsedType:Dt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ar(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const i={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Dt(e)},s=this._parseSync({data:e,path:i.path,parent:i});return Yo(i,s)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Dt(e)},i=this._parse({data:e,path:r.path,parent:r}),s=await(ar(i)?i:Promise.resolve(i));return Yo(r,s)}refine(e,t){const r=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,s)=>{const a=e(i),o=()=>s.addIssue({code:S.custom,...r(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(l=>l?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof t=="function"?t(r,i):t),!1))}_refinement(e){return new lt({schema:this,typeName:A.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return yt.create(this,this._def)}nullable(){return Ht.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ot.create(this,this._def)}promise(){return Tn.create(this,this._def)}or(e){return cr.create([this,e],this._def)}and(e){return dr.create(this,e,this._def)}transform(e){return new lt({...H(this._def),schema:this,typeName:A.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new gr({...H(this._def),innerType:this,defaultValue:t,typeName:A.ZodDefault})}brand(){return new Ca({typeName:A.ZodBranded,type:this,...H(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new yr({...H(this._def),innerType:this,catchValue:t,typeName:A.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Cr.create(this,e)}readonly(){return br.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Gm=/^c[^\s-]{8,}$/i,Jm=/^[0-9a-z]+$/,Km=/^[0-9A-HJKMNP-TV-Z]{26}$/,Xm=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Qm=/^[a-z0-9_-]{21}$/i,Ym=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,eg=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,tg="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let vs;const ng=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,rg=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ig=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ou="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",sg=new RegExp(`^${Ou}$`);function Ru(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function ag(n){return new RegExp(`^${Ru(n)}$`)}function Nu(n){let e=`${Ou}T${Ru(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function og(n,e){return!!((e==="v4"||!e)&&ng.test(n)||(e==="v6"||!e)&&rg.test(n))}class st extends Z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==O.string){const s=this._getOrReturnCtx(e);return T(s,{code:S.invalid_type,expected:O.string,received:s.parsedType}),M}const r=new ke;let i;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),T(i,{code:S.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),T(i,{code:S.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?T(i,{code:S.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&T(i,{code:S.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")eg.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"email",code:S.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")vs||(vs=new RegExp(tg,"u")),vs.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"emoji",code:S.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")Xm.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"uuid",code:S.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")Qm.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"nanoid",code:S.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")Gm.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"cuid",code:S.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")Jm.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"cuid2",code:S.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")Km.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"ulid",code:S.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),T(i,{validation:"url",code:S.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"regex",code:S.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),T(i,{code:S.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),T(i,{code:S.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),T(i,{code:S.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?Nu(s).test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{code:S.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?sg.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{code:S.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?ag(s).test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{code:S.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?Ym.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"duration",code:S.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?og(e.data,s.version)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"ip",code:S.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?ig.test(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{validation:"base64",code:S.invalid_string,message:s.message}),r.dirty()):G.assertNever(s);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(i=>e.test(i),{validation:t,code:S.invalid_string,...R.errToObj(r)})}_addCheck(e){return new st({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...R.errToObj(e)})}url(e){return this._addCheck({kind:"url",...R.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...R.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...R.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...R.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...R.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...R.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...R.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...R.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...R.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...R.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...R.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...R.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...R.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...R.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...R.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...R.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...R.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...R.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...R.errToObj(t)})}nonempty(e){return this.min(1,R.errToObj(e))}trim(){return new st({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new st({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new st({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}st.create=n=>{var e;return new st({checks:[],typeName:A.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...H(n)})};function lg(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=t>r?t:r,s=parseInt(n.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}class Ft extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==O.number){const s=this._getOrReturnCtx(e);return T(s,{code:S.invalid_type,expected:O.number,received:s.parsedType}),M}let r;const i=new ke;for(const s of this._def.checks)s.kind==="int"?G.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{code:S.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:S.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:S.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?lg(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),T(r,{code:S.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{code:S.not_finite,message:s.message}),i.dirty()):G.assertNever(s);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,R.toString(t))}gt(e,t){return this.setLimit("min",e,!1,R.toString(t))}lte(e,t){return this.setLimit("max",e,!0,R.toString(t))}lt(e,t){return this.setLimit("max",e,!1,R.toString(t))}setLimit(e,t,r,i){return new Ft({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:R.toString(i)}]})}_addCheck(e){return new Ft({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:R.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:R.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:R.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:R.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:R.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&G.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ft.create=n=>new Ft({checks:[],typeName:A.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...H(n)});class zt extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==O.bigint){const s=this._getOrReturnCtx(e);return T(s,{code:S.invalid_type,expected:O.bigint,received:s.parsedType}),M}let r;const i=new ke;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:S.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:S.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),T(r,{code:S.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):G.assertNever(s);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,R.toString(t))}gt(e,t){return this.setLimit("min",e,!1,R.toString(t))}lte(e,t){return this.setLimit("max",e,!0,R.toString(t))}lt(e,t){return this.setLimit("max",e,!1,R.toString(t))}setLimit(e,t,r,i){return new zt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:R.toString(i)}]})}_addCheck(e){return new zt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:R.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}zt.create=n=>{var e;return new zt({checks:[],typeName:A.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...H(n)})};class or extends Z{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==O.boolean){const r=this._getOrReturnCtx(e);return T(r,{code:S.invalid_type,expected:O.boolean,received:r.parsedType}),M}return Ie(e.data)}}or.create=n=>new or({typeName:A.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...H(n)});class tn extends Z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==O.date){const s=this._getOrReturnCtx(e);return T(s,{code:S.invalid_type,expected:O.date,received:s.parsedType}),M}if(isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return T(s,{code:S.invalid_date}),M}const r=new ke;let i;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),T(i,{code:S.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),T(i,{code:S.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):G.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new tn({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:R.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:R.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}tn.create=n=>new tn({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:A.ZodDate,...H(n)});class ci extends Z{_parse(e){if(this._getType(e)!==O.symbol){const r=this._getOrReturnCtx(e);return T(r,{code:S.invalid_type,expected:O.symbol,received:r.parsedType}),M}return Ie(e.data)}}ci.create=n=>new ci({typeName:A.ZodSymbol,...H(n)});class lr extends Z{_parse(e){if(this._getType(e)!==O.undefined){const r=this._getOrReturnCtx(e);return T(r,{code:S.invalid_type,expected:O.undefined,received:r.parsedType}),M}return Ie(e.data)}}lr.create=n=>new lr({typeName:A.ZodUndefined,...H(n)});class ur extends Z{_parse(e){if(this._getType(e)!==O.null){const r=this._getOrReturnCtx(e);return T(r,{code:S.invalid_type,expected:O.null,received:r.parsedType}),M}return Ie(e.data)}}ur.create=n=>new ur({typeName:A.ZodNull,...H(n)});class Pn extends Z{constructor(){super(...arguments),this._any=!0}_parse(e){return Ie(e.data)}}Pn.create=n=>new Pn({typeName:A.ZodAny,...H(n)});class Yt extends Z{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ie(e.data)}}Yt.create=n=>new Yt({typeName:A.ZodUnknown,...H(n)});class Ot extends Z{_parse(e){const t=this._getOrReturnCtx(e);return T(t,{code:S.invalid_type,expected:O.never,received:t.parsedType}),M}}Ot.create=n=>new Ot({typeName:A.ZodNever,...H(n)});class di extends Z{_parse(e){if(this._getType(e)!==O.undefined){const r=this._getOrReturnCtx(e);return T(r,{code:S.invalid_type,expected:O.void,received:r.parsedType}),M}return Ie(e.data)}}di.create=n=>new di({typeName:A.ZodVoid,...H(n)});class ot extends Z{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==O.array)return T(t,{code:S.invalid_type,expected:O.array,received:t.parsedType}),M;if(i.exactLength!==null){const a=t.data.length>i.exactLength.value,o=t.data.length<i.exactLength.value;(a||o)&&(T(t,{code:a?S.too_big:S.too_small,minimum:o?i.exactLength.value:void 0,maximum:a?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(T(t,{code:S.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(T(t,{code:S.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>i.type._parseAsync(new bt(t,a,t.path,o)))).then(a=>ke.mergeArray(r,a));const s=[...t.data].map((a,o)=>i.type._parseSync(new bt(t,a,t.path,o)));return ke.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new ot({...this._def,minLength:{value:e,message:R.toString(t)}})}max(e,t){return new ot({...this._def,maxLength:{value:e,message:R.toString(t)}})}length(e,t){return new ot({...this._def,exactLength:{value:e,message:R.toString(t)}})}nonempty(e){return this.min(1,e)}}ot.create=(n,e)=>new ot({type:n,minLength:null,maxLength:null,exactLength:null,typeName:A.ZodArray,...H(e)});function hn(n){if(n instanceof ce){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=yt.create(hn(r))}return new ce({...n._def,shape:()=>e})}else return n instanceof ot?new ot({...n._def,type:hn(n.element)}):n instanceof yt?yt.create(hn(n.unwrap())):n instanceof Ht?Ht.create(hn(n.unwrap())):n instanceof wt?wt.create(n.items.map(e=>hn(e))):n}class ce extends Z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=G.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==O.object){const u=this._getOrReturnCtx(e);return T(u,{code:S.invalid_type,expected:O.object,received:u.parsedType}),M}const{status:r,ctx:i}=this._processInputParams(e),{shape:s,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ot&&this._def.unknownKeys==="strip"))for(const u in i.data)a.includes(u)||o.push(u);const l=[];for(const u of a){const c=s[u],d=i.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new bt(i,d,i.path,u)),alwaysSet:u in i.data})}if(this._def.catchall instanceof Ot){const u=this._def.unknownKeys;if(u==="passthrough")for(const c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:i.data[c]}});else if(u==="strict")o.length>0&&(T(i,{code:S.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const c of o){const d=i.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new bt(i,d,i.path,c)),alwaysSet:c in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const u=[];for(const c of l){const d=await c.key,f=await c.value;u.push({key:d,value:f,alwaysSet:c.alwaysSet})}return u}).then(u=>ke.mergeObjectSync(r,u)):ke.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return R.errToObj,new ce({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var i,s,a,o;const l=(a=(s=(i=this._def).errorMap)===null||s===void 0?void 0:s.call(i,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=R.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new ce({...this._def,unknownKeys:"strip"})}passthrough(){return new ce({...this._def,unknownKeys:"passthrough"})}extend(e){return new ce({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ce({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:A.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ce({...this._def,catchall:e})}pick(e){const t={};return G.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new ce({...this._def,shape:()=>t})}omit(e){const t={};return G.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new ce({...this._def,shape:()=>t})}deepPartial(){return hn(this)}partial(e){const t={};return G.objectKeys(this.shape).forEach(r=>{const i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}),new ce({...this._def,shape:()=>t})}required(e){const t={};return G.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof yt;)s=s._def.innerType;t[r]=s}}),new ce({...this._def,shape:()=>t})}keyof(){return ju(G.objectKeys(this.shape))}}ce.create=(n,e)=>new ce({shape:()=>n,unknownKeys:"strip",catchall:Ot.create(),typeName:A.ZodObject,...H(e)});ce.strictCreate=(n,e)=>new ce({shape:()=>n,unknownKeys:"strict",catchall:Ot.create(),typeName:A.ZodObject,...H(e)});ce.lazycreate=(n,e)=>new ce({shape:n,unknownKeys:"strip",catchall:Ot.create(),typeName:A.ZodObject,...H(e)});class cr extends Z{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function i(s){for(const o of s)if(o.result.status==="valid")return o.result;for(const o of s)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=s.map(o=>new ze(o.ctx.common.issues));return T(t,{code:S.invalid_union,unionErrors:a}),M}if(t.common.async)return Promise.all(r.map(async s=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(i);{let s;const a=[];for(const l of r){const u={...t,common:{...t.common,issues:[]},parent:null},c=l._parseSync({data:t.data,path:t.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!s&&(s={result:c,ctx:u}),u.common.issues.length&&a.push(u.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const o=a.map(l=>new ze(l));return T(t,{code:S.invalid_union,unionErrors:o}),M}}get options(){return this._def.options}}cr.create=(n,e)=>new cr({options:n,typeName:A.ZodUnion,...H(e)});const At=n=>n instanceof fr?At(n.schema):n instanceof lt?At(n.innerType()):n instanceof pr?[n.value]:n instanceof Ut?n.options:n instanceof mr?G.objectValues(n.enum):n instanceof gr?At(n._def.innerType):n instanceof lr?[void 0]:n instanceof ur?[null]:n instanceof yt?[void 0,...At(n.unwrap())]:n instanceof Ht?[null,...At(n.unwrap())]:n instanceof Ca||n instanceof br?At(n.unwrap()):n instanceof yr?At(n._def.innerType):[];class es extends Z{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==O.object)return T(t,{code:S.invalid_type,expected:O.object,received:t.parsedType}),M;const r=this.discriminator,i=t.data[r],s=this.optionsMap.get(i);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(T(t,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),M)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const i=new Map;for(const s of t){const a=At(s.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,s)}}return new es({typeName:A.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...H(r)})}}function Js(n,e){const t=Dt(n),r=Dt(e);if(n===e)return{valid:!0,data:n};if(t===O.object&&r===O.object){const i=G.objectKeys(e),s=G.objectKeys(n).filter(o=>i.indexOf(o)!==-1),a={...n,...e};for(const o of s){const l=Js(n[o],e[o]);if(!l.valid)return{valid:!1};a[o]=l.data}return{valid:!0,data:a}}else if(t===O.array&&r===O.array){if(n.length!==e.length)return{valid:!1};const i=[];for(let s=0;s<n.length;s++){const a=n[s],o=e[s],l=Js(a,o);if(!l.valid)return{valid:!1};i.push(l.data)}return{valid:!0,data:i}}else return t===O.date&&r===O.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class dr extends Z{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=(s,a)=>{if(Ws(s)||Ws(a))return M;const o=Js(s.value,a.value);return o.valid?((Gs(s)||Gs(a))&&t.dirty(),{status:t.value,value:o.data}):(T(r,{code:S.invalid_intersection_types}),M)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,a])=>i(s,a)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}dr.create=(n,e,t)=>new dr({left:n,right:e,typeName:A.ZodIntersection,...H(t)});class wt extends Z{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==O.array)return T(r,{code:S.invalid_type,expected:O.array,received:r.parsedType}),M;if(r.data.length<this._def.items.length)return T(r,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),M;!this._def.rest&&r.data.length>this._def.items.length&&(T(r,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...r.data].map((a,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new bt(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(s).then(a=>ke.mergeArray(t,a)):ke.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new wt({...this._def,rest:e})}}wt.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new wt({items:n,typeName:A.ZodTuple,rest:null,...H(e)})};class hr extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==O.object)return T(r,{code:S.invalid_type,expected:O.object,received:r.parsedType}),M;const i=[],s=this._def.keyType,a=this._def.valueType;for(const o in r.data)i.push({key:s._parse(new bt(r,o,r.path,o)),value:a._parse(new bt(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?ke.mergeObjectAsync(t,i):ke.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Z?new hr({keyType:e,valueType:t,typeName:A.ZodRecord,...H(r)}):new hr({keyType:st.create(),valueType:e,typeName:A.ZodRecord,...H(t)})}}class hi extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==O.map)return T(r,{code:S.invalid_type,expected:O.map,received:r.parsedType}),M;const i=this._def.keyType,s=this._def.valueType,a=[...r.data.entries()].map(([o,l],u)=>({key:i._parse(new bt(r,o,r.path,[u,"key"])),value:s._parse(new bt(r,l,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of a){const u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return M;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of a){const u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return M;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}}}}hi.create=(n,e,t)=>new hi({valueType:e,keyType:n,typeName:A.ZodMap,...H(t)});class nn extends Z{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==O.set)return T(r,{code:S.invalid_type,expected:O.set,received:r.parsedType}),M;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(T(r,{code:S.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(T(r,{code:S.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const s=this._def.valueType;function a(l){const u=new Set;for(const c of l){if(c.status==="aborted")return M;c.status==="dirty"&&t.dirty(),u.add(c.value)}return{status:t.value,value:u}}const o=[...r.data.values()].map((l,u)=>s._parse(new bt(r,l,r.path,u)));return r.common.async?Promise.all(o).then(l=>a(l)):a(o)}min(e,t){return new nn({...this._def,minSize:{value:e,message:R.toString(t)}})}max(e,t){return new nn({...this._def,maxSize:{value:e,message:R.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}nn.create=(n,e)=>new nn({valueType:n,minSize:null,maxSize:null,typeName:A.ZodSet,...H(e)});class xn extends Z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==O.function)return T(t,{code:S.invalid_type,expected:O.function,received:t.parsedType}),M;function r(o,l){return li({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,oi(),In].filter(u=>!!u),issueData:{code:S.invalid_arguments,argumentsError:l}})}function i(o,l){return li({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,oi(),In].filter(u=>!!u),issueData:{code:S.invalid_return_type,returnTypeError:l}})}const s={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Tn){const o=this;return Ie(async function(...l){const u=new ze([]),c=await o._def.args.parseAsync(l,s).catch(h=>{throw u.addIssue(r(l,h)),u}),d=await Reflect.apply(a,this,c);return await o._def.returns._def.type.parseAsync(d,s).catch(h=>{throw u.addIssue(i(d,h)),u})})}else{const o=this;return Ie(function(...l){const u=o._def.args.safeParse(l,s);if(!u.success)throw new ze([r(l,u.error)]);const c=Reflect.apply(a,this,u.data),d=o._def.returns.safeParse(c,s);if(!d.success)throw new ze([i(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new xn({...this._def,args:wt.create(e).rest(Yt.create())})}returns(e){return new xn({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new xn({args:e||wt.create([]).rest(Yt.create()),returns:t||Yt.create(),typeName:A.ZodFunction,...H(r)})}}class fr extends Z{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}fr.create=(n,e)=>new fr({getter:n,typeName:A.ZodLazy,...H(e)});class pr extends Z{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return T(t,{received:t.data,code:S.invalid_literal,expected:this._def.value}),M}return{status:"valid",value:e.data}}get value(){return this._def.value}}pr.create=(n,e)=>new pr({value:n,typeName:A.ZodLiteral,...H(e)});function ju(n,e){return new Ut({values:n,typeName:A.ZodEnum,...H(e)})}class Ut extends Z{constructor(){super(...arguments),Fn.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return T(t,{expected:G.joinValues(r),received:t.parsedType,code:S.invalid_type}),M}if(ui(this,Fn)||Tu(this,Fn,new Set(this._def.values)),!ui(this,Fn).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return T(t,{received:t.data,code:S.invalid_enum_value,options:r}),M}return Ie(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ut.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ut.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}Fn=new WeakMap;Ut.create=ju;class mr extends Z{constructor(){super(...arguments),zn.set(this,void 0)}_parse(e){const t=G.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==O.string&&r.parsedType!==O.number){const i=G.objectValues(t);return T(r,{expected:G.joinValues(i),received:r.parsedType,code:S.invalid_type}),M}if(ui(this,zn)||Tu(this,zn,new Set(G.getValidEnumValues(this._def.values))),!ui(this,zn).has(e.data)){const i=G.objectValues(t);return T(r,{received:r.data,code:S.invalid_enum_value,options:i}),M}return Ie(e.data)}get enum(){return this._def.values}}zn=new WeakMap;mr.create=(n,e)=>new mr({values:n,typeName:A.ZodNativeEnum,...H(e)});class Tn extends Z{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==O.promise&&t.common.async===!1)return T(t,{code:S.invalid_type,expected:O.promise,received:t.parsedType}),M;const r=t.parsedType===O.promise?t.data:Promise.resolve(t.data);return Ie(r.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Tn.create=(n,e)=>new Tn({type:n,typeName:A.ZodPromise,...H(e)});class lt extends Z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===A.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:a=>{T(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){const a=i.transform(r.data,s);if(r.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return M;const l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?M:l.status==="dirty"||t.value==="dirty"?gn(l.value):l});{if(t.value==="aborted")return M;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?M:o.status==="dirty"||t.value==="dirty"?gn(o.value):o}}if(i.type==="refinement"){const a=o=>{const l=i.refinement(o,s);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?M:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?M:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(i.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!sr(a))return a;const o=i.transform(a.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>sr(a)?Promise.resolve(i.transform(a.value,s)).then(o=>({status:t.value,value:o})):a);G.assertNever(i)}}lt.create=(n,e,t)=>new lt({schema:n,typeName:A.ZodEffects,effect:e,...H(t)});lt.createWithPreprocess=(n,e,t)=>new lt({schema:e,effect:{type:"preprocess",transform:n},typeName:A.ZodEffects,...H(t)});class yt extends Z{_parse(e){return this._getType(e)===O.undefined?Ie(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}yt.create=(n,e)=>new yt({innerType:n,typeName:A.ZodOptional,...H(e)});class Ht extends Z{_parse(e){return this._getType(e)===O.null?Ie(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ht.create=(n,e)=>new Ht({innerType:n,typeName:A.ZodNullable,...H(e)});class gr extends Z{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===O.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}gr.create=(n,e)=>new gr({innerType:n,typeName:A.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...H(e)});class yr extends Z{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ar(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ze(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ze(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}yr.create=(n,e)=>new yr({innerType:n,typeName:A.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...H(e)});class fi extends Z{_parse(e){if(this._getType(e)!==O.nan){const r=this._getOrReturnCtx(e);return T(r,{code:S.invalid_type,expected:O.nan,received:r.parsedType}),M}return{status:"valid",value:e.data}}}fi.create=n=>new fi({typeName:A.ZodNaN,...H(n)});const ug=Symbol("zod_brand");class Ca extends Z{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Cr extends Z{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?M:s.status==="dirty"?(t.dirty(),gn(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?M:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,t){return new Cr({in:e,out:t,typeName:A.ZodPipeline})}}class br extends Z{_parse(e){const t=this._def.innerType._parse(e),r=i=>(sr(i)&&(i.value=Object.freeze(i.value)),i);return ar(t)?t.then(i=>r(i)):r(t)}unwrap(){return this._def.innerType}}br.create=(n,e)=>new br({innerType:n,typeName:A.ZodReadonly,...H(e)});function Lu(n,e={},t){return n?Pn.create().superRefine((r,i)=>{var s,a;if(!n(r)){const o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,l=(a=(s=o.fatal)!==null&&s!==void 0?s:t)!==null&&a!==void 0?a:!0,u=typeof o=="string"?{message:o}:o;i.addIssue({code:"custom",...u,fatal:l})}}):Pn.create()}const cg={object:ce.lazycreate};var A;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(A||(A={}));const dg=(n,e={message:`Input not instance of ${n.name}`})=>Lu(t=>t instanceof n,e),$u=st.create,Mu=Ft.create,hg=fi.create,fg=zt.create,Du=or.create,pg=tn.create,mg=ci.create,gg=lr.create,yg=ur.create,bg=Pn.create,wg=Yt.create,_g=Ot.create,vg=di.create,xg=ot.create,kg=ce.create,Sg=ce.strictCreate,Eg=cr.create,Ag=es.create,Cg=dr.create,Ig=wt.create,Pg=hr.create,Tg=hi.create,Og=nn.create,Rg=xn.create,Ng=fr.create,jg=pr.create,Lg=Ut.create,$g=mr.create,Mg=Tn.create,el=lt.create,Dg=yt.create,Bg=Ht.create,Fg=lt.createWithPreprocess,zg=Cr.create,Ug=()=>$u().optional(),Hg=()=>Mu().optional(),Zg=()=>Du().optional(),Vg={string:n=>st.create({...n,coerce:!0}),number:n=>Ft.create({...n,coerce:!0}),boolean:n=>or.create({...n,coerce:!0}),bigint:n=>zt.create({...n,coerce:!0}),date:n=>tn.create({...n,coerce:!0})},qg=M;var tl=Object.freeze({__proto__:null,defaultErrorMap:In,setErrorMap:qm,getErrorMap:oi,makeIssue:li,EMPTY_PATH:Wm,addIssueToContext:T,ParseStatus:ke,INVALID:M,DIRTY:gn,OK:Ie,isAborted:Ws,isDirty:Gs,isValid:sr,isAsync:ar,get util(){return G},get objectUtil(){return qs},ZodParsedType:O,getParsedType:Dt,ZodType:Z,datetimeRegex:Nu,ZodString:st,ZodNumber:Ft,ZodBigInt:zt,ZodBoolean:or,ZodDate:tn,ZodSymbol:ci,ZodUndefined:lr,ZodNull:ur,ZodAny:Pn,ZodUnknown:Yt,ZodNever:Ot,ZodVoid:di,ZodArray:ot,ZodObject:ce,ZodUnion:cr,ZodDiscriminatedUnion:es,ZodIntersection:dr,ZodTuple:wt,ZodRecord:hr,ZodMap:hi,ZodSet:nn,ZodFunction:xn,ZodLazy:fr,ZodLiteral:pr,ZodEnum:Ut,ZodNativeEnum:mr,ZodPromise:Tn,ZodEffects:lt,ZodTransformer:lt,ZodOptional:yt,ZodNullable:Ht,ZodDefault:gr,ZodCatch:yr,ZodNaN:fi,BRAND:ug,ZodBranded:Ca,ZodPipeline:Cr,ZodReadonly:br,custom:Lu,Schema:Z,ZodSchema:Z,late:cg,get ZodFirstPartyTypeKind(){return A},coerce:Vg,any:bg,array:xg,bigint:fg,boolean:Du,date:pg,discriminatedUnion:Ag,effect:el,enum:Lg,function:Rg,instanceof:dg,intersection:Cg,lazy:Ng,literal:jg,map:Tg,nan:hg,nativeEnum:$g,never:_g,null:yg,nullable:Bg,number:Mu,object:kg,oboolean:Zg,onumber:Hg,optional:Dg,ostring:Ug,pipeline:zg,preprocess:Fg,promise:Mg,record:Pg,set:Og,strictObject:Sg,string:$u,symbol:mg,transformer:el,tuple:Ig,undefined:gg,union:Eg,unknown:wg,void:vg,NEVER:qg,ZodIssueCode:S,quotelessJson:Vm,ZodError:ze}),ts={exports:{}},Bu={};function qe(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var Wg=qe;qe.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};qe.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};qe.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};qe.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};qe.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};qe.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};qe.prototype.start=qe.prototype.try;qe.prototype.errors=function(){return this._errors};qe.prototype.attempts=function(){return this._attempts};qe.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var i=this._errors[r],s=i.message,a=(n[s]||0)+1;n[s]=a,a>=t&&(e=i,t=a)}return e};(function(n){var e=Wg;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)r[i]=t[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],a=0;a<r.retries;a++)s.push(this.createTimeout(a,r));return t&&t.forever&&!s.length&&s.push(this.createTimeout(a,r)),s.sort(function(o,l){return o-l}),s},n.createTimeout=function(t,r){var i=r.randomize?Math.random()+1:1,s=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return s=Math.min(s,r.maxTimeout),s},n.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var s in t)typeof t[s]=="function"&&i.push(s)}for(var a=0;a<i.length;a++){var o=i[a],l=t[o];t[o]=(function(c){var d=n.operation(r),f=Array.prototype.slice.call(arguments,1),h=f.pop();f.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),h.apply(this,arguments))}),d.attempt(function(){c.apply(t,f)})}).bind(t,l),t[o].options=r}}})(Bu);var Gg=Bu;const Jg=Gg,Kg=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class Fu extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Xg=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},Qg=n=>Kg.includes(n),zu=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const i=Jg.operation(e);i.attempt(async s=>{try{t(await n(s))}catch(a){if(!(a instanceof Error)){r(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof Fu)i.stop(),r(a.originalError);else if(a instanceof TypeError&&!Qg(a.message))i.stop(),r(a);else{Xg(a,s,e);try{await e.onFailedAttempt(a)}catch(o){r(o);return}i.retry(a)||r(i.mainError())}}})});ts.exports=zu;ts.exports.default=zu;ts.exports.AbortError=Fu;var Yg=ts.exports;const pi=Ki(Yg);let $r;const ey=new Uint8Array(16);function ty(){if(!$r&&($r=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!$r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $r(ey)}const ny=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Uu(n){return typeof n=="string"&&ny.test(n)}const ye=[];for(let n=0;n<256;++n)ye.push((n+256).toString(16).slice(1));function ry(n,e=0){return ye[n[e+0]]+ye[n[e+1]]+ye[n[e+2]]+ye[n[e+3]]+"-"+ye[n[e+4]]+ye[n[e+5]]+"-"+ye[n[e+6]]+ye[n[e+7]]+"-"+ye[n[e+8]]+ye[n[e+9]]+"-"+ye[n[e+10]]+ye[n[e+11]]+ye[n[e+12]]+ye[n[e+13]]+ye[n[e+14]]+ye[n[e+15]]}const iy=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),nl={randomUUID:iy};function ft(n,e,t){if(nl.randomUUID&&!e&&!n)return nl.randomUUID();n=n||{};const r=n.random||(n.rng||ty)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ry(r)}var sy=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const ay=Ki(sy);var Hu={exports:{}};const oy=/[\p{Lu}]/u,ly=/[\p{Ll}]/u,rl=/^[\p{Lu}](?![\p{Lu}])/gu,Zu=/([\p{Alpha}\p{N}_]|$)/u,Vu=/[_.\- ]+/,uy=new RegExp("^"+Vu.source),il=new RegExp(Vu.source+Zu.source,"gu"),sl=new RegExp("\\d+"+Zu.source,"gu"),cy=(n,e,t)=>{let r=!1,i=!1,s=!1;for(let a=0;a<n.length;a++){const o=n[a];r&&oy.test(o)?(n=n.slice(0,a)+"-"+n.slice(a),r=!1,s=i,i=!0,a++):i&&s&&ly.test(o)?(n=n.slice(0,a-1)+"-"+n.slice(a-1),s=i,i=!1,r=!0):(r=e(o)===o&&t(o)!==o,s=i,i=t(o)===o&&e(o)!==o)}return n},dy=(n,e)=>(rl.lastIndex=0,n.replace(rl,t=>e(t))),hy=(n,e)=>(il.lastIndex=0,sl.lastIndex=0,n.replace(il,(t,r)=>e(r)).replace(sl,t=>e(t))),qu=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(s=>s.trim()).filter(s=>s.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),r=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=cy(n,t,r)),n=n.replace(uy,""),e.preserveConsecutiveUppercase?n=dy(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),hy(n,r))};Hu.exports=qu;Hu.exports.default=qu;function fy(n,e){return(e==null?void 0:e[n])||ay(n)}function py(n,e,t){const r={};for(const i in n)Object.hasOwn(n,i)&&(r[e(i,t)]=n[i]);return r}function al(n){return Array.isArray(n)?[...n]:{...n}}function my(n,e){const t=al(n);for(const[r,i]of Object.entries(e)){const[s,...a]=r.split(".").reverse();let o=t;for(const l of a.reverse()){if(o[l]===void 0)break;o[l]=al(o[l]),o=o[l]}o[s]!==void 0&&(o[s]={lc:1,type:"secret",id:[i]})}return t}function Wu(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class rn{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Wu(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof rn||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((i,s)=>(i[s]=s in this?this[s]:this.lc_kwargs[s],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(t,Reflect.get(i,"lc_secrets",this)),Object.assign(r,Reflect.get(i,"lc_attributes",this));return Object.keys(t).forEach(i=>{let s=this,a=r;const[o,...l]=i.split(".").reverse();for(const u of l.reverse()){if(!(u in s)||s[u]===void 0)return;(!(u in a)||a[u]===void 0)&&(typeof s[u]=="object"&&s[u]!=null?a[u]={}:Array.isArray(s[u])&&(a[u]=[])),s=s[u],a=a[u]}o in s&&s[o]!==void 0&&(a[o]=a[o]||s[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:py(Object.keys(t).length?my(r,t):r,fy,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}var xs={};const gy=()=>typeof window<"u"&&typeof window.document<"u",yy=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",by=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Gu=()=>typeof Deno<"u",wy=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Gu(),_y=()=>{let n;return gy()?n="browser":wy()?n="node":yy()?n="webworker":by()?n="jsdom":Gu()?n="deno":n="other",n};let ks;async function vy(){return ks===void 0&&(ks={library:"langchain-js",runtime:_y()}),ks}function Re(n){try{return typeof process<"u"?xs==null?void 0:xs[n]:void 0}catch{return}}class xy{}class Ir extends xy{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Wu(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Re("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.awaitHandlers=e._awaitHandler??this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return rn.prototype.toJSON.call(this)}toJSONNotImplemented(){return rn.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends Ir{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ft()}),Object.assign(this,e)}}return new t}}var Ia={exports:{}};Ia.exports;(function(n){const t=(s=0)=>a=>`\x1B[${38+s};5;${a}m`,r=(s=0)=>(a,o,l)=>`\x1B[${38+s};2;${a};${o};${l}m`;function i(){const s=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,l]of Object.entries(a)){for(const[u,c]of Object.entries(l))a[u]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},l[u]=a[u],s.set(c[0],c[1]);Object.defineProperty(a,o,{value:l,enumerable:!1})}return Object.defineProperty(a,"codes",{value:s,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=r(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,l,u)=>o===l&&l===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:u}=l.groups;u.length===3&&(u=u.split("").map(d=>d+d).join(""));const c=Number.parseInt(u,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(n,"exports",{enumerable:!0,get:i})})(Ia);var ky=Ia.exports;const Ju=Ki(ky);function Ss(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function Sy(n){return n.replace(/[-:.]/g,"")}function Ey(n,e,t){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return Sy(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}class ns extends Ir{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){var i;const t=Ey(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const s=this.runMap.get(r.parent_run_id);s&&(this._addChildRun(s,r),s.child_execution_order=Math.max(s.child_execution_order,r.child_execution_order),r.trace_id=s.trace_id,s.dotted_order!==void 0&&(r.dotted_order=[s.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;this.runMap.set(r.id,r),await((i=this.onRunCreate)==null?void 0:i.call(this,r))}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,i,s,a,o,l){var h;const u=this._getExecutionOrder(i),c=Date.now(),d=o?{...s,metadata:o}:s,f={id:r,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:a||[]};return await this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f)),f}async handleChatModelStart(e,t,r,i,s,a,o,l){var h;const u=this._getExecutionOrder(i),c=Date.now(),d=o?{...s,metadata:o}:s,f={id:r,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:a||[]};return await this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f)),f}async handleLLMEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onLLMEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleLLMError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onLLMError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleChainStart(e,t,r,i,s,a,o,l){var f;const u=this._getExecutionOrder(i),c=Date.now(),d={id:r,name:l??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(d),await((f=this.onChainStart)==null?void 0:f.call(this,d)),d}async handleChainEnd(e,t,r,i,s){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Ss(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(s==null?void 0:s.inputs)!==void 0&&(a.inputs=Ss(s.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,r,i,s){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(s==null?void 0:s.inputs)!==void 0&&(a.inputs=Ss(s.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleToolStart(e,t,r,i,s,a,o){var d;const l=this._getExecutionOrder(i),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(c),await((d=this.onToolStart)==null?void 0:d.call(this,c)),c}async handleToolEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onToolEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onToolError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const i=r;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentAction)==null?void 0:s.call(this,r))}async handleAgentEnd(e,t){var i;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentEnd)==null?void 0:i.call(this,r)))}async handleRetrieverStart(e,t,r,i,s,a,o){var d;const l=this._getExecutionOrder(i),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(c),await((d=this.onRetrieverStart)==null?void 0:d.call(this,c)),c}async handleRetrieverEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var i;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((i=this.onText)==null?void 0:i.call(this,r)))}async handleLLMNewToken(e,t,r,i,s,a){var l;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}function Ae(n,e){return`${n.open}${e}${n.close}`}function Qe(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function jt(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Te}=Ju;class ol extends ns{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const i=this.runMap.get(r.parent_run_id);if(i)t.push(i),r=i;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((i,s,a)=>{const o=`${i.execution_order}:${i.run_type}:${i.name}`;return s===a.length-1?Ae(Ju.bold,o):o}).join(" > ");return Ae(Te.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Qe(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.cyan,"[chain/end]")} [${t}] [${jt(e)}] Exiting Chain run with output: ${Qe(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.red,"[chain/error]")} [${t}] [${jt(e)}] Chain run errored with error: ${Qe(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${Ae(Te.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Qe(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.cyan,"[llm/end]")} [${t}] [${jt(e)}] Exiting LLM run with output: ${Qe(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.red,"[llm/error]")} [${t}] [${jt(e)}] LLM run errored with error: ${Qe(e.error,"[error]")}`)}onToolStart(e){var r;const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,i;const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.cyan,"[tool/end]")} [${t}] [${jt(e)}] Exiting Tool run with output: "${(i=(r=e.outputs)==null?void 0:r.output)==null?void 0:i.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.red,"[tool/error]")} [${t}] [${jt(e)}] Tool run errored with error: ${Qe(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Qe(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.cyan,"[retriever/end]")} [${t}] [${jt(e)}] Exiting Retriever run with output: ${Qe(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Ae(Te.red,"[retriever/error]")} [${t}] [${jt(e)}] Retriever run errored with error: ${Qe(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${Ae(Te.blue,"[agent/action]")} [${r}] Agent selected action: ${Qe(t.actions[t.actions.length-1],"[action]")}`)}}var Ku={},Xu={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function s(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new i(c,d||l,f),p=t?t+u:u;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],h]:l._events[p].push(h):(l._events[p]=h,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,f,h,p){var w=t?t+u:u;if(!this._events[w])return!1;var y=this._events[w],b=arguments.length,_,v;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),b){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,c),!0;case 3:return y.fn.call(y.context,c,d),!0;case 4:return y.fn.call(y.context,c,d,f),!0;case 5:return y.fn.call(y.context,c,d,f,h),!0;case 6:return y.fn.call(y.context,c,d,f,h,p),!0}for(v=1,_=new Array(b-1);v<b;v++)_[v-1]=arguments[v];y.fn.apply(y.context,_)}else{var P=y.length,C;for(v=0;v<P;v++)switch(y[v].once&&this.removeListener(u,y[v].fn,void 0,!0),b){case 1:y[v].fn.call(y[v].context);break;case 2:y[v].fn.call(y[v].context,c);break;case 3:y[v].fn.call(y[v].context,c,d);break;case 4:y[v].fn.call(y[v].context,c,d,f);break;default:if(!_)for(C=1,_=new Array(b-1);C<b;C++)_[C-1]=arguments[C];y[v].fn.apply(y[v].context,_)}}return!0},o.prototype.on=function(u,c,d){return s(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return s(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,f){var h=t?t+u:u;if(!this._events[h])return this;if(!c)return a(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&a(this,h);else{for(var w=0,y=[],b=p.length;w<b;w++)(p[w].fn!==c||f&&!p[w].once||d&&p[w].context!==d)&&y.push(p[w]);y.length?this._events[h]=y.length===1?y[0]:y:a(this,h)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&a(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(Xu);var Ay=Xu.exports,rs={exports:{}},Cy=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const Iy=Cy;class Qu extends Error{constructor(e){super(e),this.name="TimeoutError"}}const Yu=(n,e,t)=>new Promise((r,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const s=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(l){i(l)}return}const a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Qu(a);typeof n.cancel=="function"&&n.cancel(),i(o)},e);Iy(n.then(r,i),()=>{clearTimeout(s)})});rs.exports=Yu;rs.exports.default=Yu;rs.exports.TimeoutError=Qu;var Py=rs.exports,Pa={},Ta={};Object.defineProperty(Ta,"__esModule",{value:!0});function Ty(n,e,t){let r=0,i=n.length;for(;i>0;){const s=i/2|0;let a=r+s;t(n[a],e)<=0?(r=++a,i-=s+1):i=s}return r}Ta.default=Ty;Object.defineProperty(Pa,"__esModule",{value:!0});const Oy=Ta;class Ry{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const i=Oy.default(this._queue,r,(s,a)=>a.priority-s.priority);this._queue.splice(i,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}Pa.default=Ry;Object.defineProperty(Ku,"__esModule",{value:!0});const Ny=Ay,ec=Py,jy=Pa,Mr=()=>{},Ly=new ec.TimeoutError;class $y extends Ny{constructor(e){var t,r,i,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Mr,this._resolveIdle=Mr,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:jy.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Mr,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Mr,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,i)=>{const s=async()=>{this._pendingCount++,this._intervalCount++;try{const a=this._timeout===void 0&&t.timeout===void 0?e():ec.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&i(Ly)});r(await a)}catch(a){i(a)}this._next()};this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var Pt=Ku.default=$y;const My=[400,401,403,404,405,406,407,408],Dy=[409];let ll=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Pt?this.queue=new Pt.default({concurrency:this.maxConcurrency}):this.queue=new Pt({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>pi(()=>e(...t).catch(i=>{throw i instanceof Error?i:new Error(i)}),{async onFailedAttempt(i){if(i.message.startsWith("Cancel")||i.message.startsWith("TimeoutError")||i.message.startsWith("AbortError")||(i==null?void 0:i.code)==="ECONNABORTED")throw i;const s=i==null?void 0:i.response,a=s==null?void 0:s.status;if(a){if(My.includes(+a))throw i;if(Dy.includes(+a))return;r&&await r(s)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,s)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};function ul(n){return typeof(n==null?void 0:n._getType)=="function"}function cl(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}var er={};let Et;const By=()=>typeof window<"u"&&typeof window.document<"u",Fy=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",zy=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),tc=()=>typeof Deno<"u",Uy=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!tc(),Hy=()=>Et||(By()?Et="browser":Uy()?Et="node":Fy()?Et="webworker":zy()?Et="jsdom":tc()?Et="deno":Et="other",Et);let Es;async function Zy(){if(Es===void 0){const n=Hy(),e=Wy();Es={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:nc,...e}}return Es}function Vy(){const n=qy()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,i]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof i=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[r]=i);return e}function qy(){try{return typeof process<"u"&&er?Object.entries(er).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function Jt(n){try{return typeof process<"u"?er==null?void 0:er[n]:void 0}catch{return}}let As;function Wy(){if(As!==void 0)return As;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=Jt(t);r!==void 0&&(e[t]=r)}return As=e,e}function oe(n){if(!Uu(n))throw new Error(`Invalid UUID: ${n}`)}async function dl(n){const e=await Zy(),t=Vy();return n.map(r=>{const i=r.extra??{},s=i.metadata;return r.extra={...i,runtime:{...e,...i==null?void 0:i.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...s}},r})}const Gy=()=>{const n=Jt("LANGCHAIN_TRACING_SAMPLING_RATE");if(n===void 0)return;const e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},Jy=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},Lt=async(n,e)=>{const t=await n.text();if(!n.ok)throw new Error(`Failed to ${e}: ${n.status} ${n.statusText} ${t}`)};async function Ky(n){const e=[];for await(const t of n)e.push(t);return e}function Cs(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const Xy=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};class Qy{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise(t=>{this.items.push([e,t])})}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");const t=[];for(;t.length<e&&this.items.length;){const r=this.items.shift();if(r)t.push(r);else break}return[t.map(r=>r[0]),()=>t.forEach(r=>r[1]())]}}const Yy=20971520;class Oa{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Qy}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=Oa.getDefaultClientConfig();this.tracingSampleRate=Gy(),this.apiUrl=Cs(e.apiUrl??t.apiUrl)??"",this.apiKey=Cs(e.apiKey??t.apiKey),this.webUrl=Cs(e.webUrl??t.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new ll(e.callerOptions??{}),this.batchIngestCaller=new ll({...e.callerOptions??{},onFailedResponseHook:Xy}),this.hideInputs=e.hideInputs??t.hideInputs,this.hideOutputs=e.hideOutputs??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=Jt("LANGCHAIN_API_KEY"),t=Jt("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",r=Jt("LANGCHAIN_HIDE_INPUTS")==="true",i=Jt("LANGCHAIN_HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:Jy(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${nc}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",i=`${this.apiUrl}${e}?${r}`,s=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!s.ok)throw new Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);return s}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(i));const s=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);const o=await a.json();if(o.length===0||(yield o,o.length<i))break;r+=o.length}}async*_getCursorPaginatedList(e,t=null,r="POST",i="runs"){const s=t?{...t}:{};for(;;){const o=await(await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(s)})).json();if(!o||!o[i])break;yield o[i];const l=o.cursors;if(!l||!l.next)break;s.cursor=l.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const i of e)this.sampledPostUuids.has(i.id)&&(r.push(i),this.sampledPostUuids.delete(i.id));return r}else{const r=[];for(const i of e)Math.random()<this.tracingSampleRate&&(r.push(i),this.sampledPostUuids.add(i.id));return r}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){const[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length){t();return}try{await this.batchIngestRuns({runCreates:e.filter(r=>r.action==="create").map(r=>r.item),runUpdates:e.filter(r=>r.action==="update").map(r=>r.item)})}finally{t()}}}async processRunOperation(e,t){const r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;const i=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),i}async _getServerInfo(){const e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),new Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch{return!1}return!0}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const i=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){this.processRunOperation({action:"create",item:i}).catch(console.error);return}const s=await dl([i]),a=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(s[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Lt(a,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){var u,c;if(e===void 0&&t===void 0)return;let r=(e==null?void 0:e.map(d=>this.prepareRunCreateOrUpdateInputs(d)))??[],i=(t==null?void 0:t.map(d=>this.prepareRunCreateOrUpdateInputs(d)))??[];if(r.length>0&&i.length>0){const d=r.reduce((h,p)=>(p.id&&(h[p.id]=p),h),{}),f=[];for(const h of i)h.id!==void 0&&d[h.id]?d[h.id]={...d[h.id],...h}:f.push(h);r=Object.values(d),i=f}const s={post:this._filterForSampling(r),patch:this._filterForSampling(i,!0)};if(!s.post.length&&!s.patch.length)return;if(r=await dl(r),this.batchEndpointSupported===void 0&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const d of s.post)await this.createRun(d);for(const d of s.patch)d.id!==void 0&&await this.updateRun(d.id,d);return}const a=((c=(u=this.serverInfo)==null?void 0:u.batch_ingest_config)==null?void 0:c.size_limit_bytes)??Yy,o={post:[],patch:[]};let l=0;for(const d of["post","patch"]){const f=d,h=s[f].reverse();let p=h.pop();for(;p!==void 0;){const w=JSON.stringify(p);l>0&&l+w.length>a&&(await this._postBatchIngestRuns(JSON.stringify(o)),l=0,o.post=[],o.patch=[]),l+=w.length,o[f].push(p),p=h.pop()}}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(o))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Lt(r,"batch create run")}async updateRun(e,t){oe(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0){await this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const i={...this.headers,"Content-Type":"application/json"},s=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Lt(s,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){oe(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let i;t.session_id?i=t.session_id:r!=null&&r.projectName?i=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?i=r==null?void 0:r.projectId:i=(await this.readProject({projectName:Jt("LANGCHAIN_PROJECT")||"default"})).id;const s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${i}/r/${t.id}?poll=true`}else if(e!==void 0){const i=await this.readRun(e);if(!i.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${i.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await Ky(this.listRuns({id:e.child_run_ids})),r={},i={};t.sort((s,a)=>((s==null?void 0:s.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);s.parent_run_id in r||(r[s.parent_run_id]=[]),r[s.parent_run_id].push(s),i[s.id]=s}e.child_runs=r[e.id]||[];for(const s in r)s!==e.id&&(i[s].child_runs=r[s]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:i,traceId:s,referenceExampleId:a,startTime:o,executionOrder:l,isRoot:u,runType:c,error:d,id:f,query:h,filter:p,traceFilter:w,treeFilter:y,limit:b,select:_}=e;let v=[];if(t&&(v=Array.isArray(t)?t:[t]),r){const N=Array.isArray(r)?r:[r],ee=await Promise.all(N.map(D=>this.readProject({projectName:D}).then(Q=>Q.id)));v.push(...ee)}const P=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],C={session:v.length?v:null,run_type:c,reference_example:a,query:h,filter:p,trace_filter:w,tree_filter:y,execution_order:l,parent_run:i,start_time:o?o.toISOString():null,error:d,id:f,limit:b,trace:s,select:_||P,is_root:u};let x=0;for await(const N of this._getCursorPaginatedList("/runs/query",C))if(b){if(x>=b)break;if(N.length+x>b){yield*N.slice(0,b-x);break}x+=N.length,yield*N}else yield*N}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||ft()};oe(e);const s=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(s===null||!("share_token"in s))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${s.share_token}/r`}async unshareRun(e){oe(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Lt(t,"unshare run")}async readRunSharedLink(e){oe(e);const r=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const a of t)r.append("id",a);return oe(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),oe(e);const i=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};oe(e);const s=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async unshareDataset(e){oe(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Lt(t,"unshare dataset")}async readSharedDataset(e){return oe(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:s=null,referenceDatasetId:a=null}){const o=i?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=s||{};r&&(u.metadata=r);const c={name:e,extra:u,description:t};a!==null&&(c.reference_dataset_id=a);const d=await this.caller.call(fetch,l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),f=await d.json();if(!d.ok)throw new Error(`Failed to create session ${e}: ${d.status} ${d.statusText}`);return f}async updateProject(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:s=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=s;i&&(l={...l||{},metadata:i});const u={name:t,extra:l,description:r,end_time:a?new Date(a).toISOString():null},c=await this.caller.call(fetch,o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),d=await c.json();if(!c.ok)throw new Error(`Failed to update project ${e}: ${c.status} ${c.statusText}`);return d}async hasProject({projectId:e,projectName:t}){let r="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)oe(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");const s=await this.caller.call(fetch,`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const a=await s.json();return s.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let i="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)oe(e),i+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&s.append("include_stats",r.toString());const a=await this._get(i,s);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:s,referenceFree:a}={}){const o=new URLSearchParams;if(e!==void 0)for(const l of e)o.append("id",l);if(t!==void 0&&o.append("name",t),r!==void 0&&o.append("name_contains",r),i!==void 0)o.append("reference_dataset",i);else if(s!==void 0){const l=await this.readDataset({datasetName:s});o.append("reference_dataset",l.id)}a!==void 0&&o.append("reference_free",a.toString());for await(const l of this._getPaginated("/sessions",o))yield*l}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,oe(r);const i=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Lt(i,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:s,dataType:a,name:o}){const l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(f=>{u.append("input_keys",f)}),i.forEach(f=>{u.append("output_keys",f)}),s&&u.append("description",s),a&&u.append("data_type",a),o&&u.append("name",o);const c=await this.caller.call(fetch,l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!c.ok){const f=await c.json();throw f.detail&&f.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${c.status} ${c.statusText}`)}return await c.json()}async createDataset(e,{description:t,dataType:r}={}){const i={name:e,description:t};r&&(i.data_type=r);const s=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!s.ok){const o=await s.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${s.status} ${s.statusText}`)}return await s.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const i=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)oe(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide datasetName or datasetId");const s=await this._get(r,i);let a;if(Array.isArray(s)){if(s.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let s=e;if(s===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return await this._get(`/datasets/${s}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:s}={}){const a="/datasets",o=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const l of r)o.append("id",l);i!==void 0&&o.append("name",i),s!==void 0&&o.append("name_contains",s);for await(const l of this._getPaginated(a,o))yield*l}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",i=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(i=(await this.readDataset({datasetName:t})).id),i!==void 0)oe(i),r+=`/${i}`;else throw new Error("Must provide datasetName or datasetId");const s=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!s.ok)throw new Error(`Failed to delete ${r}: ${s.status} ${s.statusText}`);await s.json()}async createExample(e,t,{datasetId:r,datasetName:i,createdAt:s,exampleId:a,metadata:o}){let l=r;if(l===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(await this.readDataset({datasetName:i})).id);const u=s||new Date,c={dataset_id:l,inputs:e,outputs:t,created_at:u==null?void 0:u.toISOString(),id:a,metadata:o},d=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!d.ok)throw new Error(`Failed to create example: ${d.status} ${d.statusText}`);return await d.json()}async createExamples(e){const{inputs:t,outputs:r,metadata:i,sourceRunIds:s,exampleIds:a,datasetId:o,datasetName:l}=e;let u=o;if(u===void 0&&l===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&l!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:l})).id);const c=t.map((h,p)=>({dataset_id:u,inputs:h,outputs:r?r[p]:void 0,metadata:i?i[p]:void 0,id:a?a[p]:void 0,source_run_id:s?s[p]:void 0})),d=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!d.ok)throw new Error(`Failed to create examples: ${d.status} ${d.statusText}`);return await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const i=e.map(a=>ul(a)?cl(a):a),s=ul(t)?cl(t):t;return this.createExample({input:i},{output:s},r)}async readExample(e){oe(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:i,inlineS3Urls:s,metadata:a}={}){let o;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)o=e;else if(t!==void 0)o=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const l=new URLSearchParams({dataset:o}),u=i?typeof i=="string"?i:i==null?void 0:i.toISOString():void 0;u&&l.append("as_of",u);const c=s??!0;if(l.append("inline_s3_urls",c.toString()),r!==void 0)for(const d of r)l.append("id",d);if(a!==void 0){const d=JSON.stringify(a);l.append("metadata",d)}for await(const d of this._getPaginated("/examples",l))yield*d}async deleteExample(e){oe(e);const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){oe(e);const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:s}={loadChildRuns:!1}){let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(s=await this.readExample(a.reference_example_id));const o=await t.evaluateRun(a,s);let l=r??{};o.evaluatorInfo&&(l={...l,...o.evaluatorInfo});const u=o.targetRunId??a.id;return await this.createFeedback(u,o.key,{score:o==null?void 0:o.score,value:o==null?void 0:o.value,comment:o==null?void 0:o.comment,correction:o==null?void 0:o.correction,sourceInfo:l,feedbackSourceType:"model",sourceRunId:o==null?void 0:o.sourceRunId})}async createFeedback(e,t,{score:r,value:i,correction:s,comment:a,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:f,comparativeExperimentId:h}){var _;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};u!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:u}),(p==null?void 0:p.metadata)!==void 0&&((_=p.metadata.__run)==null?void 0:_.run_id)!==void 0&&oe(p.metadata.__run.run_id);const w={id:c??ft(),run_id:e,key:t,score:r,value:i,correction:s,comment:a,feedback_source:p,comparative_experiment_id:h,feedbackConfig:d,session_id:f},y=`${this.apiUrl}/feedback`,b=await this.caller.call(fetch,y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Lt(b,"create feedback"),w}async updateFeedback(e,{score:t,value:r,correction:i,comment:s}){const a={};t!=null&&(a.score=t),r!=null&&(a.value=r),i!=null&&(a.correction=i),s!=null&&(a.comment=s),oe(e);const o=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Lt(o,"update feedback")}async readFeedback(e){oe(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){oe(e);const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const i=new URLSearchParams;if(e&&i.append("run",e.join(",")),t)for(const s of t)i.append("key",s);if(r)for(const s of r)i.append("source",s);for await(const s of this._getPaginated("/feedback",i))yield*s}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:i}={}){const s={run_id:e,feedback_key:t,feedback_config:i};return r?typeof r=="string"?s.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(s.expires_in=r):s.expires_in={hours:3},await(await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:s,metadata:a,id:o}){var c;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:s,created_at:(c=i??new Date)==null?void 0:c.toISOString(),extra:{}};return a&&(l.extra.metadata=a),await(await this.caller.call(fetch,`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){oe(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async logEvaluationFeedback(e,t,r){const i=this._selectEvalResults(e);for(const s of i){let a=r||{};s.evaluatorInfo&&(a={...s.evaluatorInfo,...a});let o=null;s.targetRunId?o=s.targetRunId:t&&(o=t.id),await this.createFeedback(o,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:a,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"})}return i}}const nc="0.1.25";class eb extends ns{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:i}=e;this.projectName=r??Re("LANGCHAIN_PROJECT")??Re("LANGCHAIN_SESSION"),this.exampleId=t,this.client=i??new Oa({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await vy()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}}function tb(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,i=!1;for(let s of n){if(r)s==='"'&&!i?r=!1:s===`
`&&!i?s="\\n":s==="\\"?i=!i:i=!1;else if(s==='"')r=!0,i=!1;else if(s==="{")t.push("}");else if(s==="[")t.push("]");else if(s==="}"||s==="]")if(t&&t[t.length-1]===s)t.pop();else return null;e+=s}r&&(e+='"');for(let s=t.length-1;s>=0;s-=1)e+=t[s];try{return JSON.parse(e)}catch{return null}}function nb(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?[...n,...e]:[...n,{type:"text",text:e}]}class rb extends rn{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}function mi(n,e){const t={...n};for(const[r,i]of Object.entries(e))if(t[r]==null)t[r]=i;else{if(i==null)continue;if(typeof t[r]!=typeof i||Array.isArray(t[r])!==Array.isArray(i))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string")t[r]=t[r]+i;else if(!Array.isArray(t[r])&&typeof t[r]=="object")t[r]=mi(t[r],i);else if(Array.isArray(t[r]))t[r]=rc(t[r],i);else{if(t[r]===i)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function rc(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const i=t.findIndex(s=>s.index===r.index);i!==-1?t[i]=mi(t[i],r):t.push(r)}else t.push(r);return t}}}class ib extends rb{}class Ra extends ib{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{const r=[],i=[];for(const s of e.tool_call_chunks){let a={};try{if(a=tb(s.args??"{}")??{},typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");r.push({name:s.name??"",args:a,id:s.id})}catch{i.push({name:s.name,args:s.args,id:s.id,error:"Malformed args."})}}t={...e,tool_calls:r,invalid_tool_calls:i}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.tool_call_chunks=(t==null?void 0:t.tool_call_chunks)??this.tool_call_chunks,this.tool_calls=(t==null?void 0:t.tool_calls)??this.tool_calls,this.invalid_tool_calls=(t==null?void 0:t.invalid_tool_calls)??this.invalid_tool_calls}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){const t={content:nb(this.content,e.content),additional_kwargs:mi(this.additional_kwargs,e.additional_kwargs),response_metadata:mi(this.response_metadata,e.response_metadata),tool_call_chunks:[]};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const r=rc(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}return new Ra(t)}}function sb(n,e="Human",t="AI"){const r=[];for(const i of n){let s;if(i._getType()==="human")s=e;else if(i._getType()==="ai")s=t;else if(i._getType()==="system")s="System";else if(i._getType()==="function")s="Function";else if(i._getType()==="tool")s="Tool";else if(i._getType()==="generic")s=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);const a=i.name?`${i.name}, `:"";r.push(`${s}: ${a}${i.content}`)}return r.join(`
`)}async function ab(){return new eb}let Is;function ob(){const n="default"in Pt?Pt.default:Pt;return new n({autoStart:!0,concurrency:1})}async function we(n,e){e===!0?await n():(typeof Is>"u"&&(Is=ob()),Is.add(n))}function lb(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class ub{setHandler(e){return this.setHandlers([e])}}class is{constructor(e,t,r,i,s,a,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}async handleText(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleText: ${i}`)}},t.awaitHandlers)))}}class cb extends is{getChild(e){const t=new Ve(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch{console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${i}`)}},t.awaitHandlers)))}}class hl extends is{async handleLLMNewToken(e,t,r,i,s,a){await Promise.all(this.handlers.map(o=>we(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(u){console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`)}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${i}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${i}`)}},t.awaitHandlers)))}}class db extends is{getChild(e){const t=new Ve(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,i,s){await Promise.all(this.handlers.map(a=>we(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,s))}catch(l){console.error(`Error in handler ${a.constructor.name}, handleChainError: ${l}`)}},a.awaitHandlers)))}async handleChainEnd(e,t,r,i,s){await Promise.all(this.handlers.map(a=>we(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,s))}catch(l){console.error(`Error in handler ${a.constructor.name}, handleChainEnd: ${l}`)}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${i}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${i}`)}},t.awaitHandlers)))}}class hb extends is{getChild(e){const t=new Ve(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${i}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${i}`)}},t.awaitHandlers)))}}class Ve extends ub{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,i=void 0,s=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&r?r:ft();return await Promise.all(this.handlers.map(f=>we(async()=>{var h;if(!f.ignoreLLM)try{await((h=f.handleLLMStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,s,this.tags,this.metadata,l))}catch(p){console.error(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`)}},f.awaitHandlers))),new hl(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,i=void 0,s=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&r?r:ft();return await Promise.all(this.handlers.map(f=>we(async()=>{var h,p;if(!f.ignoreLLM)try{if(f.handleChatModelStart)await((h=f.handleChatModelStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,s,this.tags,this.metadata,l));else if(f.handleLLMStart){const w=sb(u);await((p=f.handleLLMStart)==null?void 0:p.call(f,e,[w],d,this._parentRunId,s,this.tags,this.metadata,l))}}catch(w){console.error(`Error in handler ${f.constructor.name}, handleLLMStart: ${w}`)}},f.awaitHandlers))),new hl(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=ft(),i=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>we(async()=>{var u;if(!l.ignoreChain)try{await((u=l.handleChainStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,i,o))}catch(c){console.error(`Error in handler ${l.constructor.name}, handleChainStart: ${c}`)}},l.awaitHandlers))),new db(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=ft(),i=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>we(async()=>{var u;if(!l.ignoreAgent)try{await((u=l.handleToolStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){console.error(`Error in handler ${l.constructor.name}, handleToolStart: ${c}`)}},l.awaitHandlers))),new hb(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=ft(),i=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>we(async()=>{var u;if(!l.ignoreRetriever)try{await((u=l.handleRetrieverStart)==null?void 0:u.call(l,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){console.error(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${c}`)}},l.awaitHandlers))),new cb(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new Ve(this._parentRunId);for(const i of this.handlers){const s=this.inheritableHandlers.includes(i);r.addHandler(i,s)}for(const i of this.tags){const s=this.inheritableTags.includes(i);r.addTags([i],s)}for(const i of Object.keys(this.metadata)){const s=Object.keys(this.inheritableMetadata).includes(i);r.addMetadata({[i]:this.metadata[i]},s)}for(const i of e)r.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===i.name)||r.addHandler(i,t);return r}static fromHandlers(e){class t extends Ir{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ft()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,i,s,a,o){let l;(e||t)&&(Array.isArray(e)||!e?(l=new Ve,l.setHandlers((e==null?void 0:e.map(gi))??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(gi):t==null?void 0:t.handlers,!1));const u=Re("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),c=Re("LANGCHAIN_TRACING_V2")==="true",d=c||(Re("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new Ve),u&&!l.handlers.some(f=>f.name===ol.prototype.name)){const f=new ol;l.addHandler(f,!0)}d&&!l.handlers.some(f=>f.name==="langchain_tracer")&&c&&l.addHandler(await ab(),!0)}return(r||i)&&l&&(l.addTags(r??[]),l.addTags(i??[],!1)),(s||a)&&l&&(l.addMetadata(s??{}),l.addMetadata(a??{},!1)),l}}function gi(n){return"name"in n?n:Ir.fromMethods(n)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const fb=Object.prototype.hasOwnProperty;function pb(n,e){return fb.call(n,e)}function mb(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)pb(n,t)&&e.push(t);return e}function On(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function Ks(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function gb(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function Xs(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Xs(n[t]))return!0}else if(typeof n=="object"){const t=mb(n),r=t.length;for(var e=0;e<r;e++)if(Xs(n[t[e]]))return!0}}return!1}function fl(n,e){const t=[n];for(const r in e){const i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&t.push(`${r}: ${i}`)}return t.join(`
`)}class yb extends Error{constructor(e,t,r,i,s){super(fl(e,{name:t,index:r,operation:i,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=fl(e,{name:t,index:r,operation:i,tree:s})}}const fe=yb,yn={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=Qs(t,this.path);r&&(r=On(r));const i=tr(t,{op:"remove",path:this.from}).removed;return tr(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=Qs(t,this.from);return tr(t,{op:"add",path:this.path,value:On(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:bi(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var bb={add:function(n,e,t){return Ks(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:yn.move,copy:yn.copy,test:yn.test,_get:yn._get};function Qs(n,e){if(e=="")return n;var t={op:"_get",path:e};return tr(n,t),t.value}function tr(n,e,t=!1,r=!0,i=!0,s=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):Ys(e,0)),e.path===""){let a={newDocument:n};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=n,a;if(e.op==="move"||e.op==="copy")return a.newDocument=Qs(n,e.from),e.op==="move"&&(a.removed=n),a;if(e.op==="test"){if(a.test=bi(n,e.value),a.test===!1)throw new fe("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return a.newDocument=n,a}else{if(e.op==="remove")return a.removed=n,a.newDocument=null,a;if(e.op==="_get")return e.value=n,a;if(t)throw new fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,n);return a}}else{r||(n=On(n));const o=(e.path||"").split("/");let l=n,u=1,c=o.length,d,f,h;for(typeof t=="function"?h=t:h=Ys;;){if(f=o[u],f&&f.indexOf("~")!=-1&&(f=gb(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[f]===void 0?d=o.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&h(e,0,n,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(t&&!Ks(f))throw new fe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,n);Ks(f)&&(f=~~f)}if(u>=c){if(t&&e.op==="add"&&f>l.length)throw new fe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,n);const p=bb[e.op].call(e,l,f,n);if(p.test===!1)throw new fe("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return p}}else if(u>=c){const p=yn[e.op].call(e,l,f,n);if(p.test===!1)throw new fe("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return p}if(l=l[f],t&&u<c&&(!l||typeof l!="object"))throw new fe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,n)}}}function yi(n,e,t,r=!0,i=!0){if(t&&!Array.isArray(e))throw new fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=On(n));const s=new Array(e.length);for(let a=0,o=e.length;a<o;a++)s[a]=tr(n,e[a],t,!0,i,a),n=s[a].newDocument;return s.newDocument=n,s}function Ys(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new fe("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(yn[n.op]){if(typeof n.path!="string")throw new fe("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new fe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new fe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&Xs(n.value))throw new fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var i=n.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new fe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new fe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var a={op:"_get",path:n.from,value:void 0},o=wb([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new fe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function wb(n,e,t){try{if(!Array.isArray(n))throw new fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)yi(On(e),On(n),t||!0);else{t=t||Ys;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(i){if(i instanceof fe)return i;throw i}}function bi(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),i,s,a;if(t&&r){if(s=n.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!bi(n[i],e[i]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(s=o.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(o[i]))return!1;for(i=s;i--!==0;)if(a=o[i],!bi(n[a],e[a]))return!1;return!0}return n!==n&&e!==e}class _t extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new _t({start(r){return i();function i(){return t.read().then(({done:s,value:a})=>{if(s){r.close();return}return r.enqueue(a),i()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new _t({async pull(t){const{value:r,done:i}=await e.next();i&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function ic(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(i){for(;;)if(i.length===0){const s=await n.next();for(const a of t)a.push(s)}else{if(i[0].done)return;yield i.shift().value}})}function Bt(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,i]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=Bt(t[r],i):t[r]=i;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}class jn{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise((r,i)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(r,i):this.firstResult.then(s=>r(void 0),i)})}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}async function _b(n,e,t,...r){const i=new jn(e,t),s=await i.setup;return{output:n(i,s,...r),setup:s}}class Mt{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=yi({},t);return new wr({ops:t,state:r[r.length-1].newDocument})}}class wr extends Mt{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=yi(this.state,e.ops);return new wr({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=yi({},e.ops);return new wr({ops:e.ops,state:t[t.length-1].newDocument})}}async function pl(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function ml(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function vb(n){return n!==void 0&&n.message!==void 0}class gl extends ns{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=_t.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(i=>{var s;return(s=this.includeTags)==null?void 0:s.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(i=>{var s;return!((s=this.excludeTags)!=null&&s.includes(i))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const i=this.keyMapByRunId[e];i&&await this.writer.write(new Mt({ops:[{op:"add",path:`/logs/${i}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var i;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Mt({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await pl(e,this._schemaFormat)),await this.writer.write(new Mt({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await pl(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await ml(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const i=new Mt({ops:r});await this.writer.write(i)}finally{if(e.id===this.rootId){const t=new Mt({ops:[{op:"replace",path:"/final_output",value:await ml(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const i=this.keyMapByRunId[e.id];if(i===void 0)return;const s=e.inputs.messages!==void 0;let a;s?vb(r==null?void 0:r.chunk)?a=r==null?void 0:r.chunk:a=new Ra(t):a=t;const o=new Mt({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:a}]});await this.writer.write(o)}}class xb{getStore(){}run(e,t){return t()}}class kb{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new xb}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}}const _r=new kb,Ps=25;async function en(n){return Ve.configure(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function yl(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const i=e[r]??[];e[r]=[...new Set(i.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="callbacks"){const i=e.callbacks,s=t.callbacks;if(Array.isArray(s))if(!i)e.callbacks=s;else if(Array.isArray(i))e.callbacks=i.concat(s);else{const a=i.copy();for(const o of s)a.addHandler(gi(o),!0);e.callbacks=a}else if(s)if(!i)e.callbacks=s;else if(Array.isArray(i)){const a=s.copy();for(const o of i)a.addHandler(gi(o),!0);e.callbacks=a}else e.callbacks=new Ve(s._parentRunId,{handlers:i.handlers.concat(s.handlers),inheritableHandlers:i.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(s.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(s.inheritableTags))),metadata:{...i.metadata,...s.metadata}})}else{const i=r;e[i]=t[i]??e[i]}return e}const Sb=new Set(["string","number","boolean"]);function ue(n){var r;const e=n??_r.getInstance().getStore();let t={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(e&&(t={...t,...e}),e!=null&&e.configurable)for(const i of Object.keys(e.configurable))Sb.has(typeof e.configurable[i])&&!((r=t.metadata)!=null&&r[i])&&(t.metadata||(t.metadata={}),t.metadata[i]=e.configurable[i]);return t}function Ne(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:i,configurable:s,runId:a}={}){const o=ue(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),i!==void 0&&(o.runName=i),s!==void 0&&(o.configurable={...o.configurable,...s}),a!==void 0&&delete o.runId,o}const Eb=[400,401,402,403,404,405,406,407,409],Ab=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&Eb.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const i=new Error(n==null?void 0:n.message);throw i.name="InsufficientQuotaError",i}};class sc{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Ab;const t="default"in Pt?Pt.default:Pt;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>pi(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,s)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class ac extends ns{constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}}function oc(n){return n?n.lc_runnable:!1}class Cb{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const i=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||i.some(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&i.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),r}}const Ib=Symbol("Let zodToJsonSchema decide on which parser to use"),bl={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email",base64Strategy:"contentEncoding:base64"},Pb=n=>typeof n=="string"?{...bl,name:n}:{...bl,...n},Tb=n=>{const e=Pb(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function lc(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function te(n,e,t,r,i){n[e]=t,lc(n,e,r,i)}function Ob(){return{}}function Rb(n,e){var r,i;const t={type:"array"};return((i=(r=n.type)==null?void 0:r._def)==null?void 0:i.typeName)!==A.ZodAny&&(t.items=X(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&te(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&te(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(te(t,"minItems",n.exactLength.value,n.exactLength.message,e),te(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Nb(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?te(t,"minimum",r.value,r.message,e):te(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),te(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?te(t,"maximum",r.value,r.message,e):te(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),te(t,"maximum",r.value,r.message,e));break;case"multipleOf":te(t,"multipleOf",r.value,r.message,e);break}return t}function jb(){return{type:"boolean"}}function Lb(n,e){return X(n.type._def,e)}const $b=(n,e)=>X(n.innerType._def,e);function uc(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((i,s)=>uc(n,e,i))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Mb(n,e)}}const Mb=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":te(t,"minimum",r.value,r.message,e);break;case"max":te(t,"maximum",r.value,r.message,e);break}return t};function Db(n,e){return{...X(n.innerType._def,e),default:n.defaultValue()}}function Bb(n,e){return e.effectStrategy==="input"?X(n.schema._def,e):{}}function Fb(n){return{type:"string",enum:n.values}}const zb=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function Ub(n,e){const t=[X(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),X(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const i=[];return t.forEach(s=>{if(zb(s))i.push(...s.allOf),s.unevaluatedProperties===void 0&&(r=void 0);else{let a=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:o,...l}=s;a=l}else r=void 0;i.push(a)}}),i.length?{allOf:i,...r}:void 0}function Hb(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}const Wt={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$",base64:"^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$",nanoid:"^[a-zA-Z0-9_-]{21}$"};function cc(n,e){const t={type:"string"};function r(i){return e.patternStrategy==="escape"?Zb(i):i}if(n.checks)for(const i of n.checks)switch(i.kind){case"min":te(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,i.value):i.value,i.message,e);break;case"max":te(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,i.value):i.value,i.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ye(t,"email",i.message,e);break;case"format:idn-email":Ye(t,"idn-email",i.message,e);break;case"pattern:zod":et(t,Wt.email,i.message,e);break}break;case"url":Ye(t,"uri",i.message,e);break;case"uuid":Ye(t,"uuid",i.message,e);break;case"regex":et(t,i.regex.source,i.message,e);break;case"cuid":et(t,Wt.cuid,i.message,e);break;case"cuid2":et(t,Wt.cuid2,i.message,e);break;case"startsWith":et(t,"^"+r(i.value),i.message,e);break;case"endsWith":et(t,r(i.value)+"$",i.message,e);break;case"datetime":Ye(t,"date-time",i.message,e);break;case"date":Ye(t,"date",i.message,e);break;case"time":Ye(t,"time",i.message,e);break;case"duration":Ye(t,"duration",i.message,e);break;case"length":te(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,i.value):i.value,i.message,e),te(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,i.value):i.value,i.message,e);break;case"includes":{et(t,r(i.value),i.message,e);break}case"ip":{i.version!=="v6"&&Ye(t,"ipv4",i.message,e),i.version!=="v4"&&Ye(t,"ipv6",i.message,e);break}case"emoji":et(t,Wt.emoji,i.message,e);break;case"ulid":{et(t,Wt.ulid,i.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ye(t,"binary",i.message,e);break}case"contentEncoding:base64":{te(t,"contentEncoding","base64",i.message,e);break}case"pattern:zod":{et(t,Wt.base64,i.message,e);break}}break}case"nanoid":et(t,Wt.nanoid,i.message,e)}return t}const Zb=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Ye=(n,e,t,r)=>{var i;n.format||(i=n.anyOf)!=null&&i.some(s=>s.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):te(n,"format",e,t,r)},et=(n,e,t,r)=>{var i;n.pattern||(i=n.allOf)!=null&&i.some(s=>s.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:e,...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):te(n,"pattern",e,t,r)};function dc(n,e){var r,i,s,a;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===A.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,l)=>({...o,[l]:X(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:X(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((i=n.keyType)==null?void 0:i._def.typeName)===A.ZodString&&((s=n.keyType._def.checks)!=null&&s.length)){const o=Object.entries(cc(n.keyType._def,e)).reduce((l,[u,c])=>u==="type"?l:{...l,[u]:c},{});return{...t,propertyNames:o}}else if(((a=n.keyType)==null?void 0:a._def.typeName)===A.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function Vb(n,e){if(e.mapStrategy==="record")return dc(n,e);const t=X(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=X(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function qb(n){const e=n.values,r=Object.keys(n.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),i=Array.from(new Set(r.map(s=>typeof s)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:r}}function Wb(){return{not:{}}}function Gb(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const wi={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Jb(n,e){if(e.target==="openApi3")return wl(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in wi&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((i,s)=>{const a=wi[s._def.typeName];return a&&!i.includes(a)?[...i,a]:i},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((i,s)=>{const a=typeof s._def.value;switch(a){case"string":case"number":case"boolean":return[...i,a];case"bigint":return[...i,"integer"];case"object":if(s._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(r.length===t.length){const i=r.filter((s,a,o)=>o.indexOf(s)===a);return{type:i.length>1?i:i[0],enum:t.reduce((s,a)=>s.includes(a._def.value)?s:[...s,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,i)=>[...r,...i._def.values.filter(s=>!r.includes(s))],[])};return wl(n,e)}const wl=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,i)=>X(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function Kb(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:wi[n.innerType._def.typeName],nullable:!0}:{type:[wi[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=X(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=X(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Xb(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",lc(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?te(t,"minimum",r.value,r.message,e):te(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),te(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?te(t,"maximum",r.value,r.message,e):te(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),te(t,"maximum",r.value,r.message,e));break;case"multipleOf":te(t,"multipleOf",r.value,r.message,e);break}return t}function Qb(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":X(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":X(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function Yb(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[i,s])=>{if(s===void 0||s._def===void 0)return r;const a=X(s._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});return a===void 0?r:{properties:{...r.properties,[i]:a},required:s.isOptional()?r.required:[...r.required,i]}},{properties:{},required:[]}),additionalProperties:Qb(n,e)};return t.required.length||delete t.required,t}const ew=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return X(n.innerType._def,e);const t=X(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},tw=(n,e)=>{if(e.pipeStrategy==="input")return X(n.in._def,e);if(e.pipeStrategy==="output")return X(n.out._def,e);const t=X(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=X(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(i=>i!==void 0)}};function nw(n,e){return X(n.type._def,e)}function rw(n,e){const r={type:"array",uniqueItems:!0,items:X(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&te(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&te(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function iw(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>X(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:X(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>X(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function sw(){return{not:{}}}function aw(){return{}}const ow=(n,e)=>X(n.innerType._def,e);function X(n,e,t=!1){var a;const r=e.seen.get(n);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,n,e,r,t);if(o!==Ib)return o}if(r&&!t){const o=lw(r,e);if(o!==void 0)return o}const i={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,i);const s=cw(n,n.typeName,e);return s&&dw(n,e,s),i.jsonSchema=s,s}const lw=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:uw(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},uw=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},cw=(n,e,t)=>{switch(e){case A.ZodString:return cc(n,t);case A.ZodNumber:return Xb(n,t);case A.ZodObject:return Yb(n,t);case A.ZodBigInt:return Nb(n,t);case A.ZodBoolean:return jb();case A.ZodDate:return uc(n,t);case A.ZodUndefined:return sw();case A.ZodNull:return Gb(t);case A.ZodArray:return Rb(n,t);case A.ZodUnion:case A.ZodDiscriminatedUnion:return Jb(n,t);case A.ZodIntersection:return Ub(n,t);case A.ZodTuple:return iw(n,t);case A.ZodRecord:return dc(n,t);case A.ZodLiteral:return Hb(n,t);case A.ZodEnum:return Fb(n);case A.ZodNativeEnum:return qb(n);case A.ZodNullable:return Kb(n,t);case A.ZodOptional:return ew(n,t);case A.ZodMap:return Vb(n,t);case A.ZodSet:return rw(n,t);case A.ZodLazy:return X(n.getter()._def,t);case A.ZodPromise:return nw(n,t);case A.ZodNaN:case A.ZodNever:return Wb();case A.ZodEffects:return Bb(n,t);case A.ZodAny:return Ob();case A.ZodUnknown:return aw();case A.ZodDefault:return Db(n,t);case A.ZodBranded:return Lb(n,t);case A.ZodReadonly:return ow(n,t);case A.ZodCatch:return $b(n,t);case A.ZodPipeline:return tw(n,t);case A.ZodFunction:case A.ZodVoid:case A.ZodSymbol:return;default:return(r=>{})()}},dw=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),hw=(n,e)=>{const t=Tb(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((o,[l,u])=>({...o,[l]:X(u._def,{...t,currentPath:[...t.basePath,t.definitionPath,l]},!0)??{}}),{}):void 0,i=typeof e=="string"?e:e==null?void 0:e.name,s=X(n._def,i===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,i]},!1)??{},a=i===void 0?r?{...s,[t.definitionPath]:r}:s:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,i].join("/"),[t.definitionPath]:{...r,[i]:s}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),a};function fw(n){return oc(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...hw(n.data.schema),title:n.data.name}}}class hc{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=Uu(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...fw(t)})),edges:this.edges.map(t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const r=t||ft(),i={id:r,data:e};return this.nodes[r]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:r};return this.edges.push(i),i}firstNode(){const e=new Set(this.edges.map(r=>r.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){const e=new Set(this.edges.map(r=>r.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e){Object.entries(e.nodes).forEach(([t,r])=>{this.nodes[t]=r}),this.edges=[...this.edges,...e.edges]}trimFirstNode(){const e=this.firstNode();if(e){const t=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const t=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}}function pw(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const i of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(i)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return _t.fromReadableStream(t)}function _l(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}function vl(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*xl(n,e){const t=_r.getInstance();for(;;){const{value:r,done:i}=t.run(n,e.next.bind(e));if(i)break;yield r}}async function*kl(n,e){const t=_r.getInstance(),r=e[Symbol.asyncIterator]();for(;;){const{value:i,done:s}=await t.run(n,r.next.bind(e));if(s)break;yield i}}function xe(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}class Ce extends rn{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new kn({bound:this,kwargs:e,config:{}})}map(){return new _i({bound:this})}withRetry(e){return new mw({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new kn({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new gw({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(ue);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:t},(i,s)=>ue(s===0?e:r))}return Array.from({length:t},()=>ue(e))}async batch(e,t,r){var l;const i=this._getOptionsList(t??{},e.length),s=((l=i[0])==null?void 0:l.maxConcurrency)??(r==null?void 0:r.maxConcurrency),a=new sc({maxConcurrency:s,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>a.call(async()=>{try{return await this.invoke(u,i[c])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=new jn(this._streamIterator(e,ue(t)));return await r.setup,_t.fromAsyncGenerator(r)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=ue(e):t=ue({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,[t,r]}async _callWithConfig(e,t,r){const i=ue(r),s=await en(i),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),xe(t,"input"),i.runId,i==null?void 0:i.runType,void 0,void 0,(i==null?void 0:i.runName)??this.getName()));delete i.runId;let o;try{o=await e.call(this,t,i,a)}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}return await(a==null?void 0:a.handleChainEnd(xe(o,"output"))),o}async _batchWithConfig(e,t,r,i){const s=this._getOptionsList(r??{},t.length),a=await Promise.all(s.map(en)),o=await Promise.all(a.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),xe(t[c],"input"),s[c].runId,s[c].runType,void 0,void 0,s[c].runName??this.getName()));return delete s[c].runId,d}));let l;try{l=await e.call(this,t,s,o,i)}catch(u){throw await Promise.all(o.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(xe(l,"output")))),l}async*_transformStreamWithConfig(e,t,r){let i,s=!0,a,o=!0;const l=ue(r),u=await en(l);async function*c(){for await(const f of e){if(s)if(i===void 0)i=f;else try{i=Bt(i,f)}catch{i=void 0,s=!1}yield f}}let d;try{const f=await _b(t.bind(this),c(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),l);delete l.runId,d=f.setup;const h=y=>y.name==="log_stream_tracer",p=d==null?void 0:d.handlers.find(h);let w=f.output;p!==void 0&&d!==void 0&&(w=await p.tapOutputIterable(d.runId,f.output));for await(const y of w)if(yield y,o)if(a===void 0)a=y;else try{a=Bt(a,y)}catch{a=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:xe(i,"input")})),f}await(d==null?void 0:d.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:xe(i,"input")}))}getGraph(e){const t=new hc,r=t.addNode({name:`${this.getName()}Input`,schema:tl.any()}),i=t.addNode(this),s=t.addNode({name:`${this.getName()}Output`,schema:tl.any()});return t.addEdge(r,i),t.addEdge(i,s),t}pipe(e){return new bn({first:this,last:Xt(e)})}pick(e){return this.pipe(new bw(e))}assign(e){return this.pipe(new yw(new Pr({steps:e})))}async*transform(e,t){let r;for await(const i of e)r===void 0?r=i:r=Bt(r,i);yield*this._streamIterator(r,ue(t))}async*streamLog(e,t,r){const i=new gl({...r,autoClose:!1,_schemaFormat:"original"}),s=ue(t);yield*this._streamLog(e,i,s)}async*_streamLog(e,t,r){const{callbacks:i}=r;if(i===void 0)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{const l=i.copy();l.inheritableHandlers.push(t),r.callbacks=l}const s=this.stream(e,r);async function a(){try{const l=await s;for await(const u of l){const c=new Mt({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await t.writer.write(c)}}finally{await t.writer.close()}}const o=a();try{for await(const l of t)yield l}finally{await o}}async*streamEvents(e,t,r){if(t.encoding==="text/event-stream"){const i=await this._streamEvents(e,t,r);yield*pw(i)}else yield*this._streamEvents(e,t,r)}async*_streamEvents(e,t,r){if(t.version!=="v1")throw new Error('Only version "v1" of the events schema is currently supported.');let i,s=!1;const a=ue(t),o=a.tags??[],l=a.metadata??{},u=a.runName??this.getName(),c=new gl({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Cb({...r}),f=this._streamLog(e,c,a);for await(const p of f){if(i?i=i.concat(p):i=wr.fromRunLogPatch(p),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;const _={...i.state},v={run_id:_.id,event:`on_${_.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};d.includeEvent(v,_.type)&&(yield v)}const w=p.ops.filter(_=>_.path.startsWith("/logs/")).map(_=>_.path.split("/")[2]),y=[...new Set(w)];for(const _ of y){let v,P={};const C=i.state.logs[_];if(C.end_time===void 0?C.streamed_output.length>0?v="stream":v="start":v="end",v==="start")C.inputs!==void 0&&(P.input=C.inputs);else if(v==="end")C.inputs!==void 0&&(P.input=C.inputs),P.output=C.final_output;else if(v==="stream"){const x=C.streamed_output.length;if(x!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${x} instead. Encountered in: "${C.name}"`);P={chunk:C.streamed_output[0]},C.streamed_output=[]}yield{event:`on_${C.type}_${v}`,name:C.name,run_id:C.id,tags:C.tags,metadata:C.metadata,data:P}}const{state:b}=i;if(b.streamed_output.length>0){const _=b.streamed_output.length;if(_!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${_} instead. Encountered in: "${b.name}"`);const v={chunk:b.streamed_output[0]};b.streamed_output=[];const P={event:`on_${b.type}_stream`,run_id:b.id,tags:o,metadata:l,name:u,data:v};d.includeEvent(P,b.type)&&(yield P)}}const h=i==null?void 0:i.state;if(h!==void 0){const p={event:`on_${h.type}_end`,name:u,run_id:h.id,tags:o,metadata:l,data:{output:h.final_output}};d.includeEvent(p,h.type)&&(yield p)}}static isRunnable(e){return oc(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new kn({bound:this,config:{},configFactories:[i=>({callbacks:[new ac({config:i,onStart:e,onEnd:t,onError:r})]})]})}}class kn extends Ce{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=yl(this.config,...e);return yl(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(ue(t),this.kwargs))}async batch(e,t,r){const i=Array.isArray(t)?await Promise.all(t.map(async s=>this._mergeConfig(ue(s),this.kwargs))):await this._mergeConfig(ue(t),this.kwargs);return this.bound.batch(e,i,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(ue(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(ue(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(ue(t),this.kwargs))}async*streamEvents(e,t,r){yield*this.bound.streamEvents(e,{...await this._mergeConfig(ue(t),this.kwargs),version:t.version},r)}static isRunnableBinding(e){return e.bound&&Ce.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new kn({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new ac({config:i,onStart:e,onEnd:t,onError:r})]})]})}}class _i extends Ce{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new _i({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,Ne(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new _i({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class mw extends kn{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const i=e>1?`retry:attempt:${e}`:void 0;return Ne(t,{callbacks:r==null?void 0:r.getChild(i)})}async _invoke(e,t,r){return pi(i=>super.invoke(e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,i){const s={};try{await pi(async a=>{const o=e.map((f,h)=>h).filter(f=>s[f.toString()]===void 0||s[f.toString()]instanceof Error),l=o.map(f=>e[f]),u=o.map(f=>this._patchConfigForRetry(a,t==null?void 0:t[f],r==null?void 0:r[f])),c=await super.batch(l,u,{...i,returnExceptions:!0});let d;for(let f=0;f<c.length;f+=1){const h=c[f],p=o[f];h instanceof Error&&d===void 0&&(d=h,d.input=l[f]),s[p.toString()]=h}if(d)throw d;return c},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((i==null?void 0:i.returnExceptions)!==!0)throw a}return Object.keys(s).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>s[parseInt(a,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class bn extends Ce{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=ue(t),i=await en(r),s=await(i==null?void 0:i.handleChainStart(this.toJSON(),xe(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let a=e,o;try{const l=[this.first,...this.middle];for(let u=0;u<l.length;u+=1)a=await l[u].invoke(a,Ne(r,{callbacks:s==null?void 0:s.getChild(`seq:step:${u+1}`)}));o=await this.last.invoke(a,Ne(r,{callbacks:s==null?void 0:s.getChild(`seq:step:${this.steps.length}`)}))}catch(l){throw await(s==null?void 0:s.handleChainError(l)),l}return await(s==null?void 0:s.handleChainEnd(xe(o,"output"))),o}async batch(e,t,r){const i=this._getOptionsList(t??{},e.length),s=await Promise.all(i.map(en)),a=await Promise.all(s.map(async(l,u)=>{const c=await(l==null?void 0:l.handleChainStart(this.toJSON(),xe(e[u],"input"),i[u].runId,void 0,void 0,void 0,i[u].runName));return delete i[u].runId,c}));let o=e;try{for(let l=0;l<this.steps.length;l+=1)o=await this.steps[l].batch(o,a.map((c,d)=>{const f=c==null?void 0:c.getChild(`seq:step:${l+1}`);return Ne(i[d],{callbacks:f})}),r)}catch(l){throw await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(l))),l}return await Promise.all(a.map(l=>l==null?void 0:l.handleChainEnd(xe(o,"output")))),o}async*_streamIterator(e,t){const r=await en(t),{runId:i,...s}=t??{},a=await(r==null?void 0:r.handleChainStart(this.toJSON(),xe(e,"input"),i,void 0,void 0,void 0,s==null?void 0:s.runName)),o=[this.first,...this.middle,this.last];let l=!0,u;async function*c(){yield e}try{let d=o[0].transform(c(),Ne(s,{callbacks:a==null?void 0:a.getChild("seq:step:1")}));for(let f=1;f<o.length;f+=1)d=await o[f].transform(d,Ne(s,{callbacks:a==null?void 0:a.getChild(`seq:step:${f+1}`)}));for await(const f of d)if(yield f,l)if(u===void 0)u=f;else try{u=Bt(u,f)}catch{u=void 0,l=!1}}catch(d){throw await(a==null?void 0:a.handleChainError(d)),d}await(a==null?void 0:a.handleChainEnd(xe(u,"output")))}getGraph(e){const t=new hc;let r=null;return this.steps.forEach((i,s)=>{const a=i.getGraph(e);s!==0&&a.trimFirstNode(),s!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,o),r=a.lastNode()}),t}pipe(e){return bn.isRunnableSequence(e)?new bn({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new bn({first:this.first,middle:[...this.middle,this.last],last:Xt(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Ce.isRunnable(e)}static from([e,...t],r){return new bn({first:Xt(e),middle:t.slice(0,-1).map(Xt),last:Xt(t[t.length-1]),name:r})}}class Pr extends Ce{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Xt(r)}static from(e){return new Pr({steps:e})}async invoke(e,t){const r=ue(t),i=await en(r),s=await(i==null?void 0:i.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const a={};try{await Promise.all(Object.entries(this.steps).map(async([o,l])=>{a[o]=await l.invoke(e,Ne(r,{callbacks:s==null?void 0:s.getChild(`map:key:${o}`)}))}))}catch(o){throw await(s==null?void 0:s.handleChainError(o)),o}return await(s==null?void 0:s.handleChainEnd(a)),a}async*_transform(e,t,r){const i={...this.steps},s=ic(e,Object.keys(i).length),a=new Map(Object.entries(i).map(([o,l],u)=>{const c=l.transform(s[u],Ne(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;a.size;){const{key:o,result:l,gen:u}=await Promise.race(a.values());a.delete(o),l.done||(yield{[o]:l.value},a.set(o,u.next().then(c=>({key:o,gen:u,result:c}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=new jn(this.transform(r(),t));return await i.setup,_t.fromAsyncGenerator(i)}}class Na extends Ce{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new Na({func:e})}async _invoke(e,t,r){return new Promise((i,s)=>{const a=Ne(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??Ps)-1});_r.getInstance().run(a,async()=>{try{let o=await this.func(e,{...a,config:a});if(o&&Ce.isRunnable(o)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...a,recursionLimit:(a.recursionLimit??Ps)-1})}else if(vl(o)){let l;for await(const u of kl(a,o))if(l===void 0)l=u;else try{l=Bt(l,u)}catch{l=u}o=l}else if(_l(o)){let l;for(const u of xl(a,o))if(l===void 0)l=u;else try{l=Bt(l,u)}catch{l=u}o=l}i(o)}catch(o){s(o)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){let i;for await(const a of e)if(i===void 0)i=a;else try{i=Bt(i,a)}catch{i=a}const s=await new Promise((a,o)=>{_r.getInstance().run(r,async()=>{try{const l=await this.func(i,{...r,config:r});a(l)}catch(l){o(l)}})});if(s&&Ce.isRunnable(s)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const a=await s.stream(i,Ne(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??Ps)-1}));for await(const o of a)yield o}else if(vl(s))for await(const a of kl(r,s))yield a;else if(_l(s))for(const a of xl(r,s))yield a;else yield s}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=new jn(this.transform(r(),t));return await i.setup,_t.fromAsyncGenerator(i)}}class gw extends Ce{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=await Ve.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata),{runId:i,...s}=t??{},a=await(r==null?void 0:r.handleChainStart(this.toJSON(),xe(e,"input"),i,void 0,void 0,void 0,s==null?void 0:s.runName));let o;for(const l of this.runnables())try{const u=await l.invoke(e,Ne(s,{callbacks:a==null?void 0:a.getChild()}));return await(a==null?void 0:a.handleChainEnd(xe(u,"output"))),u}catch(u){o===void 0&&(o=u)}throw o===void 0?new Error("No error stored at end of fallback."):(await(a==null?void 0:a.handleChainError(o)),o)}async batch(e,t,r){if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const i=this._getOptionsList(t??{},e.length),s=await Promise.all(i.map(l=>Ve.configure(l==null?void 0:l.callbacks,void 0,l==null?void 0:l.tags,void 0,l==null?void 0:l.metadata))),a=await Promise.all(s.map(async(l,u)=>{const c=await(l==null?void 0:l.handleChainStart(this.toJSON(),xe(e[u],"input"),i[u].runId,void 0,void 0,void 0,i[u].runName));return delete i[u].runId,c}));let o;for(const l of this.runnables())try{const u=await l.batch(e,a.map((c,d)=>Ne(i[d],{callbacks:c==null?void 0:c.getChild()})),r);return await Promise.all(a.map((c,d)=>c==null?void 0:c.handleChainEnd(xe(u[d],"output")))),u}catch(u){o===void 0&&(o=u)}throw o?(await Promise.all(a.map(l=>l==null?void 0:l.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Xt(n){if(typeof n=="function")return new Na({func:n});if(Ce.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=Xt(r);return new Pr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class yw extends Ce{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Pr&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const i=this.mapper.getStepsKeys(),[s,a]=ic(e),o=this.mapper.transform(a,Ne(r,{callbacks:t==null?void 0:t.getChild()})),l=o.next();for await(const u of s){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const c=Object.fromEntries(Object.entries(u).filter(([d])=>!i.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(const u of o)yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=new jn(this.transform(r(),t));return await i.setup,_t.fromAsyncGenerator(i)}}class bw extends Ce{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=new jn(this.transform(r(),t));return await i.setup,_t.fromAsyncGenerator(i)}}class ww extends Ce{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,t){return this.transformDocuments(e)}}var ss={};ss.byteLength=xw;ss.toByteArray=Sw;ss.fromByteArray=Cw;var mt=[],He=[],_w=typeof Uint8Array<"u"?Uint8Array:Array,Ts="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var dn=0,vw=Ts.length;dn<vw;++dn)mt[dn]=Ts[dn],He[Ts.charCodeAt(dn)]=dn;He[45]=62;He[95]=63;function fc(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function xw(n){var e=fc(n),t=e[0],r=e[1];return(t+r)*3/4-r}function kw(n,e,t){return(e+t)*3/4-t}function Sw(n){var e,t=fc(n),r=t[0],i=t[1],s=new _w(kw(n,r,i)),a=0,o=i>0?r-4:r,l;for(l=0;l<o;l+=4)e=He[n.charCodeAt(l)]<<18|He[n.charCodeAt(l+1)]<<12|He[n.charCodeAt(l+2)]<<6|He[n.charCodeAt(l+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=e&255;return i===2&&(e=He[n.charCodeAt(l)]<<2|He[n.charCodeAt(l+1)]>>4,s[a++]=e&255),i===1&&(e=He[n.charCodeAt(l)]<<10|He[n.charCodeAt(l+1)]<<4|He[n.charCodeAt(l+2)]>>2,s[a++]=e>>8&255,s[a++]=e&255),s}function Ew(n){return mt[n>>18&63]+mt[n>>12&63]+mt[n>>6&63]+mt[n&63]}function Aw(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(Ew(r));return i.join("")}function Cw(n){for(var e,t=n.length,r=t%3,i=[],s=16383,a=0,o=t-r;a<o;a+=s)i.push(Aw(n,a,a+s>o?o:a+s));return r===1?(e=n[t-1],i.push(mt[e>>2]+mt[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(mt[e>>10]+mt[e>>4&63]+mt[e<<2&63]+"=")),i.join("")}var Iw=Object.defineProperty,Pw=(n,e,t)=>e in n?Iw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Tw=(n,e,t)=>(Pw(n,e+"",t),t);function Ow(n,e){let t=Array.from({length:n.length},(r,i)=>({start:i,end:i+1}));for(;t.length>1;){let r=null;for(let i=0;i<t.length-1;i++){const s=n.slice(t[i].start,t[i+1].end),a=e.get(s.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,i])}if(r!=null){const i=r[1];t[i]={start:t[i].start,end:t[i+1].end},t.splice(i+1,1)}else break}return t}function Rw(n,e){return n.length===1?[e.get(n.join(","))]:Ow(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function Nw(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var ea=class{constructor(n,e){Ee(this,"specialTokens");Ee(this,"inverseSpecialTokens");Ee(this,"patStr");Ee(this,"textEncoder",new TextEncoder);Ee(this,"textDecoder",new TextDecoder("utf-8"));Ee(this,"rankMap",new Map);Ee(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,i)=>{const[s,a,...o]=i.split(" "),l=Number.parseInt(a,10);return o.forEach((u,c)=>r[u]=l+c),r},{});for(const[r,i]of Object.entries(t)){const s=ss.toByteArray(r);this.rankMap.set(s.join(","),i),this.textMap.set(i,s)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[i,s])=>(r[s]=this.textEncoder.encode(i),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),i=ea.specialTokenRegex(Object.keys(this.specialTokens)),s=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!a.has(u)):t);if(o.size>0){const u=ea.specialTokenRegex([...o]),c=n.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let l=0;for(;;){let u=null,c=l;for(;i.lastIndex=c,u=i.exec(n),!(u==null||a.has(u[0]));)c=u.index+1;const d=(u==null?void 0:u.index)??n.length;for(const h of n.substring(l,d).matchAll(r)){const p=this.textEncoder.encode(h[0]),w=this.rankMap.get(p.join(","));if(w!=null){s.push(w);continue}s.push(...Rw(p,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];s.push(f),l=u.index+u[0].length}return s}decode(n){const e=[];let t=0;for(let s=0;s<n.length;++s){const a=n[s],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let i=0;for(const s of e)r.set(s,i),i+=s.length;return this.textDecoder.decode(r)}},jw=ea;Tw(jw,"specialTokenRegex",n=>new RegExp(n.map(e=>Nw(e)).join("|"),"g"));class Lw extends ww{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(t=>t.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,t={}){return this.splitDocuments(e,t)}splitOnSeparator(e,t){let r;if(t)if(this.keepSeparator){const i=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${i})`))}else r=e.split(t);else r=e.split("");return r.filter(i=>i!=="")}async createDocuments(e,t=[],r={}){const i=t.length>0?t:[...Array(e.length)].map(()=>({})),{chunkHeader:s="",chunkOverlapHeader:a="(cont'd) ",appendChunkOverlapHeader:o=!1}=r,l=new Array;for(let u=0;u<e.length;u+=1){const c=e[u];let d=1,f=null,h=-1;for(const p of await this.splitText(c)){let w=s;const y=c.indexOf(p,h+1);if(f===null){const P=this.numberOfNewLines(c,0,y);d+=P}else{const P=h+await this.lengthFunction(f);if(P<y){const C=this.numberOfNewLines(c,P,y);d+=C}else if(P>y){const C=this.numberOfNewLines(c,y,P);d-=C}o&&(w+=a)}const b=this.numberOfNewLines(p),_=i[u].loc&&typeof i[u].loc=="object"?{...i[u].loc}:{};_.lines={from:d,to:d+b};const v={...i[u],loc:_};w+=p,l.push(new Zr({pageContent:w,metadata:v})),d+=b,f=p,h=y}}return l}numberOfNewLines(e,t,r){return(e.slice(t,r).match(/\n/g)||[]).length}async splitDocuments(e,t={}){const r=e.filter(a=>a.pageContent!==void 0),i=r.map(a=>a.pageContent),s=r.map(a=>a.metadata);return this.createDocuments(i,s,t)}joinDocs(e,t){const r=e.join(t).trim();return r===""?null:r}async mergeSplits(e,t){const r=[],i=[];let s=0;for(const o of e){const l=await this.lengthFunction(o);if(s+l+i.length*t.length>this.chunkSize&&(s>this.chunkSize&&console.warn(`Created a chunk of size ${s}, +
which is longer than the specified ${this.chunkSize}`),i.length>0)){const u=this.joinDocs(i,t);for(u!==null&&r.push(u);s>this.chunkOverlap||s+l+i.length*t.length>this.chunkSize&&s>0;)s-=await this.lengthFunction(i[0]),i.shift()}i.push(o),s+=l}const a=this.joinDocs(i,t);return a!==null&&r.push(a),r}}class vi extends Lw{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,t){const r=[];let i=t[t.length-1],s;for(let u=0;u<t.length;u+=1){const c=t[u];if(c===""){i=c;break}if(e.includes(c)){i=c,s=t.slice(u+1);break}}const a=this.splitOnSeparator(e,i);let o=[];const l=this.keepSeparator?"":i;for(const u of a)if(await this.lengthFunction(u)<this.chunkSize)o.push(u);else{if(o.length){const c=await this.mergeSplits(o,l);r.push(...c),o=[]}if(!s)r.push(u);else{const c=await this._splitText(u,s);r.push(...c)}}if(o.length){const u=await this.mergeSplits(o,l);r.push(...u)}return r}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new vi({...t,separators:vi.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}function $w(n,e){let t=0,r=0,i=0;for(let s=0;s<n.length;s++)t+=n[s]*e[s],r+=n[s]*n[s],i+=e[s]*e[s];return t/(Math.sqrt(r)*Math.sqrt(i))}class Mw extends Ce{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,ue(t))}async getRelevantDocuments(e,t){const r=ue(lb(t)),i=await Ve.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),s=await(i==null?void 0:i.handleRetrieverStart(this.toJSON(),e,r.runId,void 0,void 0,void 0,r.runName));try{const a=await this._getRelevantDocuments(e,s);return await(s==null?void 0:s.handleRetrieverEnd(a)),a}catch(a){throw await(s==null?void 0:s.handleRetrieverError(a)),a}}}class Os extends Mw{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t==null?void 0:t.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t==null?void 0:t.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class Dw extends rn{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,r=void 0,i=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(a=>a[0])}async similaritySearchWithScore(e,t=4,r=void 0,i=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,i){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,i,s,a){if(typeof e=="number")return new Os({vectorStore:this,k:e,filter:t,tags:[...i??[],this._vectorstoreType()],metadata:s,verbose:a,callbacks:r});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new Os({...o,searchKwargs:e.searchKwargs}):new Os({...o})}}}class ja extends Dw{_vectorstoreType(){return"memory"}constructor(e,{similarity:t,...r}={}){super(e,r),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=t??$w}async addDocuments(e){const t=e.map(({pageContent:r})=>r);return this.addVectors(await this.embeddings.embedDocuments(t),e)}async addVectors(e,t){const r=e.map((i,s)=>({content:t[s].pageContent,embedding:i,metadata:t[s].metadata}));this.memoryVectors=this.memoryVectors.concat(r)}async similaritySearchVectorWithScore(e,t,r){const i=l=>{if(!r)return!0;const u=new Zr({metadata:l.metadata,pageContent:l.content});return r(u)},s=this.memoryVectors.filter(i);return s.map((l,u)=>({similarity:this.similarity(e,l.embedding),index:u})).sort((l,u)=>l.similarity>u.similarity?-1:0).slice(0,t).map(l=>[new Zr({metadata:s[l.index].metadata,pageContent:s[l.index].content}),l.similarity])}static async fromTexts(e,t,r,i){const s=[];for(let a=0;a<e.length;a+=1){const o=Array.isArray(t)?t[a]:t,l=new Zr({pageContent:e[a],metadata:o});s.push(l)}return ja.fromDocuments(s,r,i)}static async fromDocuments(e,t,r){const i=new this(t,r);return await i.addDocuments(e),i}static async fromExistingIndex(e,t){return new this(e,t)}}const fn="4.47.1";let Sl=!1,nr,pc,mc,ta,gc,yc,bc,wc,_c;function Bw(n,e={auto:!1}){if(Sl)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(nr)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${nr}'\``);Sl=e.auto,nr=n.kind,pc=n.fetch,mc=n.FormData,ta=n.File,gc=n.ReadableStream,yc=n.getMultipartRequestOptions,bc=n.getDefaultAgent,wc=n.fileFromPath,_c=n.isFsReadStream}class Fw{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function zw({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,i,s;try{t=fetch,r=Request,i=Response,s=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:i,Headers:s,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Fw(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}nr||Bw(zw(),{auto:!0});let W=class extends Error{},Pe=class na extends W{constructor(e,t,r,i){super(`${na.makeMessage(e,t,r)}`),this.status=e,this.headers=i,this.request_id=i==null?void 0:i["x-request-id"];const s=t;this.error=s,this.code=s==null?void 0:s.code,this.param=s==null?void 0:s.param,this.type=s==null?void 0:s.type}static makeMessage(e,t,r){const i=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,r,i){if(!e)return new Tr({cause:ia(t)});const s=t==null?void 0:t.error;return e===400?new La(e,s,r,i):e===401?new $a(e,s,r,i):e===403?new Ma(e,s,r,i):e===404?new Da(e,s,r,i):e===409?new Ba(e,s,r,i):e===422?new Fa(e,s,r,i):e===429?new za(e,s,r,i):e>=500?new Ua(e,s,r,i):new na(e,s,r,i)}},je=class extends Pe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Tr=class extends Pe{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},as=class extends Tr{constructor({message:e}={}){super({message:e??"Request timed out."})}},La=class extends Pe{constructor(){super(...arguments),this.status=400}},$a=class extends Pe{constructor(){super(...arguments),this.status=401}},Ma=class extends Pe{constructor(){super(...arguments),this.status=403}},Da=class extends Pe{constructor(){super(...arguments),this.status=404}},Ba=class extends Pe{constructor(){super(...arguments),this.status=409}},Fa=class extends Pe{constructor(){super(...arguments),this.status=422}},za=class extends Pe{constructor(){super(...arguments),this.status=429}},Ua=class extends Pe{};const Uw=Object.freeze(Object.defineProperty({__proto__:null,APIConnectionError:Tr,APIConnectionTimeoutError:as,APIError:Pe,APIUserAbortError:je,AuthenticationError:$a,BadRequestError:La,ConflictError:Ba,InternalServerError:Ua,NotFoundError:Da,OpenAIError:W,PermissionDeniedError:Ma,RateLimitError:za,UnprocessableEntityError:Fa},Symbol.toStringTag,{value:"Module"}));class gt{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const a of Hw(e,t))if(!s){if(a.data.startsWith("[DONE]")){s=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(o&&o.error)throw new Pe(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new Pe(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}s=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{s||t.abort()}}return new gt(i,t)}static fromReadableStream(e,t){let r=!1;async function*i(){const a=new sn,o=vc(e);for await(const l of o)for(const u of a.decode(l))yield u;for(const l of a.flush())yield l}async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of i())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new gt(s,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),i=s=>({next:()=>{if(s.length===0){const a=r.next();e.push(a),t.push(a)}return s.shift()}});return[new gt(()=>i(e),this.controller),new gt(()=>i(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new gc({async start(){t=e[Symbol.asyncIterator]()},async pull(i){try{const{value:s,done:a}=await t.next();if(a)return i.close();const o=r.encode(JSON.stringify(s)+`
`);i.enqueue(o)}catch(s){i.error(s)}},async cancel(){var i;await((i=t.return)==null?void 0:i.call(t))}})}}async function*Hw(n,e){if(!n.body)throw e.abort(),new W("Attempted to iterate over a response with no body");const t=new qw,r=new sn,i=vc(n.body);for await(const s of Zw(i))for(const a of r.decode(s)){const o=t.decode(a);o&&(yield o)}for(const s of r.flush()){const a=t.decode(s);a&&(yield a)}}async function*Zw(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let i=new Uint8Array(e.length+r.length);i.set(e),i.set(r,e.length),e=i;let s;for(;(s=Vw(e))!==-1;)yield e.slice(0,s),e=e.slice(s)}e.length>0&&(yield e)}function Vw(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class qw{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,i]=Ww(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}}class sn{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=sn.NEWLINE_CHARS.has(t[t.length-1]||"");let i=t.split(sn.NEWLINE_REGEXP);return r&&i.pop(),i.length===1&&!r?(this.buffer.push(i[0]),[]):(this.buffer.length>0&&(i=[this.buffer.join("")+i[0],...i.slice(1)],this.buffer=[]),r||(this.buffer=[i.pop()||""]),i)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new W(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new W(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new W("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}sn.NEWLINE_CHARS=new Set([`
`,"\r"]);sn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Ww(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function vc(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const xc=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",kc=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Sc(n),Sc=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Gw=n=>kc(n)||xc(n)||_c(n);async function Ec(n,e,t){var i;if(n=await n,t??(t=kc(n)?{lastModified:n.lastModified,type:n.type}:{}),xc(n)){const s=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new ta([s],e,t)}const r=await Jw(n);if(e||(e=Xw(n)??"unknown_file"),!t.type){const s=(i=r[0])==null?void 0:i.type;typeof s=="string"&&(t={...t,type:s})}return new ta(r,e,t)}async function Jw(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Sc(n))e.push(await n.arrayBuffer());else if(Qw(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Kw(n)}`);return e}function Kw(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Xw(n){var e;return Rs(n.name)||Rs(n.filename)||((e=Rs(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Rs=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Qw=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",El=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",vr=async n=>{const e=await Yw(n.body);return yc(e,n)},Yw=async n=>{const e=new mc;return await Promise.all(Object.entries(n||{}).map(([t,r])=>ra(e,t,r))),e},ra=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Gw(t)){const r=await Ec(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>ra(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,i])=>ra(n,`${e}[${r}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Sn={},e_=function(n,e,t,r,i){if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t},t_=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Dr;async function Ac(n){const{response:e}=n;if(n.options.stream)return En("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):gt.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const s=await e.json();return En("response",e.status,e.url,e.headers,s),s}const i=await e.text();return En("response",e.status,e.url,e.headers,i),i}class os extends Promise{constructor(e,t=Ac){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new os(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class n_{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:i,fetch:s}){this.baseURL=e,this.maxRetries=Ns("maxRetries",t),this.timeout=Ns("timeout",r),this.httpAgent=i,this.fetch=s??pc}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...l_(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${h_()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(i=>({method:e,path:t,...i})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var p;const{method:t,path:r,query:i,headers:s={}}=e,a=El(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(a),l=this.buildURL(r,i);"timeout"in e&&Ns("timeout",e.timeout);const u=e.timeout??this.timeout,c=e.httpAgent??this.httpAgent??bc(l),d=u+1e3;typeof((p=c==null?void 0:c.options)==null?void 0:p.timeout)=="number"&&d>(c.options.timeout??0)&&(c.options.timeout=d),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);const f=this.buildHeaders({options:e,headers:s,contentLength:o});return{req:{method:t,...a&&{body:a},headers:f,...c&&{agent:c},signal:e.signal??null},url:l,timeout:u}}buildHeaders({options:e,headers:t,contentLength:r}){const i={};r&&(i["content-length"]=r);const s=this.defaultHeaders(e);return Pl(i,s),Pl(i,t),El(e.body)&&nr!=="node"&&delete i["content-type"],this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,i){return Pe.generate(e,t,r,i)}request(e,t=null){return new os(this.makeRequest(e,t))}async makeRequest(e,t){var c,d;const r=await e;t==null&&(t=r.maxRetries??this.maxRetries),await this.prepareOptions(r);const{req:i,url:s,timeout:a}=this.buildRequest(r);if(await this.prepareRequest(i,{url:s,options:r}),En("request",s,r,i.headers),(c=r.signal)!=null&&c.aborted)throw new je;const o=new AbortController,l=await this.fetchWithTimeout(s,i,a,o).catch(ia);if(l instanceof Error){if((d=r.signal)!=null&&d.aborted)throw new je;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new as:new Tr({cause:l})}const u=i_(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const b=`retrying, ${t} attempts remaining`;return En(`response (error; ${b})`,l.status,s,u),this.retryRequest(r,t,u)}const f=await l.text().catch(b=>ia(b).message),h=u_(f),p=h?void 0:f;throw En(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,s,u,p),this.makeStatusError(l.status,h,p,u)}return{response:l,options:r,controller:o}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new r_(this,r,e)}buildURL(e,t){const r=d_(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return Ic(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new W(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,i){const{signal:s,...a}=t||{};s&&s.addEventListener("abort",()=>i.abort());const o=setTimeout(()=>i.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:i.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let i;const s=r==null?void 0:r["retry-after-ms"];if(s){const o=parseFloat(s);Number.isNaN(o)||(i=o)}const a=r==null?void 0:r["retry-after"];if(a&&!i){const o=parseFloat(a);Number.isNaN(o)?i=Date.parse(a)-Date.now():i=o*1e3}if(!(i&&0<=i&&i<60*1e3)){const o=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Or(i),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const s=t-e,a=Math.min(.5*Math.pow(2,s),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${fn}`}}class Cc{constructor(e,t,r,i){Dr.set(this,void 0),e_(this,Dr,e),this.options=i,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new W("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[i,s]of r)e.url.searchParams.set(i,s);t.query=void 0,t.path=e.url.toString()}return await t_(this,Dr,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Dr=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class r_ extends os{constructor(e,t,r){super(t,async i=>new r(e,i.response,await Ac(i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const i_=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),s_={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},Ue=n=>typeof n=="object"&&n!==null&&!Ic(n)&&Object.keys(n).every(e=>Pc(s_,e)),a_=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fn,"X-Stainless-OS":Cl(Deno.build.os),"X-Stainless-Arch":Al(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fn,"X-Stainless-OS":Cl(process.platform),"X-Stainless-Arch":Al(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=o_();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function o_(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const i=r[1]||0,s=r[2]||0,a=r[3]||0;return{browser:e,version:`${i}.${s}.${a}`}}}return null}const Al=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Cl=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Il;const l_=()=>Il??(Il=a_()),u_=n=>{try{return JSON.parse(n)}catch{return}},c_=new RegExp("^(?:[a-z]+:)?//","i"),d_=n=>c_.test(n),Or=n=>new Promise(e=>setTimeout(e,n)),Ns=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new W(`${n} must be an integer`);if(e<0)throw new W(`${n} must be a positive integer`);return e},ia=n=>n instanceof Error?n:new Error(n),Br=n=>{var e,t,r,i;if(typeof process<"u")return((e=Sn==null?void 0:Sn[n])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(i=(r=(t=Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:i.trim()};function Ic(n){if(!n)return!0;for(const e in n)return!1;return!0}function Pc(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Pl(n,e){for(const t in e){if(!Pc(e,t))continue;const r=t.toLowerCase();if(!r)continue;const i=e[t];i===null?delete n[r]:i!==void 0&&(n[r]=i)}}function En(n,...e){typeof process<"u"&&(Sn==null?void 0:Sn.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const h_=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),f_=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Tl(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class Ha extends Cc{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class ut extends Cc{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}class re{constructor(e){this._client=e}}let xi=class extends re{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}};xi||(xi={});let ki=class extends re{constructor(){super(...arguments),this.completions=new xi(this._client)}};(function(n){n.Completions=xi})(ki||(ki={}));class Si extends re{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}Si||(Si={});class Ei extends re{create(e,t){return this._client.post("/audio/transcriptions",vr({body:e,...t}))}}Ei||(Ei={});class Ai extends re{create(e,t){return this._client.post("/audio/translations",vr({body:e,...t}))}}Ai||(Ai={});class Ci extends re{constructor(){super(...arguments),this.transcriptions=new Ei(this._client),this.translations=new Ai(this._client),this.speech=new Si(this._client)}}(function(n){n.Transcriptions=Ei,n.Translations=Ai,n.Speech=Si})(Ci||(Ci={}));class Ii extends re{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Ue(e)?this.list({},e):this._client.getAPIList("/batches",Za,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Za extends ut{}(function(n){n.BatchesPage=Za})(Ii||(Ii={}));class Pi extends re{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return Ue(e)?this.list({},e):this._client.getAPIList("/assistants",Va,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Va extends ut{}(function(n){n.AssistantsPage=Va})(Pi||(Pi={}));function Ol(n){return typeof n.parse=="function"}const An=n=>(n==null?void 0:n.role)==="assistant",Tc=n=>(n==null?void 0:n.role)==="function",Oc=n=>(n==null?void 0:n.role)==="tool";var tt=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},V=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ve,Vr,qr,Un,Hn,Wr,Zn,Ct,Vn,Gr,Jr,pn,sa,Ti,aa,oa,la,ua,Rc,ca;const Rl=10;class Nc{constructor(){ve.add(this),this.controller=new AbortController,Vr.set(this,void 0),qr.set(this,()=>{}),Un.set(this,()=>{}),Hn.set(this,void 0),Wr.set(this,()=>{}),Zn.set(this,()=>{}),Ct.set(this,{}),this._chatCompletions=[],this.messages=[],Vn.set(this,!1),Gr.set(this,!1),Jr.set(this,!1),pn.set(this,!1),ua.set(this,e=>{if(tt(this,Gr,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new je),e instanceof je)return tt(this,Jr,!0,"f"),this._emit("abort",e);if(e instanceof W)return this._emit("error",e);if(e instanceof Error){const t=new W(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new W(String(e)))}),tt(this,Vr,new Promise((e,t)=>{tt(this,qr,e,"f"),tt(this,Un,t,"f")}),"f"),tt(this,Hn,new Promise((e,t)=>{tt(this,Wr,e,"f"),tt(this,Zn,t,"f")}),"f"),V(this,Vr,"f").catch(()=>{}),V(this,Hn,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},V(this,ua,"f"))},0)}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Tc(e)||Oc(e))&&e.content)this._emit("functionCallResult",e.content);else if(An(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(An(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}_connected(){this.ended||(V(this,qr,"f").call(this),this._emit("connect"))}get ended(){return V(this,Vn,"f")}get errored(){return V(this,Gr,"f")}get aborted(){return V(this,Jr,"f")}abort(){this.controller.abort()}on(e,t){return(V(this,Ct,"f")[e]||(V(this,Ct,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=V(this,Ct,"f")[e];if(!r)return this;const i=r.findIndex(s=>s.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(V(this,Ct,"f")[e]||(V(this,Ct,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{tt(this,pn,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){tt(this,pn,!0,"f"),await V(this,Hn,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new W("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),V(this,ve,"m",sa).call(this)}async finalMessage(){return await this.done(),V(this,ve,"m",Ti).call(this)}async finalFunctionCall(){return await this.done(),V(this,ve,"m",aa).call(this)}async finalFunctionCallResult(){return await this.done(),V(this,ve,"m",oa).call(this)}async totalUsage(){return await this.done(),V(this,ve,"m",la).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(V(this,Vn,"f"))return;e==="end"&&(tt(this,Vn,!0,"f"),V(this,Wr,"f").call(this));const r=V(this,Ct,"f")[e];if(r&&(V(this,Ct,"f")[e]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!V(this,pn,"f")&&!(r!=null&&r.length)&&Promise.reject(i),V(this,Un,"f").call(this,i),V(this,Zn,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!V(this,pn,"f")&&!(r!=null&&r.length)&&Promise.reject(i),V(this,Un,"f").call(this,i),V(this,Zn,"f").call(this,i),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=V(this,ve,"m",Ti).call(this);t&&this._emit("finalMessage",t);const r=V(this,ve,"m",sa).call(this);r&&this._emit("finalContent",r);const i=V(this,ve,"m",aa).call(this);i&&this._emit("finalFunctionCall",i);const s=V(this,ve,"m",oa).call(this);s!=null&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",V(this,ve,"m",la).call(this))}async _createChatCompletion(e,t,r){const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),V(this,ve,"m",Rc).call(this,t);const s=await e.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(s)}async _runChatCompletion(e,t,r){for(const i of t.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var f;const i="function",{function_call:s="auto",stream:a,...o}=t,l=typeof s!="string"&&(s==null?void 0:s.name),{maxChatCompletions:u=Rl}=r||{},c={};for(const h of t.functions)c[h.name||h.function.name]=h;const d=t.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(const h of t.messages)this._addMessage(h,!1);for(let h=0;h<u;++h){const w=(f=(await this._createChatCompletion(e,{...o,function_call:s,functions:d,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!w)throw new W("missing message in ChatCompletion response");if(!w.function_call)return;const{name:y,arguments:b}=w.function_call,_=c[y];if(_){if(l&&l!==y){const x=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:i,name:y,content:x});continue}}else{const x=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${d.map(N=>JSON.stringify(N.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:y,content:x});continue}let v;try{v=Ol(_)?await _.parse(b):b}catch(x){this._addMessage({role:i,name:y,content:x instanceof Error?x.message:String(x)});continue}const P=await _.function(v,this),C=V(this,ve,"m",ca).call(this,P);if(this._addMessage({role:i,name:y,content:C}),l)return}}async _runTools(e,t,r){var f,h;const i="tool",{tool_choice:s="auto",stream:a,...o}=t,l=typeof s!="string"&&((f=s==null?void 0:s.function)==null?void 0:f.name),{maxChatCompletions:u=Rl}=r||{},c={};for(const p of t.tools)p.type==="function"&&(c[p.function.name||p.function.function.name]=p.function);const d="tools"in t?t.tools.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description}}:p):void 0;for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<u;++p){const y=(h=(await this._createChatCompletion(e,{...o,tool_choice:s,tools:d,messages:[...this.messages]},r)).choices[0])==null?void 0:h.message;if(!y)throw new W("missing message in ChatCompletion response");if(!y.tool_calls)return;for(const b of y.tool_calls){if(b.type!=="function")continue;const _=b.id,{name:v,arguments:P}=b.function,C=c[v];if(C){if(l&&l!==v){const D=`Invalid tool_call: ${JSON.stringify(v)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:i,tool_call_id:_,content:D});continue}}else{const D=`Invalid tool_call: ${JSON.stringify(v)}. Available options are: ${d.map(Q=>JSON.stringify(Q.function.name)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:_,content:D});continue}let x;try{x=Ol(C)?await C.parse(P):P}catch(D){const Q=D instanceof Error?D.message:String(D);this._addMessage({role:i,tool_call_id:_,content:Q});continue}const N=await C.function(x,this),ee=V(this,ve,"m",ca).call(this,N);if(this._addMessage({role:i,tool_call_id:_,content:ee}),l)return}}}}Vr=new WeakMap,qr=new WeakMap,Un=new WeakMap,Hn=new WeakMap,Wr=new WeakMap,Zn=new WeakMap,Ct=new WeakMap,Vn=new WeakMap,Gr=new WeakMap,Jr=new WeakMap,pn=new WeakMap,ua=new WeakMap,ve=new WeakSet,sa=function(){return V(this,ve,"m",Ti).call(this).content??null},Ti=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(An(t))return{...t,content:t.content??null}}throw new W("stream ended without producing a ChatCompletionMessage with role=assistant")},aa=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const i=this.messages[r];if(An(i)&&(i!=null&&i.function_call))return i.function_call;if(An(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(t=i.tool_calls.at(-1))==null?void 0:t.function}},oa=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Tc(t)&&t.content!=null||Oc(t)&&t.content!=null&&this.messages.some(r=>{var i;return r.role==="assistant"&&((i=r.tool_calls)==null?void 0:i.some(s=>s.type==="function"&&s.id===t.tool_call_id))}))return t.content}},la=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Rc=function(e){if(e.n!=null&&e.n>1)throw new W("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ca=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class xr extends Nc{static runFunctions(e,t,r){const i=new xr,s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,t,s)),i}static runTools(e,t,r){const i=new xr,s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,s)),i}_addMessage(e){super._addMessage(e),An(e)&&e.content&&this._emit("content",e.content)}}var nt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},js=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},ct,$t,Ls,$s,Fr,Nl;class kr extends Nc{constructor(){super(...arguments),ct.add(this),$t.set(this,void 0)}get currentChatCompletionSnapshot(){return nt(this,$t,"f")}static fromReadableStream(e){const t=new kr;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const i=new kr;return i._run(()=>i._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,t,r){var a;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),nt(this,ct,"m",Ls).call(this);const s=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of s)nt(this,ct,"m",$s).call(this,o);if((a=s.controller.signal)!=null&&a.aborted)throw new je;return this._addChatCompletion(nt(this,ct,"m",Fr).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),nt(this,ct,"m",Ls).call(this),this._connected();const i=gt.fromReadableStream(e,this.controller);let s;for await(const o of i)s&&s!==o.id&&this._addChatCompletion(nt(this,ct,"m",Fr).call(this)),nt(this,ct,"m",$s).call(this,o),s=o.id;if((a=i.controller.signal)!=null&&a.aborted)throw new je;return this._addChatCompletion(nt(this,ct,"m",Fr).call(this))}[($t=new WeakMap,ct=new WeakSet,Ls=function(){this.ended||js(this,$t,void 0,"f")},$s=function(t){var a,o,l;if(this.ended)return;const r=nt(this,ct,"m",Nl).call(this,t);this._emit("chunk",t,r);const i=(o=(a=t.choices[0])==null?void 0:a.delta)==null?void 0:o.content,s=(l=r.choices[0])==null?void 0:l.message;i!=null&&(s==null?void 0:s.role)==="assistant"&&(s!=null&&s.content)&&this._emit("content",i,s.content)},Fr=function(){if(this.ended)throw new W("stream has ended, this shouldn't happen");const t=nt(this,$t,"f");if(!t)throw new W("request ended without sending any chunks");return js(this,$t,void 0,"f"),p_(t)},Nl=function(t){var r,i,s;let a=nt(this,$t,"f");const{choices:o,...l}=t;a?Object.assign(a,l):a=js(this,$t,{...l,choices:[]},"f");for(const{delta:u,finish_reason:c,index:d,logprobs:f=null,...h}of t.choices){let p=a.choices[d];if(p||(p=a.choices[d]={finish_reason:c,index:d,message:{},logprobs:f,...h}),f)if(!p.logprobs)p.logprobs=Object.assign({},f);else{const{content:P,...C}=f;Object.assign(p.logprobs,C),P&&((r=p.logprobs).content??(r.content=[]),p.logprobs.content.push(...P))}if(c&&(p.finish_reason=c),Object.assign(p,h),!u)continue;const{content:w,function_call:y,role:b,tool_calls:_,...v}=u;if(Object.assign(p.message,v),w&&(p.message.content=(p.message.content||"")+w),b&&(p.message.role=b),y&&(p.message.function_call?(y.name&&(p.message.function_call.name=y.name),y.arguments&&((i=p.message.function_call).arguments??(i.arguments=""),p.message.function_call.arguments+=y.arguments)):p.message.function_call=y),_){p.message.tool_calls||(p.message.tool_calls=[]);for(const{index:P,id:C,type:x,function:N,...ee}of _){const D=(s=p.message.tool_calls)[P]??(s[P]={});Object.assign(D,ee),C&&(D.id=C),x&&(D.type=x),N&&(D.function??(D.function={arguments:""})),N!=null&&N.name&&(D.function.name=N.name),N!=null&&N.arguments&&(D.function.arguments+=N.arguments)}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",i=>{const s=t.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const s of t)s.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const s of t)s.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,a)=>t.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new gt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function p_(n){const{id:e,choices:t,created:r,model:i,system_fingerprint:s,...a}=n;return{...a,id:e,choices:t.map(({message:o,finish_reason:l,index:u,logprobs:c,...d})=>{if(!l)throw new W(`missing finish_reason for choice ${u}`);const{content:f=null,function_call:h,tool_calls:p,...w}=o,y=o.role;if(!y)throw new W(`missing role for choice ${u}`);if(h){const{arguments:b,name:_}=h;if(b==null)throw new W(`missing function_call.arguments for choice ${u}`);if(!_)throw new W(`missing function_call.name for choice ${u}`);return{...d,message:{content:f,function_call:{arguments:b,name:_},role:y},finish_reason:l,index:u,logprobs:c}}return p?{...d,index:u,finish_reason:l,logprobs:c,message:{...w,role:y,content:f,tool_calls:p.map((b,_)=>{const{function:v,type:P,id:C,...x}=b,{arguments:N,name:ee,...D}=v||{};if(C==null)throw new W(`missing choices[${u}].tool_calls[${_}].id
${zr(n)}`);if(P==null)throw new W(`missing choices[${u}].tool_calls[${_}].type
${zr(n)}`);if(ee==null)throw new W(`missing choices[${u}].tool_calls[${_}].function.name
${zr(n)}`);if(N==null)throw new W(`missing choices[${u}].tool_calls[${_}].function.arguments
${zr(n)}`);return{...x,id:C,type:P,function:{...D,name:ee,arguments:N}}})}}:{...d,message:{...w,content:f,role:y},finish_reason:l,index:u,logprobs:c}}),created:r,model:i,object:"chat.completion",...s?{system_fingerprint:s}:{}}}function zr(n){return JSON.stringify(n)}class Cn extends kr{static fromReadableStream(e){const t=new Cn;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const i=new Cn,s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,t,s)),i}static runTools(e,t,r){const i=new Cn,s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,s)),i}}let jc=class extends re{runFunctions(e,t){return e.stream?Cn.runFunctions(this._client.chat.completions,e,t):xr.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?Cn.runTools(this._client.chat.completions,e,t):xr.runTools(this._client.chat.completions,e,t)}stream(e,t){return kr.createChatCompletion(this._client.chat.completions,e,t)}};class Oi extends re{constructor(){super(...arguments),this.completions=new jc(this._client)}}(function(n){n.Completions=jc})(Oi||(Oi={}));var rt=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},le=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Kr,Xr,qn,Wn,Qr,Gn,It,Jn,Yr,ei,mn,da;class m_{constructor(){this.controller=new AbortController,Kr.set(this,void 0),Xr.set(this,()=>{}),qn.set(this,()=>{}),Wn.set(this,void 0),Qr.set(this,()=>{}),Gn.set(this,()=>{}),It.set(this,{}),Jn.set(this,!1),Yr.set(this,!1),ei.set(this,!1),mn.set(this,!1),da.set(this,e=>{if(rt(this,Yr,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new je),e instanceof je)return rt(this,ei,!0,"f"),this._emit("abort",e);if(e instanceof W)return this._emit("error",e);if(e instanceof Error){const t=new W(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new W(String(e)))}),rt(this,Kr,new Promise((e,t)=>{rt(this,Xr,e,"f"),rt(this,qn,t,"f")}),"f"),rt(this,Wn,new Promise((e,t)=>{rt(this,Qr,e,"f"),rt(this,Gn,t,"f")}),"f"),le(this,Kr,"f").catch(()=>{}),le(this,Wn,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},le(this,da,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(le(this,Xr,"f").call(this),this._emit("connect"))}get ended(){return le(this,Jn,"f")}get errored(){return le(this,Yr,"f")}get aborted(){return le(this,ei,"f")}abort(){this.controller.abort()}on(e,t){return(le(this,It,"f")[e]||(le(this,It,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=le(this,It,"f")[e];if(!r)return this;const i=r.findIndex(s=>s.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(le(this,It,"f")[e]||(le(this,It,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{rt(this,mn,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){rt(this,mn,!0,"f"),await le(this,Wn,"f")}_emit(e,...t){if(le(this,Jn,"f"))return;e==="end"&&(rt(this,Jn,!0,"f"),le(this,Qr,"f").call(this));const r=le(this,It,"f")[e];if(r&&(le(this,It,"f")[e]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!le(this,mn,"f")&&!(r!=null&&r.length)&&Promise.reject(i),le(this,qn,"f").call(this,i),le(this,Gn,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!le(this,mn,"f")&&!(r!=null&&r.length)&&Promise.reject(i),le(this,qn,"f").call(this,i),le(this,Gn,"f").call(this,i),this._emit("end")}}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,i){return await this._createAssistantStream(t,e,r,i)}async _runToolAssistantStream(e,t,r,i,s){return await this._createToolAssistantStream(r,e,t,i,s)}async _createThreadAssistantStream(e,t,r){const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const s=await e.createAndRun({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addRun(s)}async _createToolAssistantStream(e,t,r,i,s){const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o=await e.submitToolOutputs(t,r,{...i,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,t,r,i){const s=i==null?void 0:i.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a=await e.create(t,{...r,stream:!1},{...i,signal:this.controller.signal});return this._connected(),this._addRun(a)}}Kr=new WeakMap,Xr=new WeakMap,qn=new WeakMap,Wn=new WeakMap,Qr=new WeakMap,Gn=new WeakMap,It=new WeakMap,Jn=new WeakMap,Yr=new WeakMap,ei=new WeakMap,mn=new WeakMap,da=new WeakMap;var j=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Me=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},be,ha,ht,ti,it,Qt,wn,Kt,Ri,Be,ni,ri,rr,Kn,Xn,jl,Ll,$l,Ml,Dl,Bl,Fl;class at extends m_{constructor(){super(...arguments),be.add(this),ha.set(this,[]),ht.set(this,{}),ti.set(this,{}),it.set(this,void 0),Qt.set(this,void 0),wn.set(this,void 0),Kt.set(this,void 0),Ri.set(this,void 0),Be.set(this,void 0),ni.set(this,void 0),ri.set(this,void 0),rr.set(this,void 0)}[(ha=new WeakMap,ht=new WeakMap,ti=new WeakMap,it=new WeakMap,Qt=new WeakMap,wn=new WeakMap,Kt=new WeakMap,Ri=new WeakMap,Be=new WeakMap,ni=new WeakMap,ri=new WeakMap,rr=new WeakMap,be=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",i=>{const s=t.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const s of t)s.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const s of t)s.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,a)=>t.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new at;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var s;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=gt.fromReadableStream(e,this.controller);for await(const a of i)j(this,be,"m",Kn).call(this,a);if((s=i.controller.signal)!=null&&s.aborted)throw new je;return this._addRun(j(this,be,"m",Xn).call(this))}toReadableStream(){return new gt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,i,s){const a=new at;return a._run(()=>a._runToolAssistantStream(e,t,r,i,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,i,s){var u;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...i,stream:!0},l=await e.submitToolOutputs(t,r,o,{...s,signal:this.controller.signal});this._connected();for await(const c of l)j(this,be,"m",Kn).call(this,c);if((u=l.controller.signal)!=null&&u.aborted)throw new je;return this._addRun(j(this,be,"m",Xn).call(this))}static createThreadAssistantStream(e,t,r){const i=new at;return i._run(()=>i._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,t,r,i){const s=new at;return s._run(()=>s._runAssistantStream(e,t,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return j(this,ni,"f")}currentRun(){return j(this,ri,"f")}currentMessageSnapshot(){return j(this,it,"f")}currentRunStepSnapshot(){return j(this,rr,"f")}async finalRunSteps(){return await this.done(),Object.values(j(this,ht,"f"))}async finalMessages(){return await this.done(),Object.values(j(this,ti,"f"))}async finalRun(){if(await this.done(),!j(this,Qt,"f"))throw Error("Final run was not received.");return j(this,Qt,"f")}async _createThreadAssistantStream(e,t,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const s={...t,stream:!0},a=await e.createAndRun(s,{...r,signal:this.controller.signal});this._connected();for await(const l of a)j(this,be,"m",Kn).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new je;return this._addRun(j(this,be,"m",Xn).call(this))}async _createAssistantStream(e,t,r,i){var l;const s=i==null?void 0:i.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...i,signal:this.controller.signal});this._connected();for await(const u of o)j(this,be,"m",Kn).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new je;return this._addRun(j(this,be,"m",Xn).call(this))}static accumulateDelta(e,t){for(const[r,i]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=i;continue}let s=e[r];if(s==null){e[r]=i;continue}if(r==="index"||r==="type"){e[r]=i;continue}if(typeof s=="string"&&typeof i=="string")s+=i;else if(typeof s=="number"&&typeof i=="number")s+=i;else if(Tl(s)&&Tl(i))s=this.accumulateDelta(s,i);else if(Array.isArray(s)&&Array.isArray(i)){if(s.every(a=>typeof a=="string"||typeof a=="number")){s.push(...i);continue}}else throw Error(`Unhandled record type: ${r}, deltaValue: ${i}, accValue: ${s}`);e[r]=s}return e}}Kn=function(e){if(!this.ended)switch(Me(this,ni,e,"f"),j(this,be,"m",$l).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":j(this,be,"m",Fl).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":j(this,be,"m",Ll).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":j(this,be,"m",jl).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Xn=function(){if(this.ended)throw new W("stream has ended, this shouldn't happen");if(!j(this,Qt,"f"))throw Error("Final run has not been received");return j(this,Qt,"f")},jl=function(e){const[t,r]=j(this,be,"m",Dl).call(this,e,j(this,it,"f"));Me(this,it,t,"f"),j(this,ti,"f")[t.id]=t;for(const i of r){const s=t.content[i.index];(s==null?void 0:s.type)=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let s=i.text,a=t.content[i.index];if(a&&a.type=="text")this._emit("textDelta",s,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=j(this,wn,"f")){if(j(this,Kt,"f"))switch(j(this,Kt,"f").type){case"text":this._emit("textDone",j(this,Kt,"f").text,j(this,it,"f"));break;case"image_file":this._emit("imageFileDone",j(this,Kt,"f").image_file,j(this,it,"f"));break}Me(this,wn,i.index,"f")}Me(this,Kt,t.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(j(this,wn,"f")!==void 0){const i=e.data.content[j(this,wn,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,j(this,it,"f"));break;case"text":this._emit("textDone",i.text,j(this,it,"f"));break}}j(this,it,"f")&&this._emit("messageDone",e.data),Me(this,it,void 0,"f")}},Ll=function(e){const t=j(this,be,"m",Ml).call(this,e);switch(Me(this,rr,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const s of r.step_details.tool_calls)s.index==j(this,Ri,"f")?this._emit("toolCallDelta",s,t.step_details.tool_calls[s.index]):(j(this,Be,"f")&&this._emit("toolCallDone",j(this,Be,"f")),Me(this,Ri,s.index,"f"),Me(this,Be,t.step_details.tool_calls[s.index],"f"),j(this,Be,"f")&&this._emit("toolCallCreated",j(this,Be,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Me(this,rr,void 0,"f"),e.data.step_details.type=="tool_calls"&&j(this,Be,"f")&&(this._emit("toolCallDone",j(this,Be,"f")),Me(this,Be,void 0,"f")),this._emit("runStepDone",e.data,t);break}},$l=function(e){j(this,ha,"f").push(e),this._emit("event",e)},Ml=function(e){switch(e.event){case"thread.run.step.created":return j(this,ht,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=j(this,ht,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const i=at.accumulateDelta(t,r.delta);j(this,ht,"f")[e.data.id]=i}return j(this,ht,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":j(this,ht,"f")[e.data.id]=e.data;break}if(j(this,ht,"f")[e.data.id])return j(this,ht,"f")[e.data.id];throw new Error("No snapshot available")},Dl=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const s of i.delta.content)if(s.index in t.content){let a=t.content[s.index];t.content[s.index]=j(this,be,"m",Bl).call(this,s,a)}else t.content[s.index]=s,r.push(s);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Bl=function(e,t){return at.accumulateDelta(t,e)},Fl=function(e){switch(Me(this,ri,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Me(this,Qt,e.data,"f"),j(this,Be,"f")&&(this._emit("toolCallDone",j(this,Be,"f")),Me(this,Be,void 0,"f"));break}};class Ni extends re{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,i){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t={},r){return Ue(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,qa,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class qa extends ut{}(function(n){n.MessagesPage=qa})(Ni||(Ni={}));class ji extends re{retrieve(e,t,r,i){return this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},i){return Ue(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Wa,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}}class Wa extends ut{}(function(n){n.RunStepsPage=Wa})(ji||(ji={}));class Li extends re{constructor(){super(...arguments),this.steps=new ji(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/runs`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,i){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t={},r){return Ue(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Ga,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const i=await this.create(e,t,r);return await this.poll(e,i.id,r)}createAndStream(e,t,r){return at.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const i={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:s,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...i}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Or(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,r){return at.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,i){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,i){const s=await this.submitToolOutputs(e,t,r,i);return await this.poll(e,s.id,i)}submitToolOutputsStream(e,t,r,i){return at.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,i)}}class Ga extends ut{}(function(n){n.RunsPage=Ga,n.Steps=ji,n.RunStepsPage=Wa})(Li||(Li={}));class $i extends re{constructor(){super(...arguments),this.runs=new Li(this._client),this.messages=new Ni(this._client)}create(e={},t){return Ue(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return at.createThreadAssistantStream(e,this._client.beta.threads,t)}}(function(n){n.Runs=Li,n.RunsPage=Ga,n.Messages=Ni,n.MessagesPage=qa})($i||($i={}));const g_=async n=>{const e=await Promise.allSettled(n),t=e.filter(i=>i.status==="rejected");if(t.length){for(const i of t)console.error(i.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const i of e)i.status==="fulfilled"&&r.push(i.value);return r};let Mi=class extends re{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return Ue(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,ls,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const i=await this.create(e,t,r);return await this.poll(e,i.id,r)}async poll(e,t,r){const i={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const s=await this.retrieve(e,t,{...r,headers:i}).withResponse(),a=s.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=s.response.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Or(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const i=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:i.id},r)}async uploadAndPoll(e,t,r){const i=await this.upload(e,t,r);return await this.poll(e,i.id,r)}};class ls extends ut{}(function(n){n.VectorStoreFilesPage=ls})(Mi||(Mi={}));class Di extends re{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const i=await this.create(e,t);return await this.poll(e,i.id,r)}listFiles(e,t,r={},i){return Ue(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,ls,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}async poll(e,t,r){const i={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:s,response:a}=await this.retrieve(e,t,{...r,headers:i}).withResponse();switch(s.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Or(o);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},i){if(t===null||t.length==0)throw new Error("No files provided to process.");const s=(i==null?void 0:i.maxConcurrency)??5,a=Math.min(s,t.length),o=this._client,l=t.values(),u=[...r];async function c(f){for(let h of f){const p=await o.files.create({file:h,purpose:"assistants"},i);u.push(p.id)}}const d=Array(a).fill(l).map(c);return await g_(d),await this.createAndPoll(e,{file_ids:u})}}Di||(Di={});class Bi extends re{constructor(){super(...arguments),this.files=new Mi(this._client),this.fileBatches=new Di(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return Ue(e)?this.list({},e):this._client.getAPIList("/vector_stores",Ja,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Ja extends ut{}(function(n){n.VectorStoresPage=Ja,n.Files=Mi,n.VectorStoreFilesPage=ls,n.FileBatches=Di})(Bi||(Bi={}));class Fi extends re{constructor(){super(...arguments),this.vectorStores=new Bi(this._client),this.chat=new Oi(this._client),this.assistants=new Pi(this._client),this.threads=new $i(this._client)}}(function(n){n.VectorStores=Bi,n.VectorStoresPage=Ja,n.Chat=Oi,n.Assistants=Pi,n.AssistantsPage=Va,n.Threads=$i})(Fi||(Fi={}));class zi extends re{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}zi||(zi={});let Ui=class extends re{create(e,t){return this._client.post("/embeddings",{body:e,...t})}};Ui||(Ui={});class Hi extends re{create(e,t){return this._client.post("/files",vr({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Ue(e)?this.list({},e):this._client.getAPIList("/files",Ka,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const i=new Set(["processed","error","deleted"]),s=Date.now();let a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await Or(t),a=await this.retrieve(e),Date.now()-s>r)throw new as({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class Ka extends Ha{}(function(n){n.FileObjectsPage=Ka})(Hi||(Hi={}));class Zi extends re{list(e,t={},r){return Ue(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Xa,{query:t,...r})}}class Xa extends ut{}(function(n){n.FineTuningJobCheckpointsPage=Xa})(Zi||(Zi={}));class Vi extends re{constructor(){super(...arguments),this.checkpoints=new Zi(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Ue(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Qa,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return Ue(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ya,{query:t,...r})}}class Qa extends ut{}class Ya extends ut{}(function(n){n.FineTuningJobsPage=Qa,n.FineTuningJobEventsPage=Ya,n.Checkpoints=Zi,n.FineTuningJobCheckpointsPage=Xa})(Vi||(Vi={}));class qi extends re{constructor(){super(...arguments),this.jobs=new Vi(this._client)}}(function(n){n.Jobs=Vi,n.FineTuningJobsPage=Qa,n.FineTuningJobEventsPage=Ya})(qi||(qi={}));class Wi extends re{createVariation(e,t){return this._client.post("/images/variations",vr({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",vr({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Wi||(Wi={});class Gi extends re{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",eo,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class eo extends Ha{}(function(n){n.ModelsPage=eo})(Gi||(Gi={}));class Ji extends re{create(e,t){return this._client.post("/moderations",{body:e,...t})}}Ji||(Ji={});var Lc;let pe=class extends n_{constructor({baseURL:e=Br("OPENAI_BASE_URL"),apiKey:t=Br("OPENAI_API_KEY"),organization:r=Br("OPENAI_ORG_ID")??null,project:i=Br("OPENAI_PROJECT_ID")??null,...s}={}){if(t===void 0)throw new W("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:i,...s,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&f_())throw new W(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new zi(this),this.chat=new ki(this),this.embeddings=new Ui(this),this.files=new Hi(this),this.images=new Wi(this),this.audio=new Ci(this),this.moderations=new Ji(this),this.models=new Gi(this),this.fineTuning=new qi(this),this.beta=new Fi(this),this.batches=new Ii(this),this._options=a,this.apiKey=t,this.organization=r,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};Lc=pe;pe.OpenAI=Lc;pe.OpenAIError=W;pe.APIError=Pe;pe.APIConnectionError=Tr;pe.APIConnectionTimeoutError=as;pe.APIUserAbortError=je;pe.NotFoundError=Da;pe.ConflictError=Ba;pe.RateLimitError=za;pe.BadRequestError=La;pe.AuthenticationError=$a;pe.InternalServerError=Ua;pe.PermissionDeniedError=Ma;pe.UnprocessableEntityError=Fa;pe.toFile=Ec;pe.fileFromPath=wc;const{OpenAIError:Q_,APIError:Y_,APIConnectionError:ev,APIConnectionTimeoutError:y_,APIUserAbortError:b_,NotFoundError:tv,ConflictError:nv,RateLimitError:rv,BadRequestError:iv,AuthenticationError:sv,InternalServerError:av,PermissionDeniedError:ov,UnprocessableEntityError:lv}=Uw;(function(n){n.Page=Ha,n.CursorPage=ut,n.Completions=zi,n.Chat=ki,n.Embeddings=Ui,n.Files=Hi,n.FileObjectsPage=Ka,n.Images=Wi,n.Audio=Ci,n.Moderations=Ji,n.Models=Gi,n.ModelsPage=eo,n.FineTuning=qi,n.Beta=Fi,n.Batches=Ii,n.BatchesPage=Za})(pe||(pe={}));function w_(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:i,baseURL:s,azureADTokenProvider:a}=n;if(r&&i&&e)return`${i}/${e}`;if(r||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return s}function __(n){let e;return n.constructor.name===y_.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===b_.name?(e=new Error(n.message),e.name="AbortError"):e=n,e}const v_=(n,e)=>n.reduce((t,r,i)=>{const s=Math.floor(i/e),a=t[s]||[];return t[s]=a.concat([r]),t},[]);class x_{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new sc(e??{})}}class k_ extends x_{constructor(e,t){var u,c,d;const r={maxConcurrency:2,...e};super(r),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"dimensions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let i=(r==null?void 0:r.apiKey)??(r==null?void 0:r.openAIApiKey)??Re("OPENAI_API_KEY");const s=(r==null?void 0:r.azureOpenAIApiKey)??Re("AZURE_OPENAI_API_KEY");if(this.azureADTokenProvider=(e==null?void 0:e.azureADTokenProvider)??void 0,!s&&!i&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");const a=(r==null?void 0:r.azureOpenAIApiInstanceName)??Re("AZURE_OPENAI_API_INSTANCE_NAME"),o=((r==null?void 0:r.azureOpenAIApiEmbeddingsDeploymentName)||(r==null?void 0:r.azureOpenAIApiDeploymentName))??(Re("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||Re("AZURE_OPENAI_API_DEPLOYMENT_NAME")),l=(r==null?void 0:r.azureOpenAIApiVersion)??Re("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=(r==null?void 0:r.azureOpenAIBasePath)??Re("AZURE_OPENAI_BASE_PATH"),this.organization=((u=r==null?void 0:r.configuration)==null?void 0:u.organization)??Re("OPENAI_ORGANIZATION"),this.modelName=(r==null?void 0:r.model)??(r==null?void 0:r.modelName)??this.model,this.model=this.modelName,this.batchSize=(r==null?void 0:r.batchSize)??(s?1:this.batchSize),this.stripNewLines=(r==null?void 0:r.stripNewLines)??this.stripNewLines,this.timeout=r==null?void 0:r.timeout,this.dimensions=r==null?void 0:r.dimensions,this.azureOpenAIApiVersion=l,this.azureOpenAIApiKey=s,this.azureOpenAIApiInstanceName=a,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");i=i??""}this.clientConfig={apiKey:i,organization:this.organization,baseURL:t==null?void 0:t.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:(c=t==null?void 0:t.baseOptions)==null?void 0:c.headers,defaultQuery:(d=t==null?void 0:t.baseOptions)==null?void 0:d.params,...t,...e==null?void 0:e.configuration}}async embedDocuments(e){const t=v_(this.stripNewLines?e.map(a=>a.replace(/\n/g," ")):e,this.batchSize),r=t.map(a=>{const o={model:this.model,input:a};return this.dimensions&&(o.dimensions=this.dimensions),this.embeddingWithRetry(o)}),i=await Promise.all(r),s=[];for(let a=0;a<i.length;a+=1){const o=t[a],{data:l}=i[a];for(let u=0;u<o.length;u+=1)s.push(l[u].embedding)}return s}async embedQuery(e){const t={model:this.model,input:this.stripNewLines?e.replace(/\n/g," "):e};this.dimensions&&(t.dimensions=this.dimensions);const{data:r}=await this.embeddingWithRetry(t);return r[0].embedding}async embeddingWithRetry(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},i=w_(r),s={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new pe(s)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),this.caller.call(async()=>{try{return await this.client.embeddings.create(e,t)}catch(r){throw __(r)}})}}async function S_({query:n,context:e,openAIApiKey:t}){const i=await new vi({chunkSize:300,chunkOverlap:50}).createDocuments([e]),s=new k_({openAIApiKey:t,model:"text-embedding-3-large"}),a=async()=>await ja.fromDocuments(i,s),o=async()=>await s.embedQuery(n),[l,u]=await Promise.all([a(),o()]);return(await l.similaritySearchVectorWithScore(u,3)).map(f=>f[0].pageContent).join(`
`)}const E_=async n=>{var r;const t=(await Hl()).prompts;return(r=t==null?void 0:t.find(i=>i.id===n))==null?void 0:r.content};function A_(){const{setting:n}=Jc(),[e,t]=K.useState(!1),[r,i]=K.useState([]),[s,a]=K.useState(!1),o=K.useRef(void 0),l=K.useRef(null),u=K.useCallback(async()=>new Promise((p,w)=>{var y,b;(y=o.current)==null||y.onMessage.addListener(function(_){_.type==="pageText"&&p(_.payload.content)}),(b=o.current)==null||b.postMessage({type:"getPageText"})}),[]),c=K.useCallback(()=>{chrome.tabs.query({active:!0}).then(([p])=>{const w=p.id;typeof w<"u"&&(o.current=chrome.tabs.connect(w,{name:"readingAssistantSidePanelInit"}),o.current.onMessage.addListener(async function(y){var v;a(!0);const b=y.payload;if(!b.promptId)return;const _=await E_(b.promptId);if(_){const P=_.replace(/\{selectionText\}/g,()=>b.selectionText??"");(v=l.current)==null||v.sendMessage(P)}}),o.current.onDisconnect.addListener(function(){a(!1),o.current=void 0,window.close()}))})},[]),d=async p=>{if(!n.openAIKey){oo.add({type:"error",msg:"openAIKey is empty"});return}if(!p){oo.add({type:"error",msg:"question is empty"});return}const w=await u();return await S_({openAIApiKey:n.openAIKey,context:w,query:p})},f=()=>{u().then(p=>{i([{role:"assistant",content:`context: ${p}`}])})},h=async()=>{var y;const p=(y=l.current)==null?void 0:y.getInput();if(!p)return;t(!0);const w=await d(p);t(!1),i([{role:"assistant",content:`context: ${w}`}]),setTimeout(()=>{var b;(b=l.current)==null||b.sendMessage(p)},300)};return K.useEffect(()=>(c(),()=>{o.current&&(o.current.disconnect(),o.current=void 0,a(!1))}),[c]),F.jsxs(F.Fragment,{children:[F.jsxs("div",{className:"flex flex-col justify-between pt-3 h-[100vh]",children:[F.jsx("div",{onClick:()=>{chrome.runtime.openOptionsPage()},className:"fixed z-10 right-3 top-3 btn btn-circle btn-xs",children:F.jsx(ed,{className:"w-[14px] h-[14px]"})}),F.jsx("div",{className:"",children:F.jsxs("h1",{className:"hidden font-bold mt-2",children:["status:",s?"connected":"lose"]})}),F.jsx("div",{className:"grow",children:F.jsx(Zm,{toolSlot:F.jsxs("div",{className:"px-2 mb-1 flex items-center gap-2",children:[F.jsx("div",{onClick:()=>{var p;i([]),(p=l.current)==null||p.clearMessage()},"data-tip":"clear",className:" btn btn-xs btn-square tooltip flex items-center justify-center",children:F.jsx(Xc,{className:"w-[16px] h-[16px]"})}),F.jsx("div",{onClick:f,"data-tip":"insert whole context",className:" btn btn-xs btn-square tooltip flex items-center justify-center",children:F.jsx(Qc,{className:"w-[16px] h-[16px]"})}),F.jsx("div",{onClick:h,"data-tip":"get matched context",className:`${e?"disabled":""} btn btn-xs btn-square tooltip flex items-center justify-center`,children:e?F.jsx("span",{className:"w-[16px] h-[16px] loading loading-spinner"}):F.jsx(td,{className:"w-[16px] h-[16px]"})})]}),ref:l,preMessageList:r,engine:"openai"})})]}),F.jsx(Kc,{})]})}Gc(document.querySelector("#root")).render(F.jsx(A_,{}));
